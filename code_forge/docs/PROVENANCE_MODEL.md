# Code Forge Provenance Model

## Purpose
Provide deterministic links between Code Forge artifacts, Knowledge Forge nodes, GraphRAG exports, and downstream analysis.

## Artifact
- `provenance_links.json`

Generated by:
- `run_archive_digester(...)` at `output_dir/provenance_links.json`
- `run_roundtrip_pipeline(...)` at `workspace_dir/provenance_links.json`

## Schema (v1)
Top-level fields:
- `generated_at`: ISO timestamp
- `stage`: `archive_digester|roundtrip`
- `root_path`: processed source root
- `source_run_id`: ingestion run id that produced the stage
- `integration_policy`: `run|effective_run|global`
- `integration_run_id`: run scope used for Knowledge/GraphRAG exports (nullable for `global`)
- `provenance_id`: deterministic hash over root/run/policy and artifact checksums
- `artifacts`: list of records:
  - `artifact_kind`
  - `path`
  - `exists`
  - `sha256`
- `knowledge_links`:
  - `count`
  - `links` (`unit_id`, `node_id`, `status`)
- `memory_links`:
  - `count`
  - `links` (`unit_id`, `memory_id`, `status`)
- `graphrag_links`:
  - `count`
  - `documents` (`unit_id`, `qualified_name`, `language`, `unit_type`, `source_file_path`, `document_path`)
  - `manifest_path`
- `extra`: stage-specific metadata

## Query Patterns
Example queries supported by this schema:
1. Which extracted modules were synced to knowledge and where?
2. Which extracted modules were synced to memory and which memory IDs were created?
3. Which GraphRAG documents were generated from a given ingestion run?
4. Which stage artifacts contributed to a benchmark or drift report?

## MCP Access
Use `code_forge_provenance` via `eidos_mcp` to list/query available provenance records.
