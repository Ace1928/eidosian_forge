from unittest import mock
from urllib import parse
import ddt
import fixtures
from requests_mock.contrib import fixture as requests_mock_fixture
import cinderclient
from cinderclient import api_versions
from cinderclient import base
from cinderclient import client
from cinderclient import exceptions
from cinderclient import shell
from cinderclient.tests.unit.fixture_data import keystone_client
from cinderclient.tests.unit import utils
from cinderclient.tests.unit.v3 import fakes
from cinderclient import utils as cinderclient_utils
from cinderclient.v3 import attachments
from cinderclient.v3 import volume_snapshots
from cinderclient.v3 import volumes
@ddt.data({'command': 'list --name=123 --filters name=456', 'expected': '/volumes/detail?name=456'}, {'command': 'list --filters name=123', 'expected': '/volumes/detail?name=123'}, {'command': 'list --filters metadata={key1:value1}', 'expected': '/volumes/detail?metadata=%7B%27key1%27%3A+%27value1%27%7D'}, {'command': 'list --filters name~=456', 'expected': '/volumes/detail?name~=456'}, {'command': u'list --filters name~=Î£', 'expected': '/volumes/detail?name~=%CE%A3'}, {'command': u'list --filters name=abc --filters size=1', 'expected': '/volumes/detail?name=abc&size=1'}, {'command': u'list --filters created_at=lt:2020-01-15T00:00:00', 'expected': '/volumes/detail?created_at=lt%3A2020-01-15T00%3A00%3A00'}, {'command': u'list --filters updated_at=gte:2020-02-01T00:00:00,lt:2020-03-01T00:00:00', 'expected': '/volumes/detail?updated_at=gte%3A2020-02-01T00%3A00%3A00%2Clt%3A2020-03-01T00%3A00%3A00'}, {'command': u'list --filters updated_at=gte:2020-02-01T00:00:00,lt:2020-03-01T00:00:00 --filters created_at=lt:2020-01-15T00:00:00', 'expected': '/volumes/detail?created_at=lt%3A2020-01-15T00%3A00%3A00&updated_at=gte%3A2020-02-01T00%3A00%3A00%2Clt%3A2020-03-01T00%3A00%3A00'}, {'command': 'group-list --filters name=456', 'expected': '/groups/detail?name=456'}, {'command': 'group-list --filters status=available', 'expected': '/groups/detail?status=available'}, {'command': 'group-list --filters name~=456', 'expected': '/groups/detail?name~=456'}, {'command': 'group-list --filters name=abc --filters status=available', 'expected': '/groups/detail?name=abc&status=available'}, {'command': 'group-snapshot-list --status=error --filters status=available', 'expected': '/group_snapshots/detail?status=available'}, {'command': 'group-snapshot-list --filters availability_zone=123', 'expected': '/group_snapshots/detail?availability_zone=123'}, {'command': 'group-snapshot-list --filters status~=available', 'expected': '/group_snapshots/detail?status~=available'}, {'command': 'group-snapshot-list --filters status=available --filters availability_zone=123', 'expected': '/group_snapshots/detail?availability_zone=123&status=available'}, {'command': 'message-list --event_id=123 --filters event_id=456', 'expected': '/messages?event_id=456'}, {'command': 'message-list --filters request_id=123', 'expected': '/messages?request_id=123'}, {'command': 'message-list --filters request_id~=123', 'expected': '/messages?request_id~=123'}, {'command': 'message-list --filters request_id=123 --filters event_id=456', 'expected': '/messages?event_id=456&request_id=123'}, {'command': 'attachment-list --volume-id=123 --filters volume_id=456', 'expected': '/attachments?volume_id=456'}, {'command': 'attachment-list --filters mountpoint=123', 'expected': '/attachments?mountpoint=123'}, {'command': 'attachment-list --filters volume_id~=456', 'expected': '/attachments?volume_id~=456'}, {'command': 'attachment-list --filters volume_id=123 --filters mountpoint=456', 'expected': '/attachments?mountpoint=456&volume_id=123'}, {'command': 'backup-list --volume-id=123 --filters volume_id=456', 'expected': '/backups/detail?volume_id=456'}, {'command': 'backup-list --filters name=123', 'expected': '/backups/detail?name=123'}, {'command': 'backup-list --filters volume_id~=456', 'expected': '/backups/detail?volume_id~=456'}, {'command': 'backup-list --filters volume_id=123 --filters name=456', 'expected': '/backups/detail?name=456&volume_id=123'}, {'command': 'snapshot-list --volume-id=123 --filters volume_id=456', 'expected': '/snapshots/detail?volume_id=456'}, {'command': 'snapshot-list --filters name=123', 'expected': '/snapshots/detail?name=123'}, {'command': 'snapshot-list --filters volume_id~=456', 'expected': '/snapshots/detail?volume_id~=456'}, {'command': 'snapshot-list --filters volume_id=123 --filters name=456', 'expected': '/snapshots/detail?name=456&volume_id=123'}, {'command': 'get-pools --filters name=456 --detail', 'expected': '/scheduler-stats/get_pools?detail=True&name=456'}, {'command': 'get-pools --filters name=456', 'expected': '/scheduler-stats/get_pools?name=456'}, {'command': 'get-pools --filters name=456 --filters detail=True', 'expected': '/scheduler-stats/get_pools?detail=True&name=456'})
@ddt.unpack
def test_list_with_filters_mixed(self, command, expected):
    self.run_command('--os-volume-api-version 3.33 %s' % command)
    self.assert_called('GET', expected)