import copy
from typing import Optional
from twisted.words.xish import domish
class BaseError(Exception):
    """
    Base class for XMPP error exceptions.

    @cvar namespace: The namespace of the C{error} element generated by
                     C{getElement}.
    @type namespace: C{str}
    @ivar condition: The error condition. The valid values are defined by
                     subclasses of L{BaseError}.
    @type contition: C{str}
    @ivar text: Optional text message to supplement the condition or application
                specific condition.
    @type text: C{unicode}
    @ivar textLang: Identifier of the language used for the message in C{text}.
                    Values are as described in RFC 3066.
    @type textLang: C{str}
    @ivar appCondition: Application specific condition element, supplementing
                        the error condition in C{condition}.
    @type appCondition: object providing L{domish.IElement}.
    """
    namespace: Optional[str] = None

    def __init__(self, condition, text=None, textLang=None, appCondition=None):
        Exception.__init__(self)
        self.condition = condition
        self.text = text
        self.textLang = textLang
        self.appCondition = appCondition

    def __str__(self) -> str:
        message = '{} with condition {!r}'.format(self.__class__.__name__, self.condition)
        if self.text:
            message += ': ' + self.text
        return message

    def getElement(self):
        """
        Get XML representation from self.

        The method creates an L{domish} representation of the
        error data contained in this exception.

        @rtype: L{domish.Element}
        """
        error = domish.Element((None, 'error'))
        error.addElement((self.namespace, self.condition))
        if self.text:
            text = error.addElement((self.namespace, 'text'), content=self.text)
            if self.textLang:
                text[NS_XML, 'lang'] = self.textLang
        if self.appCondition:
            error.addChild(self.appCondition)
        return error