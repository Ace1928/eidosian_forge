from statsmodels.compat.pandas import MONTH_END
from statsmodels.compat.pytest import pytest_warns
import os
import re
import warnings
import numpy as np
from numpy.testing import assert_allclose, assert_almost_equal
import pandas as pd
import pytest
import scipy.stats
from statsmodels.tools.sm_exceptions import ConvergenceWarning, ValueWarning
from statsmodels.tsa.holtwinters import (
from statsmodels.tsa.holtwinters._exponential_smoothers import (
from statsmodels.tsa.holtwinters._smoothers import (
def test_holt_damp_r(self):
    mod = Holt(self.livestock2_livestock, damped_trend=True, initialization_method='estimated')
    params = {'smoothing_level': 0.97402626, 'smoothing_trend': 0.00010006, 'damping_trend': 0.98, 'initial_level': 252.59039965, 'initial_trend': 6.90265918}
    with mod.fix_params(params):
        fit = mod.fit(optimized=False)
    for key in params.keys():
        assert_allclose(fit.params[key], params[key])
    with mod.fix_params(params):
        opt_fit = mod.fit(optimized=True)
    assert_allclose(fit.sse, opt_fit.sse)
    assert_allclose(opt_fit.params['initial_trend'], params['initial_trend'])
    alt_params = {k: v for k, v in params.items() if 'level' not in k}
    with mod.fix_params(alt_params):
        alt_fit = mod.fit(optimized=True)
    assert not np.allclose(alt_fit.trend.iloc[0], opt_fit.trend.iloc[0])
    assert_allclose(fit.sse / mod.nobs, 195.4397924865488, atol=0.001)
    desired = [252.5903996514365, 263.7992355246843, 268.3623324350207, 261.0312983437606, 266.6590942700923, 277.3958197247272, 283.8256217863908, 290.2962560621914, 292.5701438129583, 300.7655919939834, 309.2118057241649, 318.2377698496536, 329.223870936255, 338.7709778307978, 339.3669793596703, 329.0127022356033, 314.7684267018998, 314.5948077575944, 321.3612035017972, 329.6924360833211, 346.0712138652086, 352.2534120008911, 348.5862874190927, 415.8839400693967, 417.2018843196238, 417.8435306633725, 412.4857261252961, 412.0647865321129, 395.2500605270393, 401.4367438266322, 408.1907701386275, 414.1814574903921]
    assert_allclose(np.r_[fit.params['initial_level'], fit.level], desired)
    desired = [6.902659175332394, 6.765062519124909, 6.629548973536494, 6.495537532917715, 6.365550989616566, 6.238702070454378, 6.11396047676353, 5.991730467006233, 5.871526257315264, 5.754346516684953, 5.639547926790058, 5.527116419415724, 5.417146212898857, 5.309238662451385, 5.202580636191761, 5.096941655567694, 4.993026494493987, 4.89264548621041, 4.794995106664251, 4.699468310763351, 4.606688340205792, 4.514725879754355, 4.42360016839124, 4.341595902295941, 4.254462303550087, 4.169010676686062, 4.084660399498803, 4.002512751871354, 3.92033229814673, 3.842166514133902, 3.76563019420026, 3.690553892582855]
    assert_allclose(np.r_[fit.params['initial_trend'], fit.trend], desired, atol=0.001)
    desired = [259.3550056432622, 270.4289967934267, 274.8592904290865, 267.39692512602, 272.8973342399166, 283.5097477537724, 289.8173030536191, 296.1681519198575, 298.3242395451272, 306.4048515803347, 314.7385626924191, 323.654343940681, 334.5326742248959, 343.9740317200002, 344.4655083831382, 334.0077050580596, 319.661592666504, 319.3896003340806, 326.0602987063282, 334.2979150278692, 350.5857684386102, 356.6778433630504, 352.9214155841161, 420.1387040536467, 421.3712573771029, 421.9291611265248, 416.4886933168049, 415.9872490289468, 399.0919861792231, 405.2020670104834, 411.8810877289437]
    assert_allclose(fit.fittedvalues, desired, atol=0.001)
    desired = [417.7982003051233, 421.3426082635598, 424.8161280628277, 428.2201774661102, 431.556145881327, 434.8253949282395, 438.0292589942138, 441.1690457788685, 444.2460368278302, 447.2614880558126]
    assert_allclose(fit.forecast(10), desired, atol=0.0001)