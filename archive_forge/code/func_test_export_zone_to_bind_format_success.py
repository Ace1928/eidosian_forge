import sys
import datetime
import tempfile
from unittest.mock import Mock
from libcloud import __version__
from libcloud.test import unittest
from libcloud.dns.base import Zone, Record, DNSDriver
from libcloud.dns.types import RecordType
from libcloud.utils.py3 import assertRegex
def test_export_zone_to_bind_format_success(self):
    zone = Zone(id=1, domain='example.com', type='master', ttl=900, driver=self.driver)
    mock_records = []
    for values in MOCK_RECORDS_VALUES:
        values = values.copy()
        values['driver'] = self.driver
        values['zone'] = zone
        record = Record(**values)
        mock_records.append(record)
    self.driver.list_records = Mock()
    self.driver.list_records.return_value = mock_records
    now = datetime.datetime.utcnow()
    result = self.driver.export_zone_to_bind_format(zone=zone)
    self.driver.export_zone_to_bind_zone_file(zone=zone, file_path=self.tmp_path)
    with open(self.tmp_path) as fp:
        content = fp.read()
    lines1 = result.split('\n')
    lines2 = content.split('\n')
    date_str = '{}-{}-{} {}:{}:{}'.format(now.year, zero_pad(now.month), zero_pad(now.day), zero_pad(now.hour), zero_pad(now.minute), zero_pad(now.second))
    expected_header = '; Generated by Libcloud v{} on {} UTC'.format(__version__, date_str)
    self.assertEqual(lines1[0], expected_header)
    self.assertEqual(lines2[0], expected_header)
    for lines in [lines1, lines2]:
        self.assertEqual(len(lines), 2 + 1 + 9)
        assertRegex(self, lines[1], '\\$ORIGIN example\\.com\\.')
        assertRegex(self, lines[2], '\\$TTL 900')
        assertRegex(self, lines[4], 'www.example.com\\.\\s+900\\s+IN\\s+A\\s+127\\.0\\.0\\.1')
        assertRegex(self, lines[5], 'www.example.com\\.\\s+900\\s+IN\\s+AAAA\\s+2a01:4f8:121:3121::2')
        assertRegex(self, lines[6], 'www.example.com\\.\\s+123\\s+IN\\s+A\\s+127\\.0\\.0\\.1')
        assertRegex(self, lines[7], 'example.com\\.\\s+900\\s+IN\\s+A\\s+127\\.0\\.0\\.1')
        assertRegex(self, lines[8], 'test1.example.com\\.\\s+900\\s+IN\\s+TXT\\s+"test foo bar"')
        assertRegex(self, lines[9], 'test2.example.com\\.\\s+900\\s+IN\\s+TXT\\s+"test \\\\"foo\\\\" \\\\"bar\\\\""')
        assertRegex(self, lines[10], 'example.com\\.\\s+900\\s+IN\\s+MX\\s+10\\s+mx.example.com')
        assertRegex(self, lines[11], 'example.com\\.\\s+900\\s+IN\\s+SRV\\s+20\\s+10 3333 example.com')