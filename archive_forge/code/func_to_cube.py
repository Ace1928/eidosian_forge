from __future__ import annotations
import itertools
import json
import warnings
from copy import deepcopy
from typing import TYPE_CHECKING
import numpy as np
from monty.io import zopen
from monty.json import MSONable
from scipy.interpolate import RegularGridInterpolator
from pymatgen.core import Element, Site, Structure
from pymatgen.core.units import ang_to_bohr, bohr_to_angstrom
from pymatgen.electronic_structure.core import Spin
def to_cube(self, filename, comment: str=''):
    """
        Write the total volumetric data to a cube file format, which consists of two comment lines,
        a header section defining the structure IN BOHR, and the data.

        Args:
            filename (str): Name of the cube file to be written.
            comment (str): If provided, this will be added to the second comment line
        """
    with zopen(filename, mode='wt') as file:
        file.write(f'# Cube file for {self.structure.formula} generated by Pymatgen\n')
        file.write(f'# {comment}\n')
        file.write(f'\t {len(self.structure)} 0.000000 0.000000 0.000000\n')
        for idx in range(3):
            lattice_matrix = self.structure.lattice.matrix[idx] / self.dim[idx] * ang_to_bohr
            file.write(f'\t {self.dim[idx]} {lattice_matrix[0]:.6f} {lattice_matrix[1]:.6f} {lattice_matrix[2]:.6f}\n')
        for site in self.structure:
            file.write(f'\t {Element(site.species_string).Z} 0.000000 {ang_to_bohr * site.coords[0]} {ang_to_bohr * site.coords[1]} {ang_to_bohr * site.coords[2]} \n')
        for idx, dat in enumerate(self.data['total'].flatten(), start=1):
            file.write(f'{(' ' if dat > 0 else '')}{dat:.6e} ')
            if idx % 6 == 0:
                file.write('\n')