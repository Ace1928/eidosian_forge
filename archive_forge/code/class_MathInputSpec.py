import glob
import os
import os.path
import re
import warnings
from ..base import (
from .base import aggregate_filename
class MathInputSpec(CommandLineInputSpec):
    _xor_input_files = ('input_files', 'filelist')
    input_files = InputMultiPath(File(exists=True), desc='input file(s) for calculation', mandatory=True, sep=' ', argstr='%s', position=-2, xor=_xor_input_files)
    output_file = File(desc='output file', argstr='%s', genfile=True, position=-1, name_source=['input_files'], hash_files=False, name_template='%s_mincmath.mnc')
    filelist = File(desc='Specify the name of a file containing input file names.', argstr='-filelist %s', exists=True, mandatory=True, xor=_xor_input_files)
    clobber = traits.Bool(desc='Overwrite existing file.', argstr='-clobber', usedefault=True, default_value=True)
    two = traits.Bool(desc='Create a MINC 2 output file.', argstr='-2')
    _xor_copy_header = ('copy_header', 'no_copy_header')
    copy_header = traits.Bool(desc='Copy all of the header from the first file (default for one file).', argstr='-copy_header', xor=_xor_copy_header)
    no_copy_header = traits.Bool(desc='Do not copy all of the header from the first file (default for many files)).', argstr='-nocopy_header', xor=_xor_copy_header)
    _xor_format = ('format_filetype', 'format_byte', 'format_short', 'format_int', 'format_long', 'format_float', 'format_double', 'format_signed', 'format_unsigned')
    format_filetype = traits.Bool(desc='Use data type of first file (default).', argstr='-filetype', xor=_xor_format)
    format_byte = traits.Bool(desc='Write out byte data.', argstr='-byte', xor=_xor_format)
    format_short = traits.Bool(desc='Write out short integer data.', argstr='-short', xor=_xor_format)
    format_int = traits.Bool(desc='Write out 32-bit integer data.', argstr='-int', xor=_xor_format)
    format_long = traits.Bool(desc='Superseded by -int.', argstr='-long', xor=_xor_format)
    format_float = traits.Bool(desc='Write out single-precision floating-point data.', argstr='-float', xor=_xor_format)
    format_double = traits.Bool(desc='Write out double-precision floating-point data.', argstr='-double', xor=_xor_format)
    format_signed = traits.Bool(desc='Write signed integer data.', argstr='-signed', xor=_xor_format)
    format_unsigned = traits.Bool(desc='Write unsigned integer data (default).', argstr='-unsigned', xor=_xor_format)
    voxel_range = traits.Tuple(traits.Int, traits.Int, argstr='-range %d %d', desc='Valid range for output data.')
    max_buffer_size_in_kb = traits.Range(low=0, desc='Specify the maximum size of the internal buffers (in kbytes).', value=4096, usedefault=True, argstr='-max_buffer_size_in_kb %d')
    _xor_check_dimensions = ('check_dimensions', 'no_check_dimensions')
    check_dimensions = traits.Bool(desc='Check that dimension info matches across files (default).', argstr='-check_dimensions', xor=_xor_check_dimensions)
    no_check_dimensions = traits.Bool(desc='Do not check dimension info.', argstr='-nocheck_dimensions', xor=_xor_check_dimensions)
    dimension = traits.Str(desc='Specify a dimension along which we wish to perform a calculation.', argstr='-dimension %s')
    ignore_nan = traits.Bool(desc='Ignore invalid data (NaN) for accumulations.', argstr='-ignore_nan')
    propagate_nan = traits.Bool(desc='Invalid data in any file at a voxel produces a NaN (default).', argstr='-propagate_nan')
    _xor_nan_zero_illegal = ('output_nan', 'output_zero', 'output_illegal_value')
    output_nan = traits.Bool(desc='Output NaN when an illegal operation is done (default).', argstr='-nan', xor=_xor_nan_zero_illegal)
    output_zero = traits.Bool(desc='Output zero when an illegal operation is done.', argstr='-zero', xor=_xor_nan_zero_illegal)
    output_illegal = traits.Bool(desc='Value to write out when an illegal operationis done. Default value: 1.79769e+308', argstr='-illegal_value', xor=_xor_nan_zero_illegal)
    bool_or_const_traits = ['test_gt', 'test_lt', 'test_eq', 'test_ne', 'test_ge', 'test_le', 'calc_add', 'calc_sub', 'calc_mul', 'calc_div']
    test_gt = traits.Either(traits.Bool(), traits.Float(), desc='Test for vol1 > vol2 or vol1 > constant.', argstr='-gt')
    test_lt = traits.Either(traits.Bool(), traits.Float(), desc='Test for vol1 < vol2 or vol1 < constant.', argstr='-lt')
    test_eq = traits.Either(traits.Bool(), traits.Float(), desc='Test for integer vol1 == vol2 or vol1 == constant.', argstr='-eq')
    test_ne = traits.Either(traits.Bool(), traits.Float(), desc='Test for integer vol1 != vol2 or vol1 != const.', argstr='-ne')
    test_ge = traits.Either(traits.Bool(), traits.Float(), desc='Test for vol1 >= vol2 or vol1 >= const.', argstr='-ge')
    test_le = traits.Either(traits.Bool(), traits.Float(), desc='Test for vol1 <= vol2 or vol1 <= const.', argstr='-le')
    calc_add = traits.Either(traits.Bool(), traits.Float(), desc='Add N volumes or volume + constant.', argstr='-add')
    calc_sub = traits.Either(traits.Bool(), traits.Float(), desc='Subtract 2 volumes or volume - constant.', argstr='-sub')
    calc_mul = traits.Either(traits.Bool(), traits.Float(), desc='Multiply N volumes or volume * constant.', argstr='-mult')
    calc_div = traits.Either(traits.Bool(), traits.Float(), desc='Divide 2 volumes or volume / constant.', argstr='-div')
    single_volume_traits = ['invert', 'calc_not', 'sqrt', 'square', 'abs', 'exp', 'log', 'scale', 'clamp', 'segment', 'nsegment', 'isnan', 'isnan']
    invert = traits.Either(traits.Float(), desc='Calculate 1/c.', argstr='-invert -const %s')
    calc_not = traits.Bool(desc='Calculate !vol1.', argstr='-not')
    sqrt = traits.Bool(desc='Take square root of a volume.', argstr='-sqrt')
    square = traits.Bool(desc='Take square of a volume.', argstr='-square')
    abs = traits.Bool(desc='Take absolute value of a volume.', argstr='-abs')
    exp = traits.Tuple(traits.Float, traits.Float, argstr='-exp -const2 %s %s', desc='Calculate c2*exp(c1*x). Both constants must be specified.')
    log = traits.Tuple(traits.Float, traits.Float, argstr='-log -const2 %s %s', desc='Calculate log(x/c2)/c1. The constants c1 and c2 default to 1.')
    scale = traits.Tuple(traits.Float, traits.Float, argstr='-scale -const2 %s %s', desc='Scale a volume: volume * c1 + c2.')
    clamp = traits.Tuple(traits.Float, traits.Float, argstr='-clamp -const2 %s %s', desc='Clamp a volume to lie between two values.')
    segment = traits.Tuple(traits.Float, traits.Float, argstr='-segment -const2 %s %s', desc='Segment a volume using range of -const2: within range = 1, outside range = 0.')
    nsegment = traits.Tuple(traits.Float, traits.Float, argstr='-nsegment -const2 %s %s', desc='Opposite of -segment: within range = 0, outside range = 1.')
    isnan = traits.Bool(desc='Test for NaN values in vol1.', argstr='-isnan')
    nisnan = traits.Bool(desc='Negation of -isnan.', argstr='-nisnan')
    two_volume_traits = ['percentdiff']
    percentdiff = traits.Float(desc='Percent difference between 2 volumes, thresholded (const def=0.0).', argstr='-percentdiff')
    n_volume_traits = ['count_valid', 'maximum', 'minimum', 'calc_add', 'calc_or']
    count_valid = traits.Bool(desc='Count the number of valid values in N volumes.', argstr='-count_valid')
    maximum = traits.Bool(desc='Find maximum of N volumes.', argstr='-maximum')
    minimum = traits.Bool(desc='Find minimum of N volumes.', argstr='-minimum')
    calc_and = traits.Bool(desc='Calculate vol1 && vol2 (&& ...).', argstr='-and')
    calc_or = traits.Bool(desc='Calculate vol1 || vol2 (|| ...).', argstr='-or')