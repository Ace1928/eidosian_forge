import warnings
import numpy as np
import pytest
from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import FunctionTransformer, StandardScaler
from sklearn.preprocessing._function_transformer import _get_adapter_from_container
from sklearn.utils._testing import (
from sklearn.utils.fixes import CSC_CONTAINERS, CSR_CONTAINERS
@pytest.mark.parametrize('dataframe_lib', ['pandas', 'polars'])
@pytest.mark.parametrize('feature_names_out', ['one-to-one', lambda _, names: [f'{name}_log' for name in names]])
def test_function_transformer_error_column_inconsistent(dataframe_lib, feature_names_out):
    """Check that we raise an error when `func` returns a dataframe with new
    column names that become inconsistent with `get_feature_names_out`."""
    lib = pytest.importorskip(dataframe_lib)
    df = lib.DataFrame({'a': [1, 2, 3], 'b': [10, 20, 100]})

    def func(df):
        if dataframe_lib == 'pandas':
            return df.rename(columns={'a': 'c'})
        else:
            return df.rename({'a': 'c'})
    transformer = FunctionTransformer(func=func, feature_names_out=feature_names_out)
    err_msg = 'The output generated by `func` have different column names'
    with pytest.raises(ValueError, match=err_msg):
        transformer.fit_transform(df).columns