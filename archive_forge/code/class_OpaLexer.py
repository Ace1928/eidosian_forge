import re
from pygments.lexer import RegexLexer, include, bygroups, default, words
from pygments.token import Text, Comment, Operator, Keyword, Name, String, \
class OpaLexer(RegexLexer):
    """
    Lexer for the Opa language (http://opalang.org).

    .. versionadded:: 1.5
    """
    name = 'Opa'
    aliases = ['opa']
    filenames = ['*.opa']
    mimetypes = ['text/x-opa']
    keywords = ('and', 'as', 'begin', 'case', 'client', 'css', 'database', 'db', 'do', 'else', 'end', 'external', 'forall', 'function', 'if', 'import', 'match', 'module', 'or', 'package', 'parser', 'rec', 'server', 'then', 'type', 'val', 'with', 'xml_parser')
    ident_re = '(([a-zA-Z_]\\w*)|(`[^`]*`))'
    op_re = '[.=\\-<>,@~%/+?*&^!]'
    punc_re = '[()\\[\\],;|]'
    tokens = {'escape-sequence': [('\\\\[\\\\"\\\'ntr}]', String.Escape), ('\\\\[0-9]{3}', String.Escape), ('\\\\x[0-9a-fA-F]{2}', String.Escape)], 'comments': [('/\\*', Comment, 'nested-comment'), ('//.*?$', Comment)], 'comments-and-spaces': [include('comments'), ('\\s+', Text)], 'root': [include('comments-and-spaces'), (words(keywords, prefix='\\b', suffix='\\b'), Keyword), ('@' + ident_re + '\\b', Name.Builtin.Pseudo), ('-?.[\\d]+([eE][+\\-]?\\d+)', Number.Float), ('-?\\d+.\\d*([eE][+\\-]?\\d+)', Number.Float), ('-?\\d+[eE][+\\-]?\\d+', Number.Float), ('0[xX][\\da-fA-F]+', Number.Hex), ('0[oO][0-7]+', Number.Oct), ('0[bB][01]+', Number.Bin), ('\\d+', Number.Integer), ('#[\\da-fA-F]{3,6}', Number.Integer), ('"', String.Double, 'string'), ('\'(?:(\\\\[\\\\\\"\'ntbr ])|(\\\\[0-9]{3})|(\\\\x[0-9a-fA-F]{2})|.)\'', String.Char), ('\\{', Operator, '#push'), ('\\}', Operator, '#pop'), ('<(?=[a-zA-Z>])', String.Single, 'html-open-tag'), ('[@?!]?(/\\w+)+(\\[_\\])?', Name.Variable), ('<-(?!' + op_re + ')', Name.Variable), ('\\b([A-Z]\\w*)(?=\\.)', Name.Namespace), ('=(?!' + op_re + ')', Keyword), ('(%s)+' % op_re, Operator), ('(%s)+' % punc_re, Operator), (':', Operator, 'type'), ("'" + ident_re, Keyword.Type), ('#' + ident_re, String.Single), ('#(?=\\{)', String.Single), (ident_re, Text)], 'type': [include('comments-and-spaces'), ('->', Keyword.Type), default(('#pop', 'type-lhs-1', 'type-with-slash'))], 'type-1': [include('comments-and-spaces'), ('\\(', Keyword.Type, ('#pop', 'type-tuple')), ('~?\\{', Keyword.Type, ('#pop', 'type-record')), (ident_re + '\\(', Keyword.Type, ('#pop', 'type-tuple')), (ident_re, Keyword.Type, '#pop'), ("'" + ident_re, Keyword.Type), default('#pop')], 'type-with-slash': [include('comments-and-spaces'), default(('#pop', 'slash-type-1', 'type-1'))], 'slash-type-1': [include('comments-and-spaces'), ('/', Keyword.Type, ('#pop', 'type-1')), default('#pop')], 'type-lhs-1': [include('comments-and-spaces'), ('->', Keyword.Type, ('#pop', 'type')), ('(?=,)', Keyword.Type, ('#pop', 'type-arrow')), default('#pop')], 'type-arrow': [include('comments-and-spaces'), (',(?=[^:]*?->)', Keyword.Type, 'type-with-slash'), ('->', Keyword.Type, ('#pop', 'type')), default('#pop')], 'type-tuple': [include('comments-and-spaces'), ('[^()/*]+', Keyword.Type), ('[/*]', Keyword.Type), ('\\(', Keyword.Type, '#push'), ('\\)', Keyword.Type, '#pop')], 'type-record': [include('comments-and-spaces'), ('[^{}/*]+', Keyword.Type), ('[/*]', Keyword.Type), ('\\{', Keyword.Type, '#push'), ('\\}', Keyword.Type, '#pop')], 'nested-comment': [('[^/*]+', Comment), ('/\\*', Comment, '#push'), ('\\*/', Comment, '#pop'), ('[/*]', Comment)], 'string': [('[^\\\\"{]+', String.Double), ('"', String.Double, '#pop'), ('\\{', Operator, 'root'), include('escape-sequence')], 'single-string': [("[^\\\\\\'{]+", String.Double), ("\\'", String.Double, '#pop'), ('\\{', Operator, 'root'), include('escape-sequence')], 'html-open-tag': [('[\\w\\-:]+', String.Single, ('#pop', 'html-attr')), ('>', String.Single, ('#pop', 'html-content'))], 'html-end-tag': [('[\\w\\-:]*>', String.Single, '#pop')], 'html-attr': [('\\s+', Text), ('[\\w\\-:]+=', String.Single, 'html-attr-value'), ('/>', String.Single, '#pop'), ('>', String.Single, ('#pop', 'html-content'))], 'html-attr-value': [("'", String.Single, ('#pop', 'single-string')), ('"', String.Single, ('#pop', 'string')), ('#' + ident_re, String.Single, '#pop'), ('#(?=\\{)', String.Single, ('#pop', 'root')), ('[^"\\\'{`=<>]+', String.Single, '#pop'), ('\\{', Operator, ('#pop', 'root'))], 'html-content': [('<!--', Comment, 'html-comment'), ('</', String.Single, ('#pop', 'html-end-tag')), ('<', String.Single, 'html-open-tag'), ('\\{', Operator, 'root'), ('[^<{]+', String.Single)], 'html-comment': [('-->', Comment, '#pop'), ('[^\\-]+|-', Comment)]}