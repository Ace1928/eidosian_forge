import pandas as pd
import sqlite3
import math
import numpy as np
from typing import List, Dict, Any
import yfinance as yf
import yfinance as yf
import pandas as pd
import sqlite3
def initialize_database(self):
    """Create tables if they do not exist."""
    tables = {'Market_Data': '\n                CREATE TABLE IF NOT EXISTS Market_Data (\n                    ticker TEXT,\n                    date TEXT,\n                    open REAL,\n                    high REAL,\n                    low REAL,\n                    close REAL,\n                    volume INTEGER\n                )\n            ', 'Adjusted_Market_Data': '\n                CREATE TABLE IF NOT EXISTS Adjusted_Market_Data (\n                    ticker TEXT,\n                    adjusted_close REAL,\n                    adjusted_volume INTEGER\n                )\n            ', 'Dividends_Splits': '\n                CREATE TABLE IF NOT EXISTS Dividends_Splits (\n                    ticker TEXT,\n                    dividends REAL,\n                    stock_splits REAL\n                )\n            ', 'Moving_Averages': '\n                CREATE TABLE IF NOT EXISTS Moving_Averages (\n                    ticker TEXT,\n                    ma_5 REAL,  -- Moving Average 5\n                    ma_15 REAL,  -- Moving Average 15\n                    ma_50 REAL,  -- Moving Average 50\n                    ma_200 REAL,  -- Moving Average 200\n                    ma_365 REAL,  -- Moving Average 365\n                    ema_5 REAL,  -- Exponential Moving Average 5\n                    ema_15 REAL,  -- Exponential Moving Average 15\n                    ema_50 REAL,  -- Exponential Moving Average 50\n                    ema_200 REAL,  -- Exponential Moving Average 200\n                    ema_365 REAL,  -- Exponential Moving Average 365\n                    mma_5 REAL,  -- Multiface Moving Average 5\n                    mma_15 REAL,  -- Multiface Moving Average 15\n                    mma_50 REAL,  -- Multiface Moving Average 50\n                    mma_200 REAL,  -- Multiface Moving Average 200\n                    mma_365 REAL,  -- Multiface Moving Average 365\n                    tema_5 REAL,  -- Triple Exponential Moving Average 5\n                    tema_15 REAL,  -- Triple Exponential Moving Average 15\n                    tema_50 REAL,  -- Triple Exponential Moving Average 50\n                    tema_200 REAL,  -- Triple Exponential Moving Average 200\n                    tema_365 REAL  -- Triple Exponential Moving Average 365\n                )\n            ', 'Oscillators_Momentum': "\n                CREATE TABLE IF NOT EXISTS Oscillators_Momentum (\n                    ticker TEXT,\n                    rsi REAL,  -- Relative Strength Index (RSI)\n                    mfi REAL,  -- Money Flow Index (MFI)\n                    tsi REAL,  -- True Strength Index (TSI)\n                    uo REAL,  -- Ultimate Oscillator (UO)\n                    stoch_rsi REAL,  -- Stochastic RSI\n                    stoch_rsi_k REAL,  -- Stochastic RSI %K\n                    stoch_rsi_d REAL,  -- Stochastic RSI %D\n                    wr REAL,  -- Williams %R\n                    ao REAL,  -- Awesome Oscillator\n                    kama REAL,  -- Kaufman's Adaptive Moving Average (KAMA)\n                    ppo REAL,  -- Percentage Price Oscillator (PPO)\n                    ppo_signal REAL,  -- PPO Signal Line\n                    ppo_hist REAL,  -- PPO Histogram\n                    pvo REAL,  -- Percentage Volume Oscillator (PVO)\n                    pvo_signal REAL,  -- PVO Signal Line\n                    pvo_hist REAL,  -- PVO Histogram\n                    roc REAL,  -- Rate of Change (ROC)\n                    roc_100 REAL,  -- Rate of Change (ROC) 100\n                    roc_100_sma REAL  -- Rate of Change (ROC) 100 Simple Moving Average (SMA)\n                )\n            ", 'Volatility_Indicators': '\n                CREATE TABLE IF NOT EXISTS Volatility_Indicators (\n                    ticker TEXT,\n                    bollinger_bands REAL,  -- Bollinger Bands\n                    bollinger_bands_upper REAL,  -- Bollinger Bands Upper Band\n                    bollinger_bands_lower REAL,  -- Bollinger Bands Lower Band\n                    bollinger_bands_middle REAL,  -- Bollinger Bands Middle Band\n                    keltner_channels REAL,  -- Keltner Channels\n                    keltner_channels_upper REAL,  -- Keltner Channels Upper Band\n                    keltner_channels_lower REAL,  -- Keltner Channels Lower Band\n                    keltner_channels_middle REAL,  -- Keltner Channels Middle Band\n                    donchian_channels REAL,  -- Donchian Channels\n                    donchian_channels_upper REAL,  -- Donchian Channels Upper Band\n                    donchian_channels_lower REAL,  -- Donchian Channels Lower Band\n                    donchian_channels_middle REAL,  -- Donchian Channels Middle Band\n                    atr REAL,  -- ATR(Average True Range)\n                    true_range REAL,  -- True Range\n                    natr REAL  -- NATR(Normalized Average True Range)\n                )\n            ', 'Volume_Indicators': '\n                CREATE TABLE IF NOT EXISTS Volume_Indicators (\n                    ticker TEXT,\n                    adi REAL,  -- ADI(Accumulation Distribution Index)\n                    obv REAL,  -- OBV(On Balance Volume)\n                    cmf REAL,  -- CMF(Chaikin Money Flow)\n                    fi REAL,  -- FI(Force Index)\n                    em REAL,  -- EM(Ease of Movement)\n                    sma_em REAL,  -- SMA(Simple Moving Average) Ease of Movement\n                    vpt REAL,  -- VPT(Volume Price Trend)\n                    nvi REAL,  -- NVI(Negative Volume Index)\n                    vwap REAL  -- VWAP(Volume Weighted Average Price)\n                )\n            ', 'Trend_Indicators': '\n                CREATE TABLE IF NOT EXISTS Trend_Indicators (\n                    ticker TEXT,\n                    parabolic_sar REAL, -- Parabolic SAR\n                    directional_movement_index REAL, -- Directional Movement Index\n                    minus_directional_indicator REAL, -- Minus Directional Indicator\n                    plus_directional_indicator REAL, -- Plus Directional Indicator\n                    average_directional_index REAL, -- Average Directional Index\n                    adx REAL,  -- ADX\n                    adx_pos_di REAL,  -- ADX Positive DI\n                    adx_neg_di REAL,  -- ADX Negative DI\n                    cci REAL,  -- CCI\n                    macd REAL,  -- MACD\n                    macd_signal REAL,  -- MACD Signal Line\n                    macd_diff REAL,  -- MACD Difference\n                    ema_fast REAL,  -- EMA Fast\n                    ema_slow REAL,  -- EMA Slow\n                    ichimoku_a REAL,  -- Ichimoku A\n                    ichimoku_b REAL,  -- Ichimoku B\n                    ichimoku_base_line REAL,  -- Ichimoku Base Line\n                    ichimoku_conversion_line REAL,  -- Ichimoku Conversion Line\n                    kst REAL,  -- KST\n                    kst_sig REAL,  -- KST Signal Line\n                    kst_diff REAL,  -- KST Difference\n                    psar REAL,  -- PSAR\n                    psar_up_indicator REAL,  -- PSAR Up Indicator\n                    psar_down_indicator REAL,  -- PSAR Down Indicator\n                    stc REAL,  -- STC\n                    trix REAL,  -- Trix\n                    vortex_ind_pos REAL,  -- Vortex Indicator Positive DI\n                    vortex_ind_neg REAL,  -- Vortex Indicator Negative DI\n                    vortex_ind_diff REAL  -- Vortex Indicator Difference\n                )\n            ', 'Price_Patterns_Candlesticks': '\n                CREATE TABLE IF NOT EXISTS Price_Patterns_Candlesticks (\n                    ticker TEXT,\n                    cdl_2_crows REAL,  -- CDL 2 Crows\n                    cdl_3_black_crows REAL,  -- CDL 3 Black Crows\n                    cdl_3_inside REAL,  -- CDL 3 Inside\n                    cdl_3_line_strike REAL,  -- CDL 3 Line Strike\n                    cdl_3_outside REAL,  -- CDL 3 Outside\n                    cdl_3_stars_in_south REAL,  -- CDL 3 Stars In South\n                    cdl_3_white_soldiers REAL,  -- CDL 3 White Soldiers\n                    cdl_abandoned_baby REAL,  -- CDL Abandoned Baby\n                    cdl_advance_block REAL,  -- CDL Advance Block\n                    cdl_belt_hold REAL,  -- CDL Belt Hold\n                    cdl_breakaway REAL,  -- CDL Breakaway\n                    cdl_closing_marubozu REAL,  -- CDL Closing Marubozu\n                    cdl_conceal_baby_swall REAL,  -- CDL Conceal Baby Swall\n                    cdl_counterattack REAL,  -- CDL Counterattack\n                    cdl_dark_cloud_cover REAL,  -- CDL Dark Cloud Cover\n                    cdl_doji REAL,  -- CDL Doji\n                    cdl_doji_star REAL,  -- CDL Doji Star\n                    cdl_dragonfly_doji REAL,  -- CDL Dragonfly Doji\n                    cdl_engulfing REAL,  -- CDL Engulfing\n                    cdl_evening_doji_star REAL,  -- CDL Evening Doji Star\n                    cdl_evening_star REAL,  -- CDL Evening Star\n                    cdl_gap_side_side_white REAL,  -- CDL Gap Side Side White\n                    cdl_gravestone_doji REAL,  -- CDL Gravestone Doji\n                    cdl_hammer REAL,  -- CDL Hammer\n                    cdl_hanging_man REAL,  -- CDL Hanging Man\n                    cdl_harami REAL,  -- CDL Harami\n                    cdl_harami_cross REAL,  -- CDL Harami Cross\n                    cdl_high_wave REAL,  -- CDL High Wave\n                    cdl_hikkake REAL,  -- CDL Hikkake\n                    cdl_hikkake_modified REAL,  -- CDL Hikkake Modified\n                    cdl_homing_pigeon REAL,  -- CDL Homing Pigeon\n                    cdl_identical_3_crows REAL,  -- CDL Identical 3 Crows\n                    cdl_in_neck REAL,  -- CDL In Neck\n                    cdl_inverted_hammer REAL,  -- CDL Inverted Hammer\n                    cdl_kicking REAL,  -- CDL Kicking\n                    cdl_kicking_by_length REAL,  -- CDL Kicking By Length\n                    cdl_ladder_bottom REAL,  -- CDL Ladder Bottom\n                    cdl_long_legged_doji REAL,  -- CDL Long Legged Doji\n                    cdl_long_line REAL,  -- CDL Long Line\n                    cdl_marubozu REAL,  -- CDL Marubozu\n                    cdl_matching_low REAL,  -- CDL Matching Low\n                    cdl_mat_hold REAL,  -- CDL Mat Hold\n                    cdl_morning_doji_star REAL,  -- CDL Morning Doji Star\n                    cdl_morning_star REAL,  -- CDL Morning Star\n                    cdl_on_neck REAL,  -- CDL On Neck\n                    cdl_piercing REAL,  -- CDL Piercing\n                    cdl_rickshaw_man REAL,  -- CDL Rickshaw Man\n                    cdl_rise_fall_3_methods REAL,  -- CDL Rise Fall 3 Methods\n                    cdl_separating_lines REAL,  -- CDL Separating Lines\n                    cdl_shooting_star REAL,  -- CDL Shooting Star\n                    cdl_short_line REAL,  -- CDL Short Line\n                    cdl_spinning_top REAL,  -- CDL Spinning Top\n                    cdl_stalled_pattern REAL,  -- CDL Stalled Pattern\n                    cdl_stick_sandwich REAL,  -- CDL Stick Sandwich\n                    cdl_takuri REAL,  -- CDL Takuri\n                    cdl_tasuki_gap REAL,  -- CDL Tasuki Gap\n                    cdl_thrusting REAL,  -- CDL Thrusting\n                    cdl_tristar REAL,  -- CDL Tristar\n                    cdl_unique_3_river REAL,  -- CDL Unique 3 River\n                    cdl_upside_gap_2_crows REAL,  -- CDL Upside Gap 2 Crows\n                    cdl_x_side_gap_3_methods REAL  -- CDL X Side Gap 3 Methods\n                )\n            ', 'Advanced_Statistical_Measures': '\n                CREATE TABLE IF NOT EXISTS Advanced_Statistical_Measures (\n                    ticker TEXT,\n                    beta REAL,  -- Beta\n                    correlation_coefficient REAL,  -- Correlation Coefficient\n                    linear_regression_angle REAL,  -- Linear Regression Angle\n                    linear_regression_intercept REAL,  -- Linear Regression Intercept\n                    linear_regression_slope REAL,  -- Linear Regression Slope\n                    standard_deviation REAL,  -- Standard Deviation\n                    standard_error REAL,  -- Standard Error\n                    time_series_forecast REAL,  -- Time Series Forecast\n                    variance REAL  -- Variance\n                )\n            ', 'Math_Transformations': '\n                CREATE TABLE IF NOT EXISTS Math_Transformations (\n                    ticker TEXT,\n                    transform_acos REAL,  -- Transform ACOS\n                    transform_asin REAL,  -- Transform ASIN\n                    transform_atan REAL,  -- Transform ATAN\n                    transform_ceil REAL,  -- Transform CEIL\n                    transform_cos REAL,  -- Transform COS\n                    transform_cosh REAL,  -- Transform COSH\n                    transform_exp REAL,  -- Transform EXP\n                    transform_floor REAL,  -- Transform FLOOR\n                    transform_ln REAL,  -- Transform LN\n                    transform_log10 REAL,  -- Transform LOG10\n                    transform_sin REAL,  -- Transform SIN\n                    transform_sinh REAL,  -- Transform SINH\n                    transform_sqrt REAL,  -- Transform SQRT\n                    transform_tan REAL  -- Transform TAN\n                )\n            ', 'Corporate_Events': '\n                CREATE TABLE IF NOT EXISTS Corporate_Events (\n                    ticker TEXT,\n                    event_type TEXT,  -- Event Type (e.g., earnings release, product launch)\n                    event_date TEXT,  -- Date of the Event\n                    impact_score REAL  -- Quantitative Measure of Expected Impact\n                )\n            ', 'Market_Sentiment': '\n                CREATE TABLE IF NOT EXISTS Market_Sentiment (\n                    ticker TEXT,\n                    sentiment_score REAL,  -- Sentiment Score\n                    sentiment_volume INTEGER,  -- Sentiment Volume\n                    date TEXT  -- Date of the Sentiment\n                )\n            ', 'Risk_Metrics': '\n                CREATE TABLE IF NOT EXISTS Risk_Metrics (\n                    ticker TEXT,\n                    beta REAL,  -- Beta\n                    alpha REAL,  -- Alpha\n                    sharpe_ratio REAL,  -- Sharpe Ratio\n                    sortino_ratio REAL,  -- Sortino Ratio\n                    date TEXT  -- Date of the Risk Metrics\n                )\n            ', 'Trading_Sessions': '\n                CREATE TABLE IF NOT EXISTS Trading_Sessions (\n                    ticker TEXT,\n                    session_date TEXT,  -- Date of the Trading Session\n                    open_price REAL,  -- Opening Price\n                    close_price REAL,  -- Closing Price\n                    session_high REAL,  -- Highest Price During the Session\n                    session_low REAL,  -- Lowest Price During the Session\n                    transaction_volume INTEGER  -- Volume of Transactions During the Session\n                )\n            ', 'Derivatives_Options': '\n                CREATE TABLE IF NOT EXISTS Derivatives_Options (\n                    ticker TEXT,\n                    option_type TEXT,  -- Call or Put\n                    strike_price REAL,  -- Price at Which the Option Can be Exercised\n                    expiration_date TEXT,  -- Date When the Option Expires\n                    open_interest INTEGER,  -- Number of Open Contracts\n                    implied_volatility REAL  -- Measure of Expected Volatility\n                )\n            ', 'Sector_Industry': '\n                CREATE TABLE IF NOT EXISTS Sector_Industry (\n                    ticker TEXT,\n                    sector TEXT,  -- Sector of the Stock\n                    industry TEXT,  -- Industry of the Stock\n                    market_cap REAL,  -- Market Capitalization\n                    employee_count INTEGER  -- Number of Employees\n                )\n            ', 'Financial_Ratios': '\n                CREATE TABLE IF NOT EXISTS Financial_Ratios (\n                    ticker TEXT,\n                    price_to_earnings REAL,  -- Price-to-Earnings Ratio\n                    return_on_equity REAL,  -- Return on Equity\n                    debt_to_equity REAL,  -- Debt-to-Equity Ratio\n                    current_ratio REAL,  -- Current Ratio\n                    date TEXT  -- Date of the Financial Ratios\n                )\n            '}
    for table, query in tables.items():
        self.execute_query(query)