import copy
import re
import threading
import time
import warnings
import typing
from itertools import chain
from aiokeydb.v1.parsers import (
from aiokeydb.v1.commands import (
from aiokeydb.v1.connection import ConnectionPool, SSLConnection, UnixDomainSocketConnection
from aiokeydb.v1.exceptions import (
from aiokeydb.v1.lock import Lock
from aiokeydb.v1.utils import safe_str
from aiokeydb.v1.credentials import CredentialProvider
from aiokeydb.v1.retry import Retry
class AbstractKeyDB:
    RESPONSE_CALLBACKS = {**string_keys_to_dict('AUTH COPY EXPIRE EXPIREAT PEXPIRE PEXPIREAT HEXISTS HMSET MOVE MSETNX PERSIST PSETEX RENAMENX SISMEMBER SMOVE SETEX SETNX', bool), **string_keys_to_dict('BITCOUNT BITPOS DECRBY DEL EXISTS GEOADD GETBIT HDEL HLEN HSTRLEN INCRBY LINSERT LLEN LPUSHX PFADD PFCOUNT RPUSHX SADD SCARD SDIFFSTORE SETBIT SETRANGE SINTERSTORE SREM STRLEN SUNIONSTORE UNLINK XACK XDEL XLEN XTRIM ZCARD ZLEXCOUNT ZREM ZREMRANGEBYLEX ZREMRANGEBYRANK ZREMRANGEBYSCORE', int), **string_keys_to_dict('INCRBYFLOAT HINCRBYFLOAT', float), **string_keys_to_dict('LPUSH RPUSH', lambda r: isinstance(r, int) and r or str_if_bytes(r) == 'OK'), **string_keys_to_dict('SORT', sort_return_tuples), **string_keys_to_dict('ZSCORE ZINCRBY GEODIST', float_or_none), **string_keys_to_dict('FLUSHALL FLUSHDB LSET LTRIM MSET PFMERGE ASKING READONLY READWRITE RENAME SAVE SELECT SHUTDOWN SLAVEOF SWAPDB WATCH UNWATCH ', bool_ok), **string_keys_to_dict('BLPOP BRPOP', lambda r: r and tuple(r) or None), **string_keys_to_dict('SDIFF SINTER SMEMBERS SUNION', lambda r: r and set(r) or set()), **string_keys_to_dict('ZPOPMAX ZPOPMIN ZINTER ZDIFF ZUNION ZRANGE ZRANGEBYSCORE ZREVRANGE ZREVRANGEBYSCORE', zset_score_pairs), **string_keys_to_dict('BZPOPMIN BZPOPMAX', lambda r: r and (r[0], r[1], float(r[2])) or None), **string_keys_to_dict('ZRANK ZREVRANK', int_or_none), **string_keys_to_dict('XREVRANGE XRANGE', parse_stream_list), **string_keys_to_dict('XREAD XREADGROUP', parse_xread), **string_keys_to_dict('BGREWRITEAOF BGSAVE', lambda r: True), 'ACL CAT': lambda r: list(map(str_if_bytes, r)), 'ACL DELUSER': int, 'ACL GENPASS': str_if_bytes, 'ACL GETUSER': parse_acl_getuser, 'ACL HELP': lambda r: list(map(str_if_bytes, r)), 'ACL LIST': lambda r: list(map(str_if_bytes, r)), 'ACL LOAD': bool_ok, 'ACL LOG': parse_acl_log, 'ACL SAVE': bool_ok, 'ACL SETUSER': bool_ok, 'ACL USERS': lambda r: list(map(str_if_bytes, r)), 'ACL WHOAMI': str_if_bytes, 'CLIENT GETNAME': str_if_bytes, 'CLIENT ID': int, 'CLIENT KILL': parse_client_kill, 'CLIENT LIST': parse_client_list, 'CLIENT INFO': parse_client_info, 'CLIENT SETNAME': bool_ok, 'CLIENT UNBLOCK': lambda r: r and int(r) == 1 or False, 'CLIENT PAUSE': bool_ok, 'CLIENT GETREDIR': int, 'CLIENT TRACKINGINFO': lambda r: list(map(str_if_bytes, r)), 'CLUSTER ADDSLOTS': bool_ok, 'CLUSTER ADDSLOTSRANGE': bool_ok, 'CLUSTER COUNT-FAILURE-REPORTS': lambda x: int(x), 'CLUSTER COUNTKEYSINSLOT': lambda x: int(x), 'CLUSTER DELSLOTS': bool_ok, 'CLUSTER DELSLOTSRANGE': bool_ok, 'CLUSTER FAILOVER': bool_ok, 'CLUSTER FORGET': bool_ok, 'CLUSTER GETKEYSINSLOT': lambda r: list(map(str_if_bytes, r)), 'CLUSTER INFO': parse_cluster_info, 'CLUSTER KEYSLOT': lambda x: int(x), 'CLUSTER MEET': bool_ok, 'CLUSTER NODES': parse_cluster_nodes, 'CLUSTER REPLICAS': parse_cluster_nodes, 'CLUSTER REPLICATE': bool_ok, 'CLUSTER RESET': bool_ok, 'CLUSTER SAVECONFIG': bool_ok, 'CLUSTER SET-CONFIG-EPOCH': bool_ok, 'CLUSTER SETSLOT': bool_ok, 'CLUSTER SLAVES': parse_cluster_nodes, 'COMMAND': parse_command, 'COMMAND COUNT': int, 'COMMAND GETKEYS': lambda r: list(map(str_if_bytes, r)), 'CONFIG GET': parse_config_get, 'CONFIG RESETSTAT': bool_ok, 'CONFIG SET': bool_ok, 'DEBUG OBJECT': parse_debug_object, 'FUNCTION DELETE': bool_ok, 'FUNCTION FLUSH': bool_ok, 'FUNCTION RESTORE': bool_ok, 'GEOHASH': lambda r: list(map(str_if_bytes, r)), 'GEOPOS': lambda r: list(map(lambda ll: (float(ll[0]), float(ll[1])) if ll is not None else None, r)), 'GEOSEARCH': parse_geosearch_generic, 'GEORADIUS': parse_geosearch_generic, 'GEORADIUSBYMEMBER': parse_geosearch_generic, 'HGETALL': lambda r: r and pairs_to_dict(r) or {}, 'HSCAN': parse_hscan, 'INFO': parse_info, 'LASTSAVE': timestamp_to_datetime, 'MEMORY PURGE': bool_ok, 'MEMORY STATS': parse_memory_stats, 'MEMORY USAGE': int_or_none, 'MODULE LOAD': parse_module_result, 'MODULE UNLOAD': parse_module_result, 'MODULE LIST': lambda r: [pairs_to_dict(m) for m in r], 'OBJECT': parse_object, 'PING': lambda r: str_if_bytes(r) == 'PONG', 'QUIT': bool_ok, 'STRALGO': parse_stralgo, 'PUBSUB NUMSUB': parse_pubsub_numsub, 'RANDOMKEY': lambda r: r and r or None, 'RESET': str_if_bytes, 'SCAN': parse_scan, 'SCRIPT EXISTS': lambda r: list(map(bool, r)), 'SCRIPT FLUSH': bool_ok, 'SCRIPT KILL': bool_ok, 'SCRIPT LOAD': str_if_bytes, 'SENTINEL CKQUORUM': bool_ok, 'SENTINEL FAILOVER': bool_ok, 'SENTINEL FLUSHCONFIG': bool_ok, 'SENTINEL GET-MASTER-ADDR-BY-NAME': parse_sentinel_get_master, 'SENTINEL MASTER': parse_sentinel_master, 'SENTINEL MASTERS': parse_sentinel_masters, 'SENTINEL MONITOR': bool_ok, 'SENTINEL RESET': bool_ok, 'SENTINEL REMOVE': bool_ok, 'SENTINEL SENTINELS': parse_sentinel_slaves_and_sentinels, 'SENTINEL SET': bool_ok, 'SENTINEL SLAVES': parse_sentinel_slaves_and_sentinels, 'SET': parse_set_result, 'SLOWLOG GET': parse_slowlog_get, 'SLOWLOG LEN': int, 'SLOWLOG RESET': bool_ok, 'SSCAN': parse_scan, 'TIME': lambda x: (int(x[0]), int(x[1])), 'XCLAIM': parse_xclaim, 'XAUTOCLAIM': parse_xautoclaim, 'XGROUP CREATE': bool_ok, 'XGROUP DELCONSUMER': int, 'XGROUP DESTROY': bool, 'XGROUP SETID': bool_ok, 'XINFO CONSUMERS': parse_list_of_dicts, 'XINFO GROUPS': parse_list_of_dicts, 'XINFO STREAM': parse_xinfo_stream, 'XPENDING': parse_xpending, 'ZADD': parse_zadd, 'ZSCAN': parse_zscan, 'ZMSCORE': parse_zmscore}