import sys
import pytest
import numpy as np
from typing import NamedTuple
from numpy.testing import assert_allclose
from scipy.special import hyp2f1
from scipy.special._testutils import check_version, MissingModule
@pytest.mark.parametrize('hyp2f1_test_case', [pytest.param(Hyp2f1TestCase(a=16.25, b=4.25, c=2.5, z=0.4931034482758623 - 0.7965517241379311j, expected=38.41207903409937 - 30.510151276075792j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=2.0, b=16.087593263474208, c=16.088264119063613, z=0.5689655172413794 - 0.7965517241379311j, expected=-0.6667857912761286 - 1.0206224321443573j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=8.0, b=1.0272592605282642, c=-7.949900487447654, z=0.4931034482758623 - 0.7965517241379311j, expected=1679024.1647997478 - 2748129.775857212j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=4.080187217753502, b=16.0, c=-7.949900487447654, z=0.4931034482758623 - 0.7965517241379311j, expected=424747226301.16986 - 1245539049327.2856j, rtol=1e-14)), pytest.param(Hyp2f1TestCase(a=2.02764642551431, b=-15.964218273004214, c=4.0, z=0.4931034482758623 - 0.7965517241379311j, expected=-0.0057826199201757595 + 0.026359861999025885j, rtol=5e-06)), pytest.param(Hyp2f1TestCase(a=2.02764642551431, b=-0.9629749245209605, c=2.0397202577726152, z=0.5689655172413794 - 0.7965517241379311j, expected=0.4671901063492606 + 0.7769632229834897j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=2.0, b=-3.956227226099288, c=-7.949900487447654, z=0.4931034482758623 + 0.7965517241379312j, expected=0.9422283708145973 + 1.3476905754773343j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=1.0, b=-15.980848054962111, c=-15.964218273004214, z=0.4931034482758623 - 0.7965517241379311j, expected=0.4168719497319604 - 0.9770953555235625j, rtol=5e-10)), pytest.param(Hyp2f1TestCase(a=-0.5, b=16.088264119063613, c=2.5, z=0.5689655172413794 + 0.7965517241379312j, expected=1.279096377550619 - 2.173827694297929j, rtol=5e-12)), pytest.param(Hyp2f1TestCase(a=-1.9214641416286231, b=4.0013768449590685, c=2.0397202577726152, z=0.4931034482758623 + 0.7965517241379312j, expected=-2.071520656161738 - 0.7846098268395909j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=-0.9220024191881196, b=8.0, c=-0.9629749245209605, z=0.5689655172413794 - 0.7965517241379311j, expected=-7.740015495862889 + 3.386766435696699j, rtol=5e-12)), pytest.param(Hyp2f1TestCase(a=-1.9214641416286231, b=16.088264119063613, c=-7.93846038215665, z=0.4931034482758623 + 0.7965517241379312j, expected=-6318.553685853241 - 7133.416085202879j, rtol=1e-10)), pytest.param(Hyp2f1TestCase(a=-15.980848054962111, b=-3.9316537064827854, c=16.056809865262608, z=0.5689655172413794 + 0.7965517241379312j, expected=-0.8854577905547399 + 8.135089099967278j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=-1.9214641416286231, b=-0.9629749245209605, c=4.078873014294075, z=0.4931034482758623 + 0.7965517241379312j, expected=1.224291301521487 + 0.36014711766402485j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=-15.75, b=-0.75, c=-1.5, z=0.4931034482758623 + 0.7965517241379312j, expected=-1.5765685855028473 - 3.9399766961046323j, rtol=0.001), marks=pytest.mark.xfail(reason='Unhandled parameters.')), pytest.param(Hyp2f1TestCase(a=-15.980848054962111, b=-1.92872979730171, c=-7.93846038215665, z=0.5689655172413794 - 0.7965517241379311j, expected=56.794588688231194 + 4.556286783533971j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=4.5, b=4.5, c=2.050308316530781, z=0.5689655172413794 + 0.7965517241379312j, expected=-4.251456563455306 + 6.737837111569671j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=4.5, b=8.5, c=-1.92872979730171, z=0.4931034482758623 - 0.7965517241379311j, expected=2177143.9156599627 - 3313617.2748088865j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=2.5, b=-1.5, c=4.0013768449590685, z=0.4931034482758623 - 0.7965517241379311j, expected=0.45563554481603946 + 0.6212000158060831j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=8.5, b=-7.5, c=-15.964218273004214, z=0.4931034482758623 + 0.7965517241379312j, expected=61.03201617828073 - 37.185626416756214j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=-15.5, b=16.5, c=4.0013768449590685, z=0.4931034482758623 + 0.7965517241379312j, expected=-33143.425963520735 + 20790.608514722644j, rtol=1e-14)), pytest.param(Hyp2f1TestCase(a=-0.5, b=4.5, c=-0.9629749245209605, z=0.5689655172413794 + 0.7965517241379312j, expected=30.778600270824423 - 26.65160354466787j, rtol=5e-13)), pytest.param(Hyp2f1TestCase(a=-0.5, b=-3.5, c=16.088264119063613, z=0.5689655172413794 - 0.7965517241379311j, expected=1.0629792615560487 - 0.08308454486044772j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=-3.5, b=-7.5, c=-0.9629749245209605, z=0.4931034482758623 - 0.7965517241379311j, expected=17431.571802591767 + 3553.7129767034507j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=2.25, b=8.25, c=16.5, z=0.11379310344827598 + 0.9482758620689657j, expected=0.4468600750211926 + 0.7313214934036885j, rtol=0.001), marks=pytest.mark.xfail(reason='Unhandled parameters.')), pytest.param(Hyp2f1TestCase(a=8.25, b=16.25, c=4.5, z=0.3413793103448277 + 0.8724137931034486j, expected=-3.905704438293991 + 3.693347860329299j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=4.25, b=4.25, c=-0.5, z=0.11379310344827598 - 0.9482758620689655j, expected=-40.31777941834244 - 89.89852492432011j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=1.0272592605282642, b=8.0, c=-15.964218273004214, z=0.11379310344827598 - 0.9482758620689655j, expected=52584.347773055284 - 109197.86244309516j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=8.095813935368371, b=-15.964218273004214, c=16.056809865262608, z=0.03793103448275881 + 0.9482758620689657j, expected=-1.187733570412592 - 1.5147865053584582j, rtol=5e-10)), pytest.param(Hyp2f1TestCase(a=4.080187217753502, b=-3.9316537064827854, c=1.0651378143226575, z=0.26551724137931054 + 0.9482758620689657j, expected=13.077494677898947 + 35.071599628224966j, rtol=5e-13)), pytest.param(Hyp2f1TestCase(a=4.080187217753502, b=-3.5, c=-3.5, z=0.26551724137931054 + 0.8724137931034486j, expected=-0.5359656237994614 - 0.2344483936591811j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=4.25, b=-3.75, c=-1.5, z=0.26551724137931054 + 0.9482758620689657j, expected=1204.8114871663133 + 64.41022826840198j, rtol=5e-13)), pytest.param(Hyp2f1TestCase(a=-1.9214641416286231, b=16.0, c=4.0013768449590685, z=0.03793103448275881 - 0.9482758620689655j, expected=-9.85268872413994 + 7.011107558429154j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=-7.937789122896016, b=16.0, c=4.0013768449590685, z=0.3413793103448277 - 0.8724137931034484j, expected=528.5522951158454 - 1412.21630264791j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=-15.5, b=1.0561196186065624, c=-7.5, z=0.4172413793103451 + 0.8724137931034486j, expected=133306.45260685298 + 256510.7045225382j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=-7.937789122896016, b=8.077282662161238, c=-15.963511401609862, z=0.3413793103448277 - 0.8724137931034484j, expected=-0.998555715276967 + 2.774198742229889j, rtol=5e-11)), pytest.param(Hyp2f1TestCase(a=-7.75, b=-0.75, c=1.5, z=0.11379310344827598 - 0.9482758620689655j, expected=2.072445019723025 - 2.9793504811373515j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=-15.5, b=-1.92872979730171, c=1.5, z=0.11379310344827598 - 0.9482758620689655j, expected=-41.87581944176649 - 32.52980303527139j, rtol=5e-13)), pytest.param(Hyp2f1TestCase(a=-3.75, b=-15.75, c=-0.5, z=0.11379310344827598 - 0.9482758620689655j, expected=-3729.6214864209774 - 30627.510509112635j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=-3.956227226099288, b=-15.964218273004214, c=-0.906685989801748, z=0.03793103448275881 + 0.9482758620689657j, expected=-131615.07820609974 + 145596.13384245415j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=1.5, b=16.5, c=16.088264119063613, z=0.26551724137931054 + 0.8724137931034486j, expected=0.18981844071070744 + 0.7855036242583742j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=16.5, b=8.5, c=-3.9316537064827854, z=0.11379310344827598 - 0.9482758620689655j, expected=110224529.2376068 + 128287212.04290268j, rtol=5e-13)), pytest.param(Hyp2f1TestCase(a=2.5, b=-7.5, c=4.0013768449590685, z=0.3413793103448277 - 0.8724137931034484j, expected=0.2722302180888523 - 0.21790187837266162j, rtol=1e-12)), pytest.param(Hyp2f1TestCase(a=8.5, b=-7.5, c=-15.964218273004214, z=0.11379310344827598 - 0.9482758620689655j, expected=-2.8252338010989035 + 2.430661949756161j, rtol=5e-14)), pytest.param(Hyp2f1TestCase(a=-3.5, b=16.5, c=4.0013768449590685, z=0.03793103448275881 + 0.9482758620689657j, expected=-20.604894257647945 + 74.5109432558078j, rtol=5e-15)), pytest.param(Hyp2f1TestCase(a=-7.5, b=8.5, c=-0.9629749245209605, z=0.3413793103448277 + 0.8724137931034486j, expected=-2764422.521269463 - 3965966.9965808876j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=-1.5, b=-0.5, c=1.0561196186065624, z=0.26551724137931054 + 0.9482758620689657j, expected=1.2262338560994905 + 0.6545051266925549j, rtol=1e-15)), pytest.param(Hyp2f1TestCase(a=-0.5, b=-15.5, c=-7.949900487447654, z=0.4172413793103451 - 0.8724137931034484j, expected=-2258.1590330318213 + 8860.193389158803j, rtol=1.4e-10))])
def test_region4(self, hyp2f1_test_case):
    """0.9 <= |z| <= 1 and |1 - z| >= 1.

        This region is unhandled by of the standard transformations and
        needs special care.
        """
    a, b, c, z, expected, rtol = hyp2f1_test_case
    assert 0.9 <= abs(z) <= 1 and abs(1 - z) >= 0.9
    assert_allclose(hyp2f1(a, b, c, z), expected, rtol=rtol)