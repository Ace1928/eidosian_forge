import re
import sys
import time
from docutils import nodes, utils
from docutils.transforms import TransformError, Transform
from docutils.utils import smartquotes
class Decorations(Transform):
    """
    Populate a document's decoration element (header, footer).
    """
    default_priority = 820

    def apply(self):
        header_nodes = self.generate_header()
        if header_nodes:
            decoration = self.document.get_decoration()
            header = decoration.get_header()
            header.extend(header_nodes)
        footer_nodes = self.generate_footer()
        if footer_nodes:
            decoration = self.document.get_decoration()
            footer = decoration.get_footer()
            footer.extend(footer_nodes)

    def generate_header(self):
        return None

    def generate_footer(self):
        settings = self.document.settings
        if settings.generator or settings.datestamp or settings.source_link or settings.source_url:
            text = []
            if settings.source_link and settings._source or settings.source_url:
                if settings.source_url:
                    source = settings.source_url
                else:
                    source = utils.relative_path(settings._destination, settings._source)
                text.extend([nodes.reference('', 'View document source', refuri=source), nodes.Text('.\n')])
            if settings.datestamp:
                datestamp = time.strftime(settings.datestamp, time.gmtime())
                text.append(nodes.Text('Generated on: ' + datestamp + '.\n'))
            if settings.generator:
                text.extend([nodes.Text('Generated by '), nodes.reference('', 'Docutils', refuri='http://docutils.sourceforge.net/'), nodes.Text(' from '), nodes.reference('', 'reStructuredText', refuri='http://docutils.sourceforge.net/rst.html'), nodes.Text(' source.\n')])
            return [nodes.paragraph('', '', *text)]
        else:
            return None