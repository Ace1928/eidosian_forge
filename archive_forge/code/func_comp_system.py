from __future__ import annotations
import gzip
import json
from glob import glob
from pathlib import Path
from typing import Any
import numpy as np
from monty.io import zopen
from pymatgen.core import Molecule, Structure
def comp_system(structure: Structure, user_params: dict[str, Any], test_name: str, work_dir: Path, ref_dir: Path, generator_cls: type, properties: list[str] | None=None, prev_dir: str | None | Path=None) -> None:
    """Compare files generated by tests with ones in reference directories.

    Args:
        structure (Structure): The system to make the test files for
        user_params (dict[str, Any]): The parameters for the input files passed by the user
        test_name (str): The name of the test (subdir for ref files in ref_dir)
        work_dir (Path): The directory to look for the test files in
        ref_dir (Path): The directory where all reference files are located
        generator_cls (type): The class of the generator
        properties (list[str] | None): The list of properties to calculate
        prev_dir (str | Path | None): The previous directory to pull outputs from

    Raises:
        AssertionError: If the input files are not the same
    """
    k_point_density = user_params.pop('k_point_density', 20)
    try:
        generator = generator_cls(user_params=user_params, k_point_density=k_point_density)
    except TypeError:
        generator = generator_cls(user_params=user_params)
    input_set = generator.get_input_set(structure, prev_dir, properties)
    input_set.write_input(work_dir / test_name)
    return compare_files(test_name, work_dir, ref_dir)