import re
from pygments.lexer import Lexer, RegexLexer, include, bygroups, using, \
from pygments.util import get_bool_opt, shebang_matches
from pygments.token import Text, Comment, Operator, Keyword, Name, String, \
from pygments import unistring as uni
class PythonLexer(RegexLexer):
    """
    For `Python <http://www.python.org>`_ source code.
    """
    name = 'Python'
    aliases = ['python', 'py', 'sage']
    filenames = ['*.py', '*.pyw', '*.sc', 'SConstruct', 'SConscript', '*.tac', '*.sage']
    mimetypes = ['text/x-python', 'application/x-python']

    def innerstring_rules(ttype):
        return [('%(\\(\\w+\\))?[-#0 +]*([0-9]+|[*])?(\\.([0-9]+|[*]))?[hlL]?[E-GXc-giorsux%]', String.Interpol), ('[^\\\\\\\'"%\\n]+', ttype), ('[\\\'"\\\\]', ttype), ('%', ttype)]
    tokens = {'root': [('\\n', Text), ('^(\\s*)([rRuUbB]{,2})("""(?:.|\\n)*?""")', bygroups(Text, String.Affix, String.Doc)), ("^(\\s*)([rRuUbB]{,2})('''(?:.|\\n)*?''')", bygroups(Text, String.Affix, String.Doc)), ('[^\\S\\n]+', Text), ('\\A#!.+$', Comment.Hashbang), ('#.*$', Comment.Single), ('[]{}:(),;[]', Punctuation), ('\\\\\\n', Text), ('\\\\', Text), ('(in|is|and|or|not)\\b', Operator.Word), ('!=|==|<<|>>|[-~+/*%=<>&^|.]', Operator), include('keywords'), ('(def)((?:\\s|\\\\\\s)+)', bygroups(Keyword, Text), 'funcname'), ('(class)((?:\\s|\\\\\\s)+)', bygroups(Keyword, Text), 'classname'), ('(from)((?:\\s|\\\\\\s)+)', bygroups(Keyword.Namespace, Text), 'fromimport'), ('(import)((?:\\s|\\\\\\s)+)', bygroups(Keyword.Namespace, Text), 'import'), include('builtins'), include('magicfuncs'), include('magicvars'), include('backtick'), ('([rR]|[uUbB][rR]|[rR][uUbB])(""")', bygroups(String.Affix, String.Double), 'tdqs'), ("([rR]|[uUbB][rR]|[rR][uUbB])(''')", bygroups(String.Affix, String.Single), 'tsqs'), ('([rR]|[uUbB][rR]|[rR][uUbB])(")', bygroups(String.Affix, String.Double), 'dqs'), ("([rR]|[uUbB][rR]|[rR][uUbB])(')", bygroups(String.Affix, String.Single), 'sqs'), ('([uUbB]?)(""")', bygroups(String.Affix, String.Double), combined('stringescape', 'tdqs')), ("([uUbB]?)(''')", bygroups(String.Affix, String.Single), combined('stringescape', 'tsqs')), ('([uUbB]?)(")', bygroups(String.Affix, String.Double), combined('stringescape', 'dqs')), ("([uUbB]?)(')", bygroups(String.Affix, String.Single), combined('stringescape', 'sqs')), include('name'), include('numbers')], 'keywords': [(words(('assert', 'break', 'continue', 'del', 'elif', 'else', 'except', 'exec', 'finally', 'for', 'global', 'if', 'lambda', 'pass', 'print', 'raise', 'return', 'try', 'while', 'yield', 'yield from', 'as', 'with'), suffix='\\b'), Keyword)], 'builtins': [(words(('__import__', 'abs', 'all', 'any', 'apply', 'basestring', 'bin', 'bool', 'buffer', 'bytearray', 'bytes', 'callable', 'chr', 'classmethod', 'cmp', 'coerce', 'compile', 'complex', 'delattr', 'dict', 'dir', 'divmod', 'enumerate', 'eval', 'execfile', 'exit', 'file', 'filter', 'float', 'frozenset', 'getattr', 'globals', 'hasattr', 'hash', 'hex', 'id', 'input', 'int', 'intern', 'isinstance', 'issubclass', 'iter', 'len', 'list', 'locals', 'long', 'map', 'max', 'min', 'next', 'object', 'oct', 'open', 'ord', 'pow', 'property', 'range', 'raw_input', 'reduce', 'reload', 'repr', 'reversed', 'round', 'set', 'setattr', 'slice', 'sorted', 'staticmethod', 'str', 'sum', 'super', 'tuple', 'type', 'unichr', 'unicode', 'vars', 'xrange', 'zip'), prefix='(?<!\\.)', suffix='\\b'), Name.Builtin), ('(?<!\\.)(self|None|Ellipsis|NotImplemented|False|True|cls)\\b', Name.Builtin.Pseudo), (words(('ArithmeticError', 'AssertionError', 'AttributeError', 'BaseException', 'DeprecationWarning', 'EOFError', 'EnvironmentError', 'Exception', 'FloatingPointError', 'FutureWarning', 'GeneratorExit', 'IOError', 'ImportError', 'ImportWarning', 'IndentationError', 'IndexError', 'KeyError', 'KeyboardInterrupt', 'LookupError', 'MemoryError', 'NameError', 'NotImplemented', 'NotImplementedError', 'OSError', 'OverflowError', 'OverflowWarning', 'PendingDeprecationWarning', 'ReferenceError', 'RuntimeError', 'RuntimeWarning', 'StandardError', 'StopIteration', 'SyntaxError', 'SyntaxWarning', 'SystemError', 'SystemExit', 'TabError', 'TypeError', 'UnboundLocalError', 'UnicodeDecodeError', 'UnicodeEncodeError', 'UnicodeError', 'UnicodeTranslateError', 'UnicodeWarning', 'UserWarning', 'ValueError', 'VMSError', 'Warning', 'WindowsError', 'ZeroDivisionError'), prefix='(?<!\\.)', suffix='\\b'), Name.Exception)], 'magicfuncs': [(words(('__abs__', '__add__', '__and__', '__call__', '__cmp__', '__coerce__', '__complex__', '__contains__', '__del__', '__delattr__', '__delete__', '__delitem__', '__delslice__', '__div__', '__divmod__', '__enter__', '__eq__', '__exit__', '__float__', '__floordiv__', '__ge__', '__get__', '__getattr__', '__getattribute__', '__getitem__', '__getslice__', '__gt__', '__hash__', '__hex__', '__iadd__', '__iand__', '__idiv__', '__ifloordiv__', '__ilshift__', '__imod__', '__imul__', '__index__', '__init__', '__instancecheck__', '__int__', '__invert__', '__iop__', '__ior__', '__ipow__', '__irshift__', '__isub__', '__iter__', '__itruediv__', '__ixor__', '__le__', '__len__', '__long__', '__lshift__', '__lt__', '__missing__', '__mod__', '__mul__', '__ne__', '__neg__', '__new__', '__nonzero__', '__oct__', '__op__', '__or__', '__pos__', '__pow__', '__radd__', '__rand__', '__rcmp__', '__rdiv__', '__rdivmod__', '__repr__', '__reversed__', '__rfloordiv__', '__rlshift__', '__rmod__', '__rmul__', '__rop__', '__ror__', '__rpow__', '__rrshift__', '__rshift__', '__rsub__', '__rtruediv__', '__rxor__', '__set__', '__setattr__', '__setitem__', '__setslice__', '__str__', '__sub__', '__subclasscheck__', '__truediv__', '__unicode__', '__xor__'), suffix='\\b'), Name.Function.Magic)], 'magicvars': [(words(('__bases__', '__class__', '__closure__', '__code__', '__defaults__', '__dict__', '__doc__', '__file__', '__func__', '__globals__', '__metaclass__', '__module__', '__mro__', '__name__', '__self__', '__slots__', '__weakref__'), suffix='\\b'), Name.Variable.Magic)], 'numbers': [('(\\d+\\.\\d*|\\d*\\.\\d+)([eE][+-]?[0-9]+)?j?', Number.Float), ('\\d+[eE][+-]?[0-9]+j?', Number.Float), ('0[0-7]+j?', Number.Oct), ('0[bB][01]+', Number.Bin), ('0[xX][a-fA-F0-9]+', Number.Hex), ('\\d+L', Number.Integer.Long), ('\\d+j?', Number.Integer)], 'backtick': [('`.*?`', String.Backtick)], 'name': [('@[\\w.]+', Name.Decorator), ('[a-zA-Z_]\\w*', Name)], 'funcname': [include('magicfuncs'), ('[a-zA-Z_]\\w*', Name.Function, '#pop'), default('#pop')], 'classname': [('[a-zA-Z_]\\w*', Name.Class, '#pop')], 'import': [('(?:[ \\t]|\\\\\\n)+', Text), ('as\\b', Keyword.Namespace), (',', Operator), ('[a-zA-Z_][\\w.]*', Name.Namespace), default('#pop')], 'fromimport': [('(?:[ \\t]|\\\\\\n)+', Text), ('import\\b', Keyword.Namespace, '#pop'), ('None\\b', Name.Builtin.Pseudo, '#pop'), ('[a-zA-Z_.][\\w.]*', Name.Namespace), default('#pop')], 'stringescape': [('\\\\([\\\\abfnrtv"\\\']|\\n|N\\{.*?\\}|u[a-fA-F0-9]{4}|U[a-fA-F0-9]{8}|x[a-fA-F0-9]{2}|[0-7]{1,3})', String.Escape)], 'strings-single': innerstring_rules(String.Single), 'strings-double': innerstring_rules(String.Double), 'dqs': [('"', String.Double, '#pop'), ('\\\\\\\\|\\\\"|\\\\\\n', String.Escape), include('strings-double')], 'sqs': [("'", String.Single, '#pop'), ("\\\\\\\\|\\\\'|\\\\\\n", String.Escape), include('strings-single')], 'tdqs': [('"""', String.Double, '#pop'), include('strings-double'), ('\\n', String.Double)], 'tsqs': [("'''", String.Single, '#pop'), include('strings-single'), ('\\n', String.Single)]}

    def analyse_text(text):
        return shebang_matches(text, 'pythonw?(2(\\.\\d)?)?') or 'import ' in text[:1000]