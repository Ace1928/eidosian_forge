from __future__ import (absolute_import, division, print_function)
import importlib
import os
import re
import sys
import textwrap
import yaml
def augment_fragment(provider_fragment, provider_info):
    data = {'record_type': {'choices': sorted(provider_info.get_supported_record_types())}, 'zone_id_type': {'type': provider_info.get_zone_id_type()}, 'record_id_type': {'type': provider_info.get_record_id_type()}, 'record_default_ttl': {'default': provider_info.get_record_default_ttl()}}
    for fragment_name, fragment_insertion_data in DEPENDENT_FRAGMENTS:
        insertion_fragment = provider_fragment.fragments_by_name.get(fragment_name)
        if insertion_fragment is None:
            insertion_fragment = DocFragment('', [], fragment_name, [])
            provider_fragment.fragments.append(insertion_fragment)
            provider_fragment.fragments_by_name[fragment_name] = insertion_fragment
        insertion_fragment.data = {}
        all_doc_fragment_names = set()
        for what, insertion_point, doc_fragment_names in fragment_insertion_data:
            all_doc_fragment_names.update(doc_fragment_names)
            doc_fragments = [load_single_doc_fragment(doc_fragment) for doc_fragment in doc_fragment_names]
            insertion_point = insertion_point.split('.')
            insertion_pos = insertion_fragment.data
            original_pos = doc_fragments[0].data
            for depth, part in enumerate(insertion_point):
                if part not in insertion_pos:
                    insertion_pos[part] = {}
                insertion_pos = insertion_pos[part]
                original_pos = original_pos[part]
                if depth >= 2:
                    for x in original_pos:
                        if x not in insertion_pos:
                            insertion_pos[x] = original_pos[x]
            insertion_pos.update(data[what])
        insertion_fragment.prefix_lines = ['', '    # WARNING: This section is automatically generated by update-docs-fragments.py.']
        insertion_fragment.prefix_lines.extend(['    #          {0}'.format(line) for line in textwrap.wrap('It is used to augment the docs fragment{0} {1}.'.format('s' if len(all_doc_fragment_names) != 1 else '', ', '.join(sorted(all_doc_fragment_names))), width=80)])
        insertion_fragment.prefix_lines.append('    #          DO NOT EDIT MANUALLY!')
        insertion_fragment.recreate_lines()