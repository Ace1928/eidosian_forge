import logging
import os
from multiprocessing import Process, Pipe, ProcessError
import importlib
from typing import Set, Optional, List
import numpy as np
from scipy.spatial.distance import cosine
from dataclasses import dataclass
from gensim import utils
from gensim.models import ldamodel, ldamulticore, basemodel
from gensim.utils import SaveLoad
def _generate_topic_models(ensemble, num_models, random_states=None):
    """Train the topic models that form the ensemble.

    Parameters
    ----------
    ensemble: EnsembleLda
        the ensemble
    num_models : int
        number of models to be generated
    random_states : list
        list of numbers or np.random.RandomState objects. Will be autogenerated based on the ensembles
        RandomState if None (default).
    """
    if random_states is None:
        random_states = [ensemble.random_state.randint(_MAX_RANDOM_STATE) for _ in range(num_models)]
    assert len(random_states) == num_models
    kwargs = ensemble.gensim_kw_args.copy()
    tm = None
    for i in range(num_models):
        kwargs['random_state'] = random_states[i]
        tm = ensemble.get_topic_model_class()(**kwargs)
        ensemble.ttda = np.concatenate([ensemble.ttda, tm.get_topics()])
        if not ensemble.memory_friendly_ttda:
            ensemble.tms += [tm]
    ensemble.sstats_sum = tm.state.sstats.sum()
    ensemble.eta = tm.eta