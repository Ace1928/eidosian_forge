import numpy as np
import pytest
import sympy
from cirq.interop.quirk.cells.parse import parse_matrix, parse_formula, parse_complex
def test_parse_complex_expression_cases_from_quirk():
    np.testing.assert_allclose(parse_complex('1/3'), 1 / 3)
    np.testing.assert_allclose(parse_complex('2/3/5'), 2 / 3 / 5)
    np.testing.assert_allclose(parse_complex('2/3/5*7/13'), 2 / 3 / 5 * 7 / 13)
    np.testing.assert_allclose(parse_complex('2-3-5'), -6)
    np.testing.assert_allclose(parse_complex('1/3+2i'), 1 / 3 + 2j)
    np.testing.assert_allclose(parse_complex('(1/3)+2i'), 1 / 3 + 2j)
    np.testing.assert_allclose(parse_complex('1/(3+2i)'), 1 / (3 + 2j), atol=1e-08)
    np.testing.assert_allclose(parse_complex('1/sqrt(3+2i)'), 1 / (3 + 2j) ** 0.5, atol=1e-08)
    np.testing.assert_allclose(parse_complex('i^i'), 0.20787957635076193, atol=1e-08)
    np.testing.assert_allclose(parse_complex('√i'), np.sqrt(1j))
    np.testing.assert_allclose(parse_complex('√4i'), 2j)
    np.testing.assert_allclose(parse_complex('sqrt4i'), 2j)
    np.testing.assert_allclose(parse_complex('sqrt√4i'), np.sqrt(2) * 1j)
    np.testing.assert_allclose(parse_complex('sqrt√4-i'), np.sqrt(2) - 1j)
    np.testing.assert_allclose(parse_complex('----------1'), 1)
    np.testing.assert_allclose(parse_complex('---------1'), -1)
    np.testing.assert_allclose(parse_complex('---+--+--1'), -1)
    np.testing.assert_allclose(parse_complex('0---+--+--1'), -1)
    np.testing.assert_allclose(parse_complex('0---+--+--1*'), -1)
    np.testing.assert_allclose(parse_complex('2+3^'), 5)
    np.testing.assert_allclose(parse_complex('cos(45) + i sin(45)'), np.sqrt(0.5) + 1j * np.sqrt(0.5), atol=1e-08)
    np.testing.assert_allclose(parse_complex('cos(45) + i (sin 45)'), np.sqrt(0.5) + 1j * np.sqrt(0.5), atol=1e-08)
    np.testing.assert_allclose(parse_complex('e^(pi i)'), -1, atol=1e-08)
    np.testing.assert_allclose(parse_complex('exp(ln(2))'), 2, atol=1e-08)
    np.testing.assert_allclose(parse_complex('sin(arcsin(0.5))'), 0.5, atol=1e-08)
    np.testing.assert_allclose(parse_complex('cos(arccos(0.5))'), 0.5, atol=1e-08)
    np.testing.assert_allclose(parse_complex('sin(asin(0.5))'), 0.5, atol=1e-08)
    np.testing.assert_allclose(parse_complex('cos(acos(0.5))'), 0.5, atol=1e-08)