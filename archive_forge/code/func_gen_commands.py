from __future__ import absolute_import, division, print_function
import re
from ansible.module_utils.basic import AnsibleModule
from ansible_collections.community.network.plugins.module_utils.network.edgeswitch.edgeswitch import load_config, run_commands
from ansible_collections.community.network.plugins.module_utils.network.edgeswitch.edgeswitch import build_aggregate_spec, map_params_to_obj
from ansible_collections.community.network.plugins.module_utils.network.edgeswitch.edgeswitch_interface import InterfaceConfiguration, merge_interfaces
def gen_commands(self, port, module):
    """ to reduce commands generated by this module
            we group vlans changes to have a max of 5 vlan commands by interface
        """
    exclude = []
    include = []
    tag = []
    untag = []
    pvid = []
    for vlan_id in self.excluded:
        if vlan_id not in port['forbidden_vlans']:
            exclude.append(vlan_id)
        if vlan_id in port['tagged_vlans']:
            untag.append(vlan_id)
    for vlan_id in self.untagged:
        if vlan_id in port['forbidden_vlans'] or (vlan_id not in port['untagged_vlans'] and vlan_id not in port['tagged_vlans']):
            include.append(vlan_id)
        if vlan_id in port['tagged_vlans']:
            untag.append(vlan_id)
        if vlan_id != port['pvid_mode']:
            pvid.append(vlan_id)
    for vlan_id in self.tagged:
        if vlan_id not in port['tagged_vlans']:
            tag.append(vlan_id)
            include.append(vlan_id)
    if include:
        self.commands.append('vlan participation include {0}'.format(','.join(include)))
    if pvid:
        if len(pvid) > 1:
            module.fail_json(msg="{0} can't have more than one untagged vlan")
            return
        self.commands.append('vlan pvid {0}'.format(pvid[0]))
    if untag:
        self.commands.append('no vlan tagging {0}'.format(','.join(untag)))
    if tag:
        self.commands.append('vlan tagging {0}'.format(','.join(tag)))
    if exclude:
        self.commands.append('vlan participation exclude {0}'.format(','.join(exclude)))