import os
import itertools
import logging
import pickle
from os.path import abspath, dirname
import pyomo.common.unittest as unittest
from pyomo.common.collections import ComponentMap
from pyomo.common.log import LoggingIntercept
from pyomo.core.base.suffix import (
from pyomo.environ import (
from io import StringIO
class TestSuffixMethods(unittest.TestCase):

    def test_suffix_debug(self):
        with LoggingIntercept(level=logging.DEBUG) as OUT:
            m = ConcreteModel()
            m.s = Suffix()
            m.foo = Suffix(rule=[])
        print(OUT.getvalue())
        self.assertEqual(OUT.getvalue(), "Constructing ConcreteModel 'ConcreteModel', from data=None\nConstructing Suffix 'Suffix'\nConstructing AbstractSuffix 'foo' on [Model] from data=None\nConstructing Suffix 'foo'\nConstructed component ''[Model].foo'':\nfoo : Direction=LOCAL, Datatype=FLOAT\n    Key : Value\n\n")

    def test_suffix_rule(self):
        m = ConcreteModel()
        m.I = Set(initialize=[1, 2, 3])
        m.x = Var(m.I)
        m.y = Var(m.I)
        m.c = Constraint(m.I, rule=lambda m, i: m.x[i] >= i)
        m.d = Constraint(m.I, rule=lambda m, i: m.x[i] <= -i)
        _dict = {m.c[1]: 10, m.c[2]: 20, m.c[3]: 30, m.d: 100}
        m.suffix_dict = Suffix(initialize=_dict)
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_dict[m.c[1]], 10)
        self.assertEqual(m.suffix_dict[m.c[2]], 20)
        self.assertEqual(m.suffix_dict[m.c[3]], 30)
        self.assertEqual(m.suffix_dict[m.d[1]], 100)
        self.assertEqual(m.suffix_dict[m.d[2]], 100)
        self.assertEqual(m.suffix_dict[m.d[3]], 100)
        _dict[m.c[1]] = 1000
        m.suffix_dict.construct()
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_dict[m.c[1]], 10)
        m.suffix_cmap = Suffix(initialize=ComponentMap([(m.x[1], 10), (m.x[2], 20), (m.x[3], 30), (m.y, 100)]))
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_cmap[m.x[1]], 10)
        self.assertEqual(m.suffix_cmap[m.x[2]], 20)
        self.assertEqual(m.suffix_cmap[m.x[3]], 30)
        self.assertEqual(m.suffix_cmap[m.y[1]], 100)
        self.assertEqual(m.suffix_cmap[m.y[2]], 100)
        self.assertEqual(m.suffix_cmap[m.y[3]], 100)
        m.suffix_list = Suffix(initialize=[(m.x[1], 10), (m.x[2], 20), (m.x[3], 30), (m.y, 100)])
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_list[m.x[1]], 10)
        self.assertEqual(m.suffix_list[m.x[2]], 20)
        self.assertEqual(m.suffix_list[m.x[3]], 30)
        self.assertEqual(m.suffix_list[m.y[1]], 100)
        self.assertEqual(m.suffix_list[m.y[2]], 100)
        self.assertEqual(m.suffix_list[m.y[3]], 100)

        def gen_init():
            yield (m.x[1], 10)
            yield (m.x[2], 20)
            yield (m.x[3], 30)
            yield (m.y, 100)
        m.suffix_generator = Suffix(initialize=gen_init())
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_generator[m.x[1]], 10)
        self.assertEqual(m.suffix_generator[m.x[2]], 20)
        self.assertEqual(m.suffix_generator[m.x[3]], 30)
        self.assertEqual(m.suffix_generator[m.y[1]], 100)
        self.assertEqual(m.suffix_generator[m.y[2]], 100)
        self.assertEqual(m.suffix_generator[m.y[3]], 100)

        def genfcn_init(m, i):
            yield (m.x[1], 10)
            yield (m.x[2], 20)
            yield (m.x[3], 30)
            yield (m.y, 100)
        m.suffix_generator_fcn = Suffix(initialize=genfcn_init)
        self.assertEqual(len(m.suffix_dict), 6)
        self.assertEqual(m.suffix_generator_fcn[m.x[1]], 10)
        self.assertEqual(m.suffix_generator_fcn[m.x[2]], 20)
        self.assertEqual(m.suffix_generator_fcn[m.x[3]], 30)
        self.assertEqual(m.suffix_generator_fcn[m.y[1]], 100)
        self.assertEqual(m.suffix_generator_fcn[m.y[2]], 100)
        self.assertEqual(m.suffix_generator_fcn[m.y[3]], 100)

    def test_import_enabled(self):
        model = ConcreteModel()
        model.test_implicit = Suffix()
        self.assertFalse(model.test_implicit.import_enabled())
        model.test_local = Suffix(direction=Suffix.LOCAL)
        self.assertFalse(model.test_local.import_enabled())
        model.test_out = Suffix(direction=Suffix.IMPORT)
        self.assertTrue(model.test_out.import_enabled())
        model.test_in = Suffix(direction=Suffix.EXPORT)
        self.assertFalse(model.test_in.import_enabled())
        model.test_inout = Suffix(direction=Suffix.IMPORT_EXPORT)
        self.assertTrue(model.test_inout.import_enabled())

    def test_export_enabled(self):
        model = ConcreteModel()
        model.test_implicit = Suffix()
        self.assertFalse(model.test_implicit.export_enabled())
        model.test_local = Suffix(direction=Suffix.LOCAL)
        self.assertFalse(model.test_local.export_enabled())
        model.test_out = Suffix(direction=Suffix.IMPORT)
        self.assertFalse(model.test_out.export_enabled())
        model.test_in = Suffix(direction=Suffix.EXPORT)
        self.assertTrue(model.test_in.export_enabled())
        model.test_inout = Suffix(direction=Suffix.IMPORT_EXPORT)
        self.assertTrue(model.test_inout.export_enabled())

    def test_set_value_getValue_Var1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3], dense=True)
        model.junk.set_value(model.X, 1.0)
        model.junk.set_value(model.X[1], 2.0)
        self.assertEqual(model.junk.get(model.X), None)
        self.assertEqual(model.junk.get(model.X[1]), 2.0)
        self.assertEqual(model.junk.get(model.X[2]), 1.0)
        self.assertEqual(model.junk.get(model.x), None)
        model.junk.set_value(model.x, 3.0)
        model.junk.set_value(model.X[2], 3.0)
        self.assertEqual(model.junk.get(model.X), None)
        self.assertEqual(model.junk.get(model.X[1]), 2.0)
        self.assertEqual(model.junk.get(model.X[2]), 3.0)
        self.assertEqual(model.junk.get(model.x), 3.0)
        model.junk.set_value(model.X, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.X), 1.0)

    def test_set_value_getValue_Var2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3], dense=True)
        model.X.set_suffix_value('junk', 1.0)
        model.X[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.X.get_suffix_value('junk'), None)
        self.assertEqual(model.X[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.X[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.x.get_suffix_value('junk'), None)
        model.x.set_suffix_value('junk', 3.0)
        model.X[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.X.get_suffix_value('junk'), None)
        self.assertEqual(model.X[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.X[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.x.get_suffix_value('junk'), 3.0)
        model.X.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.X.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_Var3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3], dense=True)
        model.X.set_suffix_value(model.junk, 1.0)
        model.X[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.X.get_suffix_value(model.junk), None)
        self.assertEqual(model.X[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.X[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.x.get_suffix_value(model.junk), None)
        model.x.set_suffix_value(model.junk, 3.0)
        model.X[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.X.get_suffix_value(model.junk), None)
        self.assertEqual(model.X[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.X[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.x.get_suffix_value(model.junk), 3.0)
        model.X.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.X.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_Constraint1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.c = Constraint(expr=model.x >= 1)
        model.C = Constraint([1, 2, 3], rule=lambda model, i: model.X[i] >= 1)
        model.junk.set_value(model.C, 1.0)
        model.junk.set_value(model.C[1], 2.0)
        self.assertEqual(model.junk.get(model.C), None)
        self.assertEqual(model.junk.get(model.C[1]), 2.0)
        self.assertEqual(model.junk.get(model.C[2]), 1.0)
        self.assertEqual(model.junk.get(model.c), None)
        model.junk.set_value(model.c, 3.0)
        model.junk.set_value(model.C[2], 3.0)
        self.assertEqual(model.junk.get(model.C), None)
        self.assertEqual(model.junk.get(model.C[1]), 2.0)
        self.assertEqual(model.junk.get(model.C[2]), 3.0)
        self.assertEqual(model.junk.get(model.c), 3.0)
        model.junk.set_value(model.C, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.C), 1.0)

    def test_set_value_getValue_Constraint2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.c = Constraint(expr=model.x >= 1)
        model.C = Constraint([1, 2, 3], rule=lambda model, i: model.X[i] >= 1)
        model.C.set_suffix_value('junk', 1.0)
        model.C[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.C.get_suffix_value('junk'), None)
        self.assertEqual(model.C[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.C[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.c.get_suffix_value('junk'), None)
        model.c.set_suffix_value('junk', 3.0)
        model.C[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.C.get_suffix_value('junk'), None)
        self.assertEqual(model.C[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.C[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.c.get_suffix_value('junk'), 3.0)
        model.C.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.C.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_Constraint3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.c = Constraint(expr=model.x >= 1)
        model.C = Constraint([1, 2, 3], rule=lambda model, i: model.X[i] >= 1)
        model.C.set_suffix_value(model.junk, 1.0)
        model.C[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.C.get_suffix_value(model.junk), None)
        self.assertEqual(model.C[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.C[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.c.get_suffix_value(model.junk), None)
        model.c.set_suffix_value(model.junk, 3.0)
        model.C[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.C.get_suffix_value(model.junk), None)
        self.assertEqual(model.C[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.C[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.c.get_suffix_value(model.junk), 3.0)
        model.C.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.C.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_Objective1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.obj = Objective(expr=sum_product(model.X) + model.x)
        model.OBJ = Objective([1, 2, 3], rule=lambda model, i: model.X[i])
        model.junk.set_value(model.OBJ, 1.0)
        model.junk.set_value(model.OBJ[1], 2.0)
        self.assertEqual(model.junk.get(model.OBJ), None)
        self.assertEqual(model.junk.get(model.OBJ[1]), 2.0)
        self.assertEqual(model.junk.get(model.OBJ[2]), 1.0)
        self.assertEqual(model.junk.get(model.obj), None)
        model.junk.set_value(model.obj, 3.0)
        model.junk.set_value(model.OBJ[2], 3.0)
        self.assertEqual(model.junk.get(model.OBJ), None)
        self.assertEqual(model.junk.get(model.OBJ[1]), 2.0)
        self.assertEqual(model.junk.get(model.OBJ[2]), 3.0)
        self.assertEqual(model.junk.get(model.obj), 3.0)
        model.junk.set_value(model.OBJ, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.OBJ), 1.0)

    def test_set_value_getValue_Objective2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.obj = Objective(expr=sum_product(model.X) + model.x)
        model.OBJ = Objective([1, 2, 3], rule=lambda model, i: model.X[i])
        model.OBJ.set_suffix_value('junk', 1.0)
        model.OBJ[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.OBJ.get_suffix_value('junk'), None)
        self.assertEqual(model.OBJ[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.OBJ[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.obj.get_suffix_value('junk'), None)
        model.obj.set_suffix_value('junk', 3.0)
        model.OBJ[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.OBJ.get_suffix_value('junk'), None)
        self.assertEqual(model.OBJ[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.OBJ[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.obj.get_suffix_value('junk'), 3.0)
        model.OBJ.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.OBJ.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_Objective3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.obj = Objective(expr=sum_product(model.X) + model.x)
        model.OBJ = Objective([1, 2, 3], rule=lambda model, i: model.X[i])
        model.OBJ.set_suffix_value(model.junk, 1.0)
        model.OBJ[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.OBJ.get_suffix_value(model.junk), None)
        self.assertEqual(model.OBJ[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.OBJ[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.obj.get_suffix_value(model.junk), None)
        model.obj.set_suffix_value(model.junk, 3.0)
        model.OBJ[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.OBJ.get_suffix_value(model.junk), None)
        self.assertEqual(model.OBJ[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.OBJ[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.obj.get_suffix_value(model.junk), 3.0)
        model.OBJ.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.OBJ.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_mutableParam1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=True)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=True)
        model.junk.set_value(model.P, 1.0)
        model.junk.set_value(model.P[1], 2.0)
        self.assertEqual(model.junk.get(model.P), None)
        self.assertEqual(model.junk.get(model.P[1]), 2.0)
        self.assertEqual(model.junk.get(model.P[2]), 1.0)
        self.assertEqual(model.junk.get(model.p), None)
        model.junk.set_value(model.p, 3.0)
        model.junk.set_value(model.P[2], 3.0)
        self.assertEqual(model.junk.get(model.P), None)
        self.assertEqual(model.junk.get(model.P[1]), 2.0)
        self.assertEqual(model.junk.get(model.P[2]), 3.0)
        self.assertEqual(model.junk.get(model.p), 3.0)
        model.junk.set_value(model.P, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.P), 1.0)

    def test_set_value_getValue_mutableParam2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=True)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=True)
        model.P.set_suffix_value('junk', 1.0)
        model.P[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.P.get_suffix_value('junk'), None)
        self.assertEqual(model.P[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.P[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.p.get_suffix_value('junk'), None)
        model.p.set_suffix_value('junk', 3.0)
        model.P[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.P.get_suffix_value('junk'), None)
        self.assertEqual(model.P[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.P[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.p.get_suffix_value('junk'), 3.0)
        model.P.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.P.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_mutableParam3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=True)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=True)
        model.P.set_suffix_value(model.junk, 1.0)
        model.P[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.P.get_suffix_value(model.junk), None)
        self.assertEqual(model.P[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.P[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.p.get_suffix_value(model.junk), None)
        model.p.set_suffix_value(model.junk, 3.0)
        model.P[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.P.get_suffix_value(model.junk), None)
        self.assertEqual(model.P[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.P[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.p.get_suffix_value(model.junk), 3.0)
        model.P.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.P.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_immutableParam1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=False)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=False)
        self.assertEqual(model.junk.get(model.P), None)
        model.junk.set_value(model.P, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.P), 1.0)

    def test_set_value_getValue_immutableParam2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=False)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=False)
        self.assertEqual(model.P.get_suffix_value('junk'), None)
        model.P.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.P.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_immutableParam3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.p = Param(initialize=1.0, mutable=False)
        model.P = Param([1, 2, 3], initialize=1.0, mutable=False)
        self.assertEqual(model.P.get_suffix_value(model.junk), None)
        model.P.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.P.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_Set1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.s = Set(initialize=[1, 2, 3])
        model.S = Set([1, 2, 3], initialize={1: [1, 2, 3], 2: [1, 2, 3], 3: [1, 2, 3]})
        model.junk.set_value(model.S, 1.0)
        model.junk.set_value(model.S[1], 2.0)
        self.assertEqual(model.junk.get(model.S), None)
        self.assertEqual(model.junk.get(model.S[1]), 2.0)
        self.assertEqual(model.junk.get(model.S[2]), 1.0)
        self.assertEqual(model.junk.get(model.s), None)
        model.junk.set_value(model.s, 3.0)
        model.junk.set_value(model.S[2], 3.0)
        self.assertEqual(model.junk.get(model.S), None)
        self.assertEqual(model.junk.get(model.S[1]), 2.0)
        self.assertEqual(model.junk.get(model.S[2]), 3.0)
        self.assertEqual(model.junk.get(model.s), 3.0)
        model.junk.set_value(model.S, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.S), 1.0)

    def test_set_value_getValue_Set2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.s = Set(initialize=[1, 2, 3])
        model.S = Set([1, 2, 3], initialize={1: [1, 2, 3], 2: [1, 2, 3], 3: [1, 2, 3]})
        model.S.set_suffix_value('junk', 1.0)
        model.S[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.S.get_suffix_value('junk'), None)
        self.assertEqual(model.S[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.S[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.s.get_suffix_value('junk'), None)
        model.s.set_suffix_value('junk', 3.0)
        model.S[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.S.get_suffix_value('junk'), None)
        self.assertEqual(model.S[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.S[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.s.get_suffix_value('junk'), 3.0)
        model.S.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.S.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_Set3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.X = Var([1, 2, 3])
        model.s = Set(initialize=[1, 2, 3])
        model.S = Set([1, 2, 3], initialize={1: [1, 2, 3], 2: [1, 2, 3], 3: [1, 2, 3]})
        model.S.set_suffix_value(model.junk, 1.0)
        model.S[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.S.get_suffix_value(model.junk), None)
        self.assertEqual(model.S[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.S[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.s.get_suffix_value(model.junk), None)
        model.s.set_suffix_value(model.junk, 3.0)
        model.S[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.S.get_suffix_value(model.junk), None)
        self.assertEqual(model.S[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.S[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.s.get_suffix_value(model.junk), 3.0)
        model.S.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.S.get_suffix_value(model.junk), 1.0)

    def test_set_value_getValue_Block1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.b = Block()
        model.B = Block([1, 2, 3])
        model.B[1].x = 1
        model.B[2].x = 2
        model.B[3].x = 3
        model.junk.set_value(model.B, 1.0)
        model.junk.set_value(model.B[1], 2.0)
        self.assertEqual(model.junk.get(model.B), None)
        self.assertEqual(model.junk.get(model.B[1]), 2.0)
        self.assertEqual(model.junk.get(model.B[2]), 1.0)
        self.assertEqual(model.junk.get(model.b), None)
        model.junk.set_value(model.b, 3.0)
        model.junk.set_value(model.B[2], 3.0)
        self.assertEqual(model.junk.get(model.B), None)
        self.assertEqual(model.junk.get(model.B[1]), 2.0)
        self.assertEqual(model.junk.get(model.B[2]), 3.0)
        self.assertEqual(model.junk.get(model.b), 3.0)
        model.junk.set_value(model.B, 1.0, expand=False)
        self.assertEqual(model.junk.get(model.B), 1.0)

    def test_set_value_getValue_Block2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.b = Block()
        model.B = Block([1, 2, 3])
        model.B[1].x = 1
        model.B[2].x = 2
        model.B[3].x = 3
        model.B.set_suffix_value('junk', 1.0)
        model.B[1].set_suffix_value('junk', 2.0)
        self.assertEqual(model.B.get_suffix_value('junk'), None)
        self.assertEqual(model.B[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.B[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.b.get_suffix_value('junk'), None)
        model.b.set_suffix_value('junk', 3.0)
        model.B[2].set_suffix_value('junk', 3.0)
        self.assertEqual(model.B.get_suffix_value('junk'), None)
        self.assertEqual(model.B[1].get_suffix_value('junk'), 2.0)
        self.assertEqual(model.B[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.b.get_suffix_value('junk'), 3.0)
        model.B.set_suffix_value('junk', 1.0, expand=False)
        self.assertEqual(model.B.get_suffix_value('junk'), 1.0)

    def test_set_value_getValue_Block3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.b = Block()
        model.B = Block([1, 2, 3])
        model.B[1].x = 1
        model.B[2].x = 2
        model.B[3].x = 3
        model.B.set_suffix_value(model.junk, 1.0)
        model.B[1].set_suffix_value(model.junk, 2.0)
        self.assertEqual(model.B.get_suffix_value(model.junk), None)
        self.assertEqual(model.B[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.B[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.b.get_suffix_value(model.junk), None)
        model.b.set_suffix_value(model.junk, 3.0)
        model.B[2].set_suffix_value(model.junk, 3.0)
        self.assertEqual(model.B.get_suffix_value(model.junk), None)
        self.assertEqual(model.B[1].get_suffix_value(model.junk), 2.0)
        self.assertEqual(model.B[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.b.get_suffix_value(model.junk), 3.0)
        model.B.set_suffix_value(model.junk, 1.0, expand=False)
        self.assertEqual(model.B.get_suffix_value(model.junk), 1.0)

    def test_set_all_values1(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var([1, 2, 3], dense=True)
        model.z = Var([1, 2, 3], dense=True)
        model.junk.set_value(model.y[2], 1.0)
        model.junk.set_value(model.z, 2.0)
        self.assertTrue(model.junk.get(model.x) is None)
        self.assertTrue(model.junk.get(model.y) is None)
        self.assertTrue(model.junk.get(model.y[1]) is None)
        self.assertEqual(model.junk.get(model.y[2]), 1.0)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[1]), 2.0)
        model.junk.set_all_values(3.0)
        self.assertTrue(model.junk.get(model.x) is None)
        self.assertTrue(model.junk.get(model.y) is None)
        self.assertTrue(model.junk.get(model.y[1]) is None)
        self.assertEqual(model.junk.get(model.y[2]), 3.0)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[1]), 3.0)

    def test_set_all_values2(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var([1, 2, 3], dense=True)
        model.z = Var([1, 2, 3], dense=True)
        model.y[2].set_suffix_value('junk', 1.0)
        model.z.set_suffix_value('junk', 2.0)
        self.assertTrue(model.x.get_suffix_value('junk') is None)
        self.assertTrue(model.y.get_suffix_value('junk') is None)
        self.assertTrue(model.y[1].get_suffix_value('junk') is None)
        self.assertEqual(model.y[2].get_suffix_value('junk'), 1.0)
        self.assertEqual(model.z.get_suffix_value('junk'), None)
        self.assertEqual(model.z[1].get_suffix_value('junk'), 2.0)
        model.junk.set_all_values(3.0)
        self.assertTrue(model.x.get_suffix_value('junk') is None)
        self.assertTrue(model.y.get_suffix_value('junk') is None)
        self.assertTrue(model.y[1].get_suffix_value('junk') is None)
        self.assertEqual(model.y[2].get_suffix_value('junk'), 3.0)
        self.assertEqual(model.z.get_suffix_value('junk'), None)
        self.assertEqual(model.z[1].get_suffix_value('junk'), 3.0)

    def test_set_all_values3(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var([1, 2, 3], dense=True)
        model.z = Var([1, 2, 3], dense=True)
        model.y[2].set_suffix_value(model.junk, 1.0)
        model.z.set_suffix_value(model.junk, 2.0)
        self.assertTrue(model.x.get_suffix_value(model.junk) is None)
        self.assertTrue(model.y.get_suffix_value(model.junk) is None)
        self.assertTrue(model.y[1].get_suffix_value(model.junk) is None)
        self.assertEqual(model.y[2].get_suffix_value(model.junk), 1.0)
        self.assertEqual(model.z.get_suffix_value(model.junk), None)
        self.assertEqual(model.z[1].get_suffix_value(model.junk), 2.0)
        model.junk.set_all_values(3.0)
        self.assertTrue(model.x.get_suffix_value(model.junk) is None)
        self.assertTrue(model.y.get_suffix_value(model.junk) is None)
        self.assertTrue(model.y[1].get_suffix_value(model.junk) is None)
        self.assertEqual(model.y[2].get_suffix_value(model.junk), 3.0)
        self.assertEqual(model.z.get_suffix_value(model.junk), None)
        self.assertEqual(model.z[1].get_suffix_value(model.junk), 3.0)

    def test_update_values(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var()
        model.z = Var([1, 2])
        model.junk.set_value(model.x, 0.0)
        self.assertEqual(model.junk.get(model.x), 0.0)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[1]), None)
        self.assertEqual(model.junk.get(model.z[2]), None)
        model.junk.update_values([(model.x, 1.0), (model.y, 2.0), (model.z, 3.0)])
        self.assertEqual(model.junk.get(model.x), 1.0)
        self.assertEqual(model.junk.get(model.y), 2.0)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[1]), 3.0)
        self.assertEqual(model.junk.get(model.z[2]), 3.0)
        model.junk.clear()
        model.junk.update_values([(model.x, 1.0), (model.y, 2.0), (model.z, 3.0)], expand=False)
        self.assertEqual(model.junk.get(model.x), 1.0)
        self.assertEqual(model.junk.get(model.y), 2.0)
        self.assertEqual(model.junk.get(model.z), 3.0)
        self.assertEqual(model.junk.get(model.z[1]), None)
        self.assertEqual(model.junk.get(model.z[2]), None)

    def test_clear_value(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var([1, 2, 3], dense=True)
        model.z = Var([1, 2, 3], dense=True)
        model.junk.set_value(model.x, -1.0)
        model.junk.set_value(model.y, -2.0)
        model.junk.set_value(model.y[2], 1.0)
        model.junk.set_value(model.z, 2.0)
        model.junk.set_value(model.z[1], 4.0)
        self.assertEqual(model.junk.get(model.x), -1.0)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), -2.0)
        self.assertEqual(model.junk.get(model.y[2]), 1.0)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), 2.0)
        self.assertEqual(model.junk.get(model.z[1]), 4.0)
        model.junk.clear_value(model.y)
        self.assertEqual(model.junk.get(model.x), -1.0)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), None)
        self.assertEqual(model.junk.get(model.y[2]), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), 2.0)
        self.assertEqual(model.junk.get(model.z[1]), 4.0)
        model.junk.clear_value(model.x)
        self.assertEqual(model.junk.get(model.x), None)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), None)
        self.assertEqual(model.junk.get(model.y[2]), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), 2.0)
        self.assertEqual(model.junk.get(model.z[1]), 4.0)
        model.junk.clear_value(model.x)
        self.assertEqual(model.junk.get(model.x), None)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), None)
        self.assertEqual(model.junk.get(model.y[2]), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), 2.0)
        self.assertEqual(model.junk.get(model.z[1]), 4.0)
        model.junk.clear_value(model.z[1])
        self.assertEqual(model.junk.get(model.x), None)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), None)
        self.assertEqual(model.junk.get(model.y[2]), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), 2.0)
        self.assertEqual(model.junk.get(model.z[1]), None)
        model.junk.clear_value(model.z)
        self.assertEqual(model.junk.get(model.x), None)
        self.assertEqual(model.junk.get(model.y), None)
        self.assertEqual(model.junk.get(model.y[1]), None)
        self.assertEqual(model.junk.get(model.y[2]), None)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[2]), None)
        self.assertEqual(model.junk.get(model.z[1]), None)

    def test_clear_all_values(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.x = Var()
        model.y = Var([1, 2, 3], dense=True)
        model.z = Var([1, 2, 3], dense=True)
        model.junk.set_value(model.y[2], 1.0)
        model.junk.set_value(model.z, 2.0)
        self.assertTrue(model.junk.get(model.x) is None)
        self.assertTrue(model.junk.get(model.y) is None)
        self.assertTrue(model.junk.get(model.y[1]) is None)
        self.assertEqual(model.junk.get(model.y[2]), 1.0)
        self.assertEqual(model.junk.get(model.z), None)
        self.assertEqual(model.junk.get(model.z[1]), 2.0)
        model.junk.clear_all_values()
        self.assertTrue(model.junk.get(model.x) is None)
        self.assertTrue(model.junk.get(model.y) is None)
        self.assertTrue(model.junk.get(model.y[1]) is None)
        self.assertTrue(model.junk.get(model.y[2]) is None)
        self.assertTrue(model.junk.get(model.z) is None)
        self.assertTrue(model.junk.get(model.z[1]) is None)

    def test_set_datatype_get_datatype(self):
        model = ConcreteModel()
        model.junk = Suffix(datatype=Suffix.FLOAT)
        self.assertEqual(model.junk.datatype, Suffix.FLOAT)
        model.junk.datatype = Suffix.INT
        self.assertEqual(model.junk.datatype, Suffix.INT)
        model.junk.datatype = None
        self.assertEqual(model.junk.datatype, None)
        model.junk.datatype = 'FLOAT'
        self.assertEqual(model.junk.datatype, Suffix.FLOAT)
        model.junk.datatype = 'INT'
        self.assertEqual(model.junk.datatype, Suffix.INT)
        model.junk.datatype = 4
        self.assertEqual(model.junk.datatype, Suffix.FLOAT)
        model.junk.datatype = 0
        self.assertEqual(model.junk.datatype, Suffix.INT)
        with LoggingIntercept() as LOG:
            model.junk.set_datatype(None)
        self.assertEqual(model.junk.datatype, None)
        self.assertRegex(LOG.getvalue().replace('\n', ' '), '^DEPRECATED: Suffix.set_datatype is replaced with the Suffix.datatype property')
        model.junk.datatype = 'FLOAT'
        with LoggingIntercept() as LOG:
            self.assertEqual(model.junk.get_datatype(), Suffix.FLOAT)
        self.assertRegex(LOG.getvalue().replace('\n', ' '), '^DEPRECATED: Suffix.get_datatype is replaced with the Suffix.datatype property')
        with self.assertRaisesRegex(ValueError, '1.0 is not a valid SuffixDataType'):
            model.junk.datatype = 1.0

    def test_set_direction_get_direction(self):
        model = ConcreteModel()
        model.junk = Suffix(direction=Suffix.LOCAL)
        self.assertEqual(model.junk.direction, Suffix.LOCAL)
        model.junk.direction = Suffix.EXPORT
        self.assertEqual(model.junk.direction, Suffix.EXPORT)
        model.junk.direction = Suffix.IMPORT
        self.assertEqual(model.junk.direction, Suffix.IMPORT)
        model.junk.direction = Suffix.IMPORT_EXPORT
        self.assertEqual(model.junk.direction, Suffix.IMPORT_EXPORT)
        with LoggingIntercept() as LOG:
            model.junk.set_direction(1)
        self.assertEqual(model.junk.direction, Suffix.EXPORT)
        self.assertRegex(LOG.getvalue().replace('\n', ' '), '^DEPRECATED: Suffix.set_direction is replaced with the Suffix.direction property')
        model.junk.direction = 'IMPORT'
        with LoggingIntercept() as LOG:
            self.assertEqual(model.junk.get_direction(), Suffix.IMPORT)
        self.assertRegex(LOG.getvalue().replace('\n', ' '), '^DEPRECATED: Suffix.get_direction is replaced with the Suffix.direction property')
        with self.assertRaisesRegex(ValueError, "'a' is not a valid SuffixDirection"):
            model.junk.direction = 'a'
        with self.assertRaisesRegex(ValueError, 'None is not a valid SuffixDirection'):
            model.junk.direction = None

    def test_str(self):
        model = ConcreteModel()
        model.junk = Suffix()
        self.assertEqual(model.junk.__str__(), 'junk')

    def test_pprint(self):
        model = ConcreteModel()
        model.junk = Suffix(direction=Suffix.EXPORT)
        output = StringIO()
        model.junk.pprint(ostream=output)
        self.assertEqual(output.getvalue(), 'junk : Direction=EXPORT, Datatype=FLOAT\n    Key : Value\n')
        model.junk.direction = Suffix.IMPORT
        output = StringIO()
        model.junk.pprint(ostream=output)
        self.assertEqual(output.getvalue(), 'junk : Direction=IMPORT, Datatype=FLOAT\n    Key : Value\n')
        model.junk.direction = Suffix.LOCAL
        model.junk.datatype = None
        output = StringIO()
        model.junk.pprint(ostream=output)
        self.assertEqual(output.getvalue(), 'junk : Direction=LOCAL, Datatype=None\n    Key : Value\n')
        model.junk.direction = Suffix.IMPORT_EXPORT
        model.junk.datatype = Suffix.INT
        output = StringIO()
        model.junk.pprint(ostream=output)
        self.assertEqual(output.getvalue(), 'junk : Direction=IMPORT_EXPORT, Datatype=INT\n    Key : Value\n')
        output = StringIO()
        model.pprint(ostream=output)
        self.assertEqual(output.getvalue(), '1 Suffix Declarations\n    junk : Direction=IMPORT_EXPORT, Datatype=INT\n        Key : Value\n\n1 Declarations: junk\n')

    def test_pprint_verbose(self):
        model = ConcreteModel()
        model.junk = Suffix()
        model.s = Block()
        model.s.b = Block()
        model.s.B = Block([1, 2, 3])
        model.junk.set_value(model.s.B, 1.0)
        model.junk.set_value(model.s.B[1], 2.0)
        model.junk.set_value(model.s.b, 3.0)
        model.junk.set_value(model.s.B[2], 3.0)
        output = StringIO()
        model.junk.pprint(ostream=output, verbose=True)
        self.assertEqual(output.getvalue(), 'junk : Direction=LOCAL, Datatype=FLOAT\n    Key    : Value\n    s.B[1] :   2.0\n    s.B[2] :   3.0\n    s.B[3] :   1.0\n       s.b :   3.0\n')

    def test_active_export_suffix_generator(self):
        model = ConcreteModel()
        model.junk_EXPORT_int = Suffix(direction=Suffix.EXPORT, datatype=Suffix.INT)
        model.junk_EXPORT_float = Suffix(direction=Suffix.EXPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT_float = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        model.junk_LOCAL = Suffix(direction=Suffix.LOCAL, datatype=None)
        suffixes = dict(active_export_suffix_generator(model))
        self.assertTrue('junk_EXPORT_int' in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.deactivate()
        suffixes = dict(active_export_suffix_generator(model))
        self.assertTrue('junk_EXPORT_int' in suffixes)
        self.assertTrue('junk_EXPORT_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.activate()
        suffixes = dict(active_export_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_EXPORT_int' not in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.deactivate()
        suffixes = dict(active_export_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_EXPORT_int' not in suffixes)
        self.assertTrue('junk_EXPORT_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)

    def test_export_suffix_generator(self):
        model = ConcreteModel()
        model.junk_EXPORT_int = Suffix(direction=Suffix.EXPORT, datatype=Suffix.INT)
        model.junk_EXPORT_float = Suffix(direction=Suffix.EXPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT_float = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        model.junk_LOCAL = Suffix(direction=Suffix.LOCAL, datatype=None)
        suffixes = dict(export_suffix_generator(model))
        self.assertTrue('junk_EXPORT_int' in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.deactivate()
        suffixes = dict(export_suffix_generator(model))
        self.assertTrue('junk_EXPORT_int' in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.activate()
        suffixes = dict(export_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_EXPORT_int' not in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_EXPORT_float.deactivate()
        suffixes = dict(export_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_EXPORT_int' not in suffixes)
        self.assertTrue('junk_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)

    def test_active_import_suffix_generator(self):
        model = ConcreteModel()
        model.junk_IMPORT_int = Suffix(direction=Suffix.IMPORT, datatype=Suffix.INT)
        model.junk_IMPORT_float = Suffix(direction=Suffix.IMPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT_float = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=Suffix.FLOAT)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_LOCAL = Suffix(direction=Suffix.LOCAL, datatype=None)
        suffixes = dict(active_import_suffix_generator(model))
        self.assertTrue('junk_IMPORT_int' in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.deactivate()
        suffixes = dict(active_import_suffix_generator(model))
        self.assertTrue('junk_IMPORT_int' in suffixes)
        self.assertTrue('junk_IMPORT_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.activate()
        suffixes = dict(active_import_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_IMPORT_int' not in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.deactivate()
        suffixes = dict(active_import_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_IMPORT_int' not in suffixes)
        self.assertTrue('junk_IMPORT_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)

    def test_import_suffix_generator(self):
        model = ConcreteModel()
        model.junk_IMPORT_int = Suffix(direction=Suffix.IMPORT, datatype=Suffix.INT)
        model.junk_IMPORT_float = Suffix(direction=Suffix.IMPORT, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT_float = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=Suffix.FLOAT)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_LOCAL = Suffix(direction=Suffix.LOCAL, datatype=None)
        suffixes = dict(import_suffix_generator(model))
        self.assertTrue('junk_IMPORT_int' in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.deactivate()
        suffixes = dict(import_suffix_generator(model))
        self.assertTrue('junk_IMPORT_int' in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.activate()
        suffixes = dict(import_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_IMPORT_int' not in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)
        model.junk_IMPORT_float.deactivate()
        suffixes = dict(import_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_IMPORT_int' not in suffixes)
        self.assertTrue('junk_IMPORT_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT_float' in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_LOCAL' not in suffixes)

    def test_active_local_suffix_generator(self):
        model = ConcreteModel()
        model.junk_LOCAL_int = Suffix(direction=Suffix.LOCAL, datatype=Suffix.INT)
        model.junk_LOCAL_float = Suffix(direction=Suffix.LOCAL, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=None)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        suffixes = dict(active_local_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(active_local_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.activate()
        suffixes = dict(active_local_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(active_local_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)

    def test_local_suffix_generator(self):
        model = ConcreteModel()
        model.junk_LOCAL_int = Suffix(direction=Suffix.LOCAL, datatype=Suffix.INT)
        model.junk_LOCAL_float = Suffix(direction=Suffix.LOCAL, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=None)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        suffixes = dict(local_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(local_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.activate()
        suffixes = dict(local_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(local_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)

    def test_active_suffix_generator(self):
        model = ConcreteModel()
        model.junk_LOCAL_int = Suffix(direction=Suffix.LOCAL, datatype=Suffix.INT)
        model.junk_LOCAL_float = Suffix(direction=Suffix.LOCAL, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=None)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        suffixes = dict(active_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' in suffixes)
        self.assertTrue('junk_EXPORT' in suffixes)
        self.assertTrue('junk_IMPORT' in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(active_suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' in suffixes)
        self.assertTrue('junk_EXPORT' in suffixes)
        self.assertTrue('junk_IMPORT' in suffixes)
        model.junk_LOCAL_float.activate()
        suffixes = dict(active_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(active_suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' not in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)

    def test_suffix_generator(self):
        model = ConcreteModel()
        model.junk_LOCAL_int = Suffix(direction=Suffix.LOCAL, datatype=Suffix.INT)
        model.junk_LOCAL_float = Suffix(direction=Suffix.LOCAL, datatype=Suffix.FLOAT)
        model.junk_IMPORT_EXPORT = Suffix(direction=Suffix.IMPORT_EXPORT, datatype=None)
        model.junk_EXPORT = Suffix(direction=Suffix.EXPORT, datatype=None)
        model.junk_IMPORT = Suffix(direction=Suffix.IMPORT, datatype=None)
        suffixes = dict(suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' in suffixes)
        self.assertTrue('junk_EXPORT' in suffixes)
        self.assertTrue('junk_IMPORT' in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(suffix_generator(model))
        self.assertTrue('junk_LOCAL_int' in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' in suffixes)
        self.assertTrue('junk_EXPORT' in suffixes)
        self.assertTrue('junk_IMPORT' in suffixes)
        model.junk_LOCAL_float.activate()
        suffixes = dict(suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)
        model.junk_LOCAL_float.deactivate()
        suffixes = dict(suffix_generator(model, datatype=Suffix.FLOAT))
        self.assertTrue('junk_LOCAL_int' not in suffixes)
        self.assertTrue('junk_LOCAL_float' in suffixes)
        self.assertTrue('junk_IMPORT_EXPORT' not in suffixes)
        self.assertTrue('junk_EXPORT' not in suffixes)
        self.assertTrue('junk_IMPORT' not in suffixes)