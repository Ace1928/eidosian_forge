from __future__ import annotations
import collections.abc as c
import os
import json
import typing as t
from ...target import (
from ...io import (
from ...util import (
from ...util_common import (
from ...executor import (
from ...data import (
from ...host_configs import (
from ...provisioning import (
from . import (
def _build_stub_groups(args: CoverageCombineConfig, sources: list[tuple[str, int]], default_stub_value: c.Callable[[list[str]], dict[str, TValue]]) -> dict[str, dict[str, TValue]]:
    """
    Split the given list of sources with line counts into groups, maintaining a maximum line count for each group.
    Each group consists of a dictionary of sources and default coverage stubs generated by the provided default_stub_value function.
    """
    groups = {}
    if args.stub:
        stub_group: list[str] = []
        stub_groups = [stub_group]
        stub_line_limit = 500000
        stub_line_count = 0
        for source, source_line_count in sources:
            stub_group.append(source)
            stub_line_count += source_line_count
            if stub_line_count > stub_line_limit:
                stub_line_count = 0
                stub_group = []
                stub_groups.append(stub_group)
        for stub_index, stub_group in enumerate(stub_groups):
            if not stub_group:
                continue
            groups['=stub-%02d' % (stub_index + 1)] = default_stub_value(stub_group)
    return groups