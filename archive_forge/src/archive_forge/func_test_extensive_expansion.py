import pyomo.common.unittest as unittest
from io import StringIO
import logging
from pyomo.environ import (
from pyomo.network import Arc, Port
from pyomo.core.expr.visitor import identify_variables
from pyomo.common.collections.component_set import ComponentSet
def test_extensive_expansion(self):
    m = ConcreteModel()
    m.comp = Set(initialize=['a', 'b', 'c'])
    m.feed = Block()
    m.feed.flow = Var(m.comp, domain=NonNegativeReals)
    m.feed.mass = Var()
    m.feed.temp = Var()
    m.feed.outlet = Port()
    m.feed.outlet.add(m.feed.flow, 'flow', rule=Port.Extensive, write_var_sum=False)
    m.feed.outlet.add(m.feed.mass, 'mass', rule=Port.Extensive)
    m.feed.outlet.add(m.feed.temp, 'temp')
    m.tru = Block()
    m.tru.flow_in = Var(m.comp, domain=NonNegativeReals)
    m.tru.flow_out = Var(m.comp, domain=NonNegativeReals)
    m.tru.mass = Var()
    m.tru.temp = Var()
    m.tru.inlet = Port()
    m.tru.inlet.add(m.tru.flow_in, 'flow', rule=Port.Extensive)
    m.tru.inlet.add(m.tru.mass, 'mass', rule=Port.Extensive)
    m.tru.inlet.add(m.tru.temp, 'temp')
    m.tru.outlet = Port()
    m.tru.outlet.add(m.tru.flow_out, 'flow', rule=Port.Extensive)
    m.tru.outlet.add(m.tru.mass, 'mass', rule=Port.Extensive)
    m.tru.outlet.add(m.tru.temp, 'temp')
    m.node1 = Block()
    m.node1.flow = Var(m.comp, domain=NonNegativeReals)
    m.node1.mass = Var()
    m.node1.temp = Var()
    m.node1.port = Port(initialize=[(m.node1.flow, Port.Extensive), (m.node1.mass, Port.Extensive), m.node1.temp])
    m.node2 = Block()
    m.node2.flow = Var(m.comp, domain=NonNegativeReals)
    m.node2.mass = Var()
    m.node2.temp = Var()
    m.node2.port = Port(initialize=[(m.node2.flow, Port.Extensive), (m.node2.mass, Port.Extensive), m.node2.temp])
    m.multi = Block()
    m.multi.flow = Var(m.comp, domain=NonNegativeReals)
    m.multi.mass = Var()
    m.multi.temp = Var()
    m.multi.port = Port(initialize=[(m.multi.flow, Port.Extensive), (m.multi.mass, Port.Extensive), m.multi.temp])
    m.prod = Block()
    m.prod.flow = Var(m.comp, domain=NonNegativeReals)
    m.prod.mass = Var()
    m.prod.temp = Var()
    m.prod.inlet = Port()
    m.prod.inlet.add(m.prod.flow, 'flow', rule=Port.Extensive)
    m.prod.inlet.add(m.prod.mass, 'mass', rule=Port.Extensive)
    m.prod.inlet.add(m.prod.temp, 'temp')
    m.stream0 = Arc(source=m.tru.outlet, destination=m.node1.port)
    m.stream1 = Arc(source=m.feed.outlet, destination=m.tru.inlet)
    m.stream2 = Arc(source=m.feed.outlet, destination=m.prod.inlet)
    m.stream3 = Arc(source=m.feed.outlet, destination=m.node1.port)
    m.stream4 = Arc(source=m.node1.port, destination=m.node2.port)
    m.stream5 = Arc(source=m.tru.outlet, destination=m.prod.inlet)
    m.stream6 = Arc(source=m.node2.port, destination=m.prod.inlet)
    m.stream7 = Arc(source=m.feed.outlet, destination=m.multi.port)
    m.stream8 = Arc(source=m.tru.outlet, destination=m.multi.port)
    m.stream9 = Arc(source=m.multi.port, destination=m.prod.inlet)
    m.stream10 = Arc(source=m.multi.port, destination=m.tru.inlet)
    m.feed.outlet.set_split_fraction(m.stream1, 0.6, fix=True)
    m.stream0.deactivate()
    TransformationFactory('network.expand_arcs').apply_to(m)
    os = StringIO()
    m.pprint(ostream=os)
    self.assertEqual(os.getvalue(), "1 Set Declarations\n    comp : Size=1, Index=None, Ordered=Insertion\n        Key  : Dimen : Domain : Size : Members\n        None :     1 :    Any :    3 : {'a', 'b', 'c'}\n\n16 Block Declarations\n    feed : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        2 Constraint Declarations\n            outlet_frac_sum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                                                                              : Upper : Active\n                None :   1.0 : stream1_expanded.splitfrac + stream2_expanded.splitfrac + stream3_expanded.splitfrac + stream7_expanded.splitfrac :   1.0 :   True\n            outlet_mass_outsum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                                                                      : Upper : Active\n                None :   0.0 : stream1_expanded.mass + stream2_expanded.mass + stream3_expanded.mass + stream7_expanded.mass - feed.mass :   0.0 :   True\n\n        1 Port Declarations\n            outlet : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : feed.flow\n                     : mass :    1 : feed.mass\n                     : temp :    1 : feed.temp\n\n        6 Declarations: flow mass temp outlet outlet_frac_sum outlet_mass_outsum\n    multi : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        4 Constraint Declarations\n            port_flow_insum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                : Upper : Active\n                  a :   0.0 : stream7_expanded.flow[a] + stream8_expanded.flow[a] - multi.flow[a] :   0.0 :   True\n                  b :   0.0 : stream7_expanded.flow[b] + stream8_expanded.flow[b] - multi.flow[b] :   0.0 :   True\n                  c :   0.0 : stream7_expanded.flow[c] + stream8_expanded.flow[c] - multi.flow[c] :   0.0 :   True\n            port_flow_outsum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                 : Upper : Active\n                  a :   0.0 : stream9_expanded.flow[a] + stream10_expanded.flow[a] - multi.flow[a] :   0.0 :   True\n                  b :   0.0 : stream9_expanded.flow[b] + stream10_expanded.flow[b] - multi.flow[b] :   0.0 :   True\n                  c :   0.0 : stream9_expanded.flow[c] + stream10_expanded.flow[c] - multi.flow[c] :   0.0 :   True\n            port_mass_insum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                       : Upper : Active\n                None :   0.0 : stream7_expanded.mass + stream8_expanded.mass - multi.mass :   0.0 :   True\n            port_mass_outsum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                        : Upper : Active\n                None :   0.0 : stream9_expanded.mass + stream10_expanded.mass - multi.mass :   0.0 :   True\n\n        1 Port Declarations\n            port : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : multi.flow\n                     : mass :    1 : multi.mass\n                     : temp :    1 : multi.temp\n\n        8 Declarations: flow mass temp port port_flow_outsum port_flow_insum port_mass_outsum port_mass_insum\n    node1 : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        2 Constraint Declarations\n            port_flow_insum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                     : Upper : Active\n                  a :   0.0 : stream3_expanded.flow[a] - node1.flow[a] :   0.0 :   True\n                  b :   0.0 : stream3_expanded.flow[b] - node1.flow[b] :   0.0 :   True\n                  c :   0.0 : stream3_expanded.flow[c] - node1.flow[c] :   0.0 :   True\n            port_mass_insum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                               : Upper : Active\n                None :   0.0 : stream3_expanded.mass - node1.mass :   0.0 :   True\n\n        1 Port Declarations\n            port : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : node1.flow\n                     : mass :    1 : node1.mass\n                     : temp :    1 : node1.temp\n\n        6 Declarations: flow mass temp port port_flow_insum port_mass_insum\n    node2 : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        2 Constraint Declarations\n            port_flow_outsum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                     : Upper : Active\n                  a :   0.0 : stream6_expanded.flow[a] - node2.flow[a] :   0.0 :   True\n                  b :   0.0 : stream6_expanded.flow[b] - node2.flow[b] :   0.0 :   True\n                  c :   0.0 : stream6_expanded.flow[c] - node2.flow[c] :   0.0 :   True\n            port_mass_outsum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                               : Upper : Active\n                None :   0.0 : stream6_expanded.mass - node2.mass :   0.0 :   True\n\n        1 Port Declarations\n            port : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : node2.flow\n                     : mass :    1 : node2.mass\n                     : temp :    1 : node2.temp\n\n        6 Declarations: flow mass temp port port_flow_outsum port_mass_outsum\n    prod : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        2 Constraint Declarations\n            inlet_flow_insum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                                                                     : Upper : Active\n                  a :   0.0 : stream2_expanded.flow[a] + stream5_expanded.flow[a] + stream6_expanded.flow[a] + stream9_expanded.flow[a] - prod.flow[a] :   0.0 :   True\n                  b :   0.0 : stream2_expanded.flow[b] + stream5_expanded.flow[b] + stream6_expanded.flow[b] + stream9_expanded.flow[b] - prod.flow[b] :   0.0 :   True\n                  c :   0.0 : stream2_expanded.flow[c] + stream5_expanded.flow[c] + stream6_expanded.flow[c] + stream9_expanded.flow[c] - prod.flow[c] :   0.0 :   True\n            inlet_mass_insum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                                                                      : Upper : Active\n                None :   0.0 : stream2_expanded.mass + stream5_expanded.mass + stream6_expanded.mass + stream9_expanded.mass - prod.mass :   0.0 :   True\n\n        1 Port Declarations\n            inlet : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : prod.flow\n                     : mass :    1 : prod.mass\n                     : temp :    1 : prod.temp\n\n        6 Declarations: flow mass temp inlet inlet_flow_insum inlet_mass_insum\n    stream10_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                  : Upper : Active\n                  a :   0.0 : stream10_expanded.flow[a] - stream10_expanded.splitfrac*multi.flow[a] :   0.0 :   True\n                  b :   0.0 : stream10_expanded.flow[b] - stream10_expanded.splitfrac*multi.flow[b] :   0.0 :   True\n                  c :   0.0 : stream10_expanded.flow[c] - stream10_expanded.splitfrac*multi.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                            : Upper : Active\n                None :   0.0 : stream10_expanded.mass - stream10_expanded.splitfrac*multi.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                  : Upper : Active\n                None :   0.0 : multi.temp - tru.temp :   0.0 :   True\n\n        6 Declarations: flow mass temp_equality splitfrac flow_split mass_split\n    stream1_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :   0.6 :  None :  True : False :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                               : Upper : Active\n                  a :   0.0 : stream1_expanded.flow[a] - stream1_expanded.splitfrac*feed.flow[a] :   0.0 :   True\n                  b :   0.0 : stream1_expanded.flow[b] - stream1_expanded.splitfrac*feed.flow[b] :   0.0 :   True\n                  c :   0.0 : stream1_expanded.flow[c] - stream1_expanded.splitfrac*feed.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                         : Upper : Active\n                None :   0.0 : stream1_expanded.mass - stream1_expanded.splitfrac*feed.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                 : Upper : Active\n                None :   0.0 : feed.temp - tru.temp :   0.0 :   True\n\n        6 Declarations: flow splitfrac flow_split mass mass_split temp_equality\n    stream2_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                               : Upper : Active\n                  a :   0.0 : stream2_expanded.flow[a] - stream2_expanded.splitfrac*feed.flow[a] :   0.0 :   True\n                  b :   0.0 : stream2_expanded.flow[b] - stream2_expanded.splitfrac*feed.flow[b] :   0.0 :   True\n                  c :   0.0 : stream2_expanded.flow[c] - stream2_expanded.splitfrac*feed.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                         : Upper : Active\n                None :   0.0 : stream2_expanded.mass - stream2_expanded.splitfrac*feed.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                  : Upper : Active\n                None :   0.0 : feed.temp - prod.temp :   0.0 :   True\n\n        6 Declarations: flow splitfrac flow_split mass mass_split temp_equality\n    stream3_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True :  Reals\n                  b :     0 :  None :  None : False :  True :  Reals\n                  c :     0 :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                               : Upper : Active\n                  a :   0.0 : stream3_expanded.flow[a] - stream3_expanded.splitfrac*feed.flow[a] :   0.0 :   True\n                  b :   0.0 : stream3_expanded.flow[b] - stream3_expanded.splitfrac*feed.flow[b] :   0.0 :   True\n                  c :   0.0 : stream3_expanded.flow[c] - stream3_expanded.splitfrac*feed.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                         : Upper : Active\n                None :   0.0 : stream3_expanded.mass - stream3_expanded.splitfrac*feed.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                   : Upper : Active\n                None :   0.0 : feed.temp - node1.temp :   0.0 :   True\n\n        6 Declarations: flow splitfrac flow_split mass mass_split temp_equality\n    stream4_expanded : Size=1, Index=None, Active=True\n        3 Constraint Declarations\n            flow_equality : Size=3, Index=comp, Active=True\n                Key : Lower : Body                          : Upper : Active\n                  a :   0.0 : node1.flow[a] - node2.flow[a] :   0.0 :   True\n                  b :   0.0 : node1.flow[b] - node2.flow[b] :   0.0 :   True\n                  c :   0.0 : node1.flow[c] - node2.flow[c] :   0.0 :   True\n            mass_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                    : Upper : Active\n                None :   0.0 : node1.mass - node2.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                    : Upper : Active\n                None :   0.0 : node1.temp - node2.temp :   0.0 :   True\n\n        3 Declarations: flow_equality mass_equality temp_equality\n    stream5_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                  : Upper : Active\n                  a :   0.0 : stream5_expanded.flow[a] - stream5_expanded.splitfrac*tru.flow_out[a] :   0.0 :   True\n                  b :   0.0 : stream5_expanded.flow[b] - stream5_expanded.splitfrac*tru.flow_out[b] :   0.0 :   True\n                  c :   0.0 : stream5_expanded.flow[c] - stream5_expanded.splitfrac*tru.flow_out[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                        : Upper : Active\n                None :   0.0 : stream5_expanded.mass - stream5_expanded.splitfrac*tru.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                 : Upper : Active\n                None :   0.0 : tru.temp - prod.temp :   0.0 :   True\n\n        6 Declarations: flow mass temp_equality splitfrac flow_split mass_split\n    stream6_expanded : Size=1, Index=None, Active=True\n        2 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True :  Reals\n                  b :     0 :  None :  None : False :  True :  Reals\n                  c :     0 :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        1 Constraint Declarations\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                   : Upper : Active\n                None :   0.0 : node2.temp - prod.temp :   0.0 :   True\n\n        3 Declarations: flow mass temp_equality\n    stream7_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                               : Upper : Active\n                  a :   0.0 : stream7_expanded.flow[a] - stream7_expanded.splitfrac*feed.flow[a] :   0.0 :   True\n                  b :   0.0 : stream7_expanded.flow[b] - stream7_expanded.splitfrac*feed.flow[b] :   0.0 :   True\n                  c :   0.0 : stream7_expanded.flow[c] - stream7_expanded.splitfrac*feed.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                         : Upper : Active\n                None :   0.0 : stream7_expanded.mass - stream7_expanded.splitfrac*feed.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                   : Upper : Active\n                None :   0.0 : feed.temp - multi.temp :   0.0 :   True\n\n        6 Declarations: flow splitfrac flow_split mass mass_split temp_equality\n    stream8_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                  : Upper : Active\n                  a :   0.0 : stream8_expanded.flow[a] - stream8_expanded.splitfrac*tru.flow_out[a] :   0.0 :   True\n                  b :   0.0 : stream8_expanded.flow[b] - stream8_expanded.splitfrac*tru.flow_out[b] :   0.0 :   True\n                  c :   0.0 : stream8_expanded.flow[c] - stream8_expanded.splitfrac*tru.flow_out[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                        : Upper : Active\n                None :   0.0 : stream8_expanded.mass - stream8_expanded.splitfrac*tru.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                  : Upper : Active\n                None :   0.0 : tru.temp - multi.temp :   0.0 :   True\n\n        6 Declarations: flow splitfrac flow_split mass mass_split temp_equality\n    stream9_expanded : Size=1, Index=None, Active=True\n        3 Var Declarations\n            flow : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :  None :  None :  None : False :  True :  Reals\n                  b :  None :  None :  None : False :  True :  Reals\n                  c :  None :  None :  None : False :  True :  Reals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            splitfrac : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        3 Constraint Declarations\n            flow_split : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                : Upper : Active\n                  a :   0.0 : stream9_expanded.flow[a] - stream9_expanded.splitfrac*multi.flow[a] :   0.0 :   True\n                  b :   0.0 : stream9_expanded.flow[b] - stream9_expanded.splitfrac*multi.flow[b] :   0.0 :   True\n                  c :   0.0 : stream9_expanded.flow[c] - stream9_expanded.splitfrac*multi.flow[c] :   0.0 :   True\n            mass_split : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                          : Upper : Active\n                None :   0.0 : stream9_expanded.mass - stream9_expanded.splitfrac*multi.mass :   0.0 :   True\n            temp_equality : Size=1, Index=None, Active=True\n                Key  : Lower : Body                   : Upper : Active\n                None :   0.0 : multi.temp - prod.temp :   0.0 :   True\n\n        6 Declarations: flow mass temp_equality splitfrac flow_split mass_split\n    tru : Size=1, Index=None, Active=True\n        4 Var Declarations\n            flow_in : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            flow_out : Size=3, Index=comp\n                Key : Lower : Value : Upper : Fixed : Stale : Domain\n                  a :     0 :  None :  None : False :  True : NonNegativeReals\n                  b :     0 :  None :  None : False :  True : NonNegativeReals\n                  c :     0 :  None :  None : False :  True : NonNegativeReals\n            mass : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n            temp : Size=1, Index=None\n                Key  : Lower : Value : Upper : Fixed : Stale : Domain\n                None :  None :  None :  None : False :  True :  Reals\n\n        4 Constraint Declarations\n            inlet_flow_insum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                  : Upper : Active\n                  a :   0.0 : stream1_expanded.flow[a] + stream10_expanded.flow[a] - tru.flow_in[a] :   0.0 :   True\n                  b :   0.0 : stream1_expanded.flow[b] + stream10_expanded.flow[b] - tru.flow_in[b] :   0.0 :   True\n                  c :   0.0 : stream1_expanded.flow[c] + stream10_expanded.flow[c] - tru.flow_in[c] :   0.0 :   True\n            inlet_mass_insum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                      : Upper : Active\n                None :   0.0 : stream1_expanded.mass + stream10_expanded.mass - tru.mass :   0.0 :   True\n            outlet_flow_outsum : Size=3, Index=comp, Active=True\n                Key : Lower : Body                                                                  : Upper : Active\n                  a :   0.0 : stream5_expanded.flow[a] + stream8_expanded.flow[a] - tru.flow_out[a] :   0.0 :   True\n                  b :   0.0 : stream5_expanded.flow[b] + stream8_expanded.flow[b] - tru.flow_out[b] :   0.0 :   True\n                  c :   0.0 : stream5_expanded.flow[c] + stream8_expanded.flow[c] - tru.flow_out[c] :   0.0 :   True\n            outlet_mass_outsum : Size=1, Index=None, Active=True\n                Key  : Lower : Body                                                     : Upper : Active\n                None :   0.0 : stream5_expanded.mass + stream8_expanded.mass - tru.mass :   0.0 :   True\n\n        2 Port Declarations\n            inlet : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : tru.flow_in\n                     : mass :    1 :    tru.mass\n                     : temp :    1 :    tru.temp\n            outlet : Size=1, Index=None\n                Key  : Name : Size : Variable\n                None : flow :    3 : tru.flow_out\n                     : mass :    1 :     tru.mass\n                     : temp :    1 :     tru.temp\n\n        10 Declarations: flow_in flow_out mass temp inlet outlet inlet_flow_insum inlet_mass_insum outlet_flow_outsum outlet_mass_outsum\n\n11 Arc Declarations\n    stream0 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (tru.outlet, node1.port) :     True :  False\n    stream1 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (feed.outlet, tru.inlet) :     True :  False\n    stream10 : Size=1, Index=None, Active=False\n        Key  : Ports                   : Directed : Active\n        None : (multi.port, tru.inlet) :     True :  False\n    stream2 : Size=1, Index=None, Active=False\n        Key  : Ports                     : Directed : Active\n        None : (feed.outlet, prod.inlet) :     True :  False\n    stream3 : Size=1, Index=None, Active=False\n        Key  : Ports                     : Directed : Active\n        None : (feed.outlet, node1.port) :     True :  False\n    stream4 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (node1.port, node2.port) :     True :  False\n    stream5 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (tru.outlet, prod.inlet) :     True :  False\n    stream6 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (node2.port, prod.inlet) :     True :  False\n    stream7 : Size=1, Index=None, Active=False\n        Key  : Ports                     : Directed : Active\n        None : (feed.outlet, multi.port) :     True :  False\n    stream8 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (tru.outlet, multi.port) :     True :  False\n    stream9 : Size=1, Index=None, Active=False\n        Key  : Ports                    : Directed : Active\n        None : (multi.port, prod.inlet) :     True :  False\n\n28 Declarations: comp feed tru node1 node2 multi prod stream0 stream1 stream2 stream3 stream4 stream5 stream6 stream7 stream8 stream9 stream10 stream1_expanded stream2_expanded stream3_expanded stream4_expanded stream5_expanded stream6_expanded stream7_expanded stream8_expanded stream9_expanded stream10_expanded\n")