from io import StringIO
from breezy import osutils, trace
from .bzr.inventorytree import InventoryTreeChange
def report_changes(change_iterator, reporter):
    """Report the changes from a change iterator.

    This is essentially a translation from low-level to medium-level changes.
    Further processing may be required to produce a human-readable output.
    Unfortunately, some tree-changing operations are very complex
    :change_iterator: an iterator or sequence of changes in the format
        generated by Tree.iter_changes
    :param reporter: The _ChangeReporter that will report the changes.
    """
    versioned_change_map = {(True, True): 'unchanged', (True, False): 'removed', (False, True): 'added', (False, False): 'unversioned'}

    def path_key(change):
        if change.path[0] is not None:
            path = change.path[0]
        else:
            path = change.path[1]
        return osutils.splitpath(path)
    for change in sorted(change_iterator, key=path_key):
        exe_change = False
        if change.copied:
            copied = True
            renamed = False
        elif change.renamed:
            renamed = True
            copied = False
        else:
            copied = False
            renamed = False
        if change.kind[0] != change.kind[1]:
            if change.kind[0] is None:
                modified = 'created'
            elif change.kind[1] is None:
                modified = 'deleted'
            else:
                modified = 'kind changed'
        else:
            if change.changed_content:
                modified = 'modified'
            elif change.kind[0] is None:
                modified = 'missing'
            else:
                modified = 'unchanged'
            if change.kind[1] == 'file':
                exe_change = change.executable[0] != change.executable[1]
        versioned_change = versioned_change_map[change.versioned]
        reporter.report(change.path, versioned_change, renamed, copied, modified, exe_change, change.kind)