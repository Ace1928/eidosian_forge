from __future__ import division
import pyparsing as pp
from collections import namedtuple
from datetime import datetime
class TestParseAction(PyparsingExpressionTestCase):
    tests = [PpTestSpec(desc='Parsing real numbers - use parse action to convert to float at parse time', expr=pp.Combine(pp.Word(pp.nums) + '.' + pp.Word(pp.nums)).addParseAction(lambda t: float(t[0]))[...], text='1.2 2.3 3.1416 98.6', expected_list=[1.2, 2.3, 3.1416, 98.6]), PpTestSpec(desc='Match with numeric string converted to int', expr=pp.Word('0123456789').addParseAction(lambda t: int(t[0])), text='12345', expected_list=[12345]), PpTestSpec(desc='Use two parse actions to convert numeric string, then convert to datetime', expr=pp.Word(pp.nums).addParseAction(lambda t: int(t[0]), lambda t: datetime.utcfromtimestamp(t[0])), text='1537415628', expected_list=[datetime(2018, 9, 20, 3, 53, 48)]), PpTestSpec(desc='Use tokenMap for parse actions that operate on a single-length token', expr=pp.Word(pp.nums).addParseAction(pp.tokenMap(int), pp.tokenMap(datetime.utcfromtimestamp)), text='1537415628', expected_list=[datetime(2018, 9, 20, 3, 53, 48)]), PpTestSpec(desc='Using a built-in function that takes a sequence of strs as a parse action', expr=pp.Word(pp.hexnums, exact=2)[...].addParseAction(':'.join), text='0A4B7321FE76', expected_list=['0A:4B:73:21:FE:76']), PpTestSpec(desc='Using a built-in function that takes a sequence of strs as a parse action', expr=pp.Word(pp.hexnums, exact=2)[...].addParseAction(sorted), text='0A4B7321FE76', expected_list=['0A', '21', '4B', '73', '76', 'FE'])]