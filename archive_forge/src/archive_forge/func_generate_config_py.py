import os
import re
import sys
import copy
import glob
import atexit
import tempfile
import subprocess
import shutil
import multiprocessing
import textwrap
import importlib.util
from threading import local as tlocal
from functools import reduce
import distutils
from distutils.errors import DistutilsError
def generate_config_py(target):
    """Generate config.py file containing system_info information
    used during building the package.

    Usage:
        config['py_modules'].append((packagename, '__config__',generate_config_py))
    """
    from numpy.distutils.system_info import system_info
    from distutils.dir_util import mkpath
    mkpath(os.path.dirname(target))
    with open(target, 'w') as f:
        f.write("# This file is generated by numpy's %s\n" % os.path.basename(sys.argv[0]))
        f.write('# It contains system_info results at the time of building this package.\n')
        f.write('__all__ = ["get_info","show"]\n\n')
        f.write(textwrap.dedent("\n            import os\n            import sys\n\n            extra_dll_dir = os.path.join(os.path.dirname(__file__), '.libs')\n\n            if sys.platform == 'win32' and os.path.isdir(extra_dll_dir):\n                os.add_dll_directory(extra_dll_dir)\n\n            "))
        for k, i in system_info.saved_results.items():
            f.write('%s=%r\n' % (k, i))
        f.write(textwrap.dedent('\n            def get_info(name):\n                g = globals()\n                return g.get(name, g.get(name + "_info", {}))\n\n            def show():\n                """\n                Show libraries in the system on which NumPy was built.\n\n                Print information about various resources (libraries, library\n                directories, include directories, etc.) in the system on which\n                NumPy was built.\n\n                See Also\n                --------\n                get_include : Returns the directory containing NumPy C\n                              header files.\n\n                Notes\n                -----\n                1. Classes specifying the information to be printed are defined\n                   in the `numpy.distutils.system_info` module.\n\n                   Information may include:\n\n                   * ``language``: language used to write the libraries (mostly\n                     C or f77)\n                   * ``libraries``: names of libraries found in the system\n                   * ``library_dirs``: directories containing the libraries\n                   * ``include_dirs``: directories containing library header files\n                   * ``src_dirs``: directories containing library source files\n                   * ``define_macros``: preprocessor macros used by\n                     ``distutils.setup``\n                   * ``baseline``: minimum CPU features required\n                   * ``found``: dispatched features supported in the system\n                   * ``not found``: dispatched features that are not supported\n                     in the system\n\n                2. NumPy BLAS/LAPACK Installation Notes\n\n                   Installing a numpy wheel (``pip install numpy`` or force it\n                   via ``pip install numpy --only-binary :numpy: numpy``) includes\n                   an OpenBLAS implementation of the BLAS and LAPACK linear algebra\n                   APIs. In this case, ``library_dirs`` reports the original build\n                   time configuration as compiled with gcc/gfortran; at run time\n                   the OpenBLAS library is in\n                   ``site-packages/numpy.libs/`` (linux), or\n                   ``site-packages/numpy/.dylibs/`` (macOS), or\n                   ``site-packages/numpy/.libs/`` (windows).\n\n                   Installing numpy from source\n                   (``pip install numpy --no-binary numpy``) searches for BLAS and\n                   LAPACK dynamic link libraries at build time as influenced by\n                   environment variables NPY_BLAS_LIBS, NPY_CBLAS_LIBS, and\n                   NPY_LAPACK_LIBS; or NPY_BLAS_ORDER and NPY_LAPACK_ORDER;\n                   or the optional file ``~/.numpy-site.cfg``.\n                   NumPy remembers those locations and expects to load the same\n                   libraries at run-time.\n                   In NumPy 1.21+ on macOS, \'accelerate\' (Apple\'s Accelerate BLAS\n                   library) is in the default build-time search order after\n                   \'openblas\'.\n\n                Examples\n                --------\n                >>> import numpy as np\n                >>> np.show_config()\n                blas_opt_info:\n                    language = c\n                    define_macros = [(\'HAVE_CBLAS\', None)]\n                    libraries = [\'openblas\', \'openblas\']\n                    library_dirs = [\'/usr/local/lib\']\n                """\n                from numpy.core._multiarray_umath import (\n                    __cpu_features__, __cpu_baseline__, __cpu_dispatch__\n                )\n                for name,info_dict in globals().items():\n                    if name[0] == "_" or type(info_dict) is not type({}): continue\n                    print(name + ":")\n                    if not info_dict:\n                        print("  NOT AVAILABLE")\n                    for k,v in info_dict.items():\n                        v = str(v)\n                        if k == "sources" and len(v) > 200:\n                            v = v[:60] + " ...\\n... " + v[-60:]\n                        print("    %s = %s" % (k,v))\n\n                features_found, features_not_found = [], []\n                for feature in __cpu_dispatch__:\n                    if __cpu_features__[feature]:\n                        features_found.append(feature)\n                    else:\n                        features_not_found.append(feature)\n\n                print("Supported SIMD extensions in this NumPy install:")\n                print("    baseline = %s" % (\',\'.join(__cpu_baseline__)))\n                print("    found = %s" % (\',\'.join(features_found)))\n                print("    not found = %s" % (\',\'.join(features_not_found)))\n\n                    '))
    return target