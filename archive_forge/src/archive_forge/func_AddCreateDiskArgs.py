from __future__ import absolute_import
from __future__ import division
from __future__ import unicode_literals
import copy
import functools
import ipaddress
from googlecloudsdk.api_lib.compute import constants
from googlecloudsdk.api_lib.compute import containers_utils
from googlecloudsdk.api_lib.compute import csek_utils
from googlecloudsdk.api_lib.compute import disks_util
from googlecloudsdk.api_lib.compute import image_utils
from googlecloudsdk.api_lib.compute import kms_utils
from googlecloudsdk.api_lib.compute import utils
from googlecloudsdk.api_lib.compute.zones import service as zones_service
from googlecloudsdk.api_lib.util import apis
from googlecloudsdk.calliope import actions
from googlecloudsdk.calliope import arg_parsers
from googlecloudsdk.calliope import base
from googlecloudsdk.calliope import exceptions
from googlecloudsdk.command_lib.compute import completers as compute_completers
from googlecloudsdk.command_lib.compute import exceptions as compute_exceptions
from googlecloudsdk.command_lib.compute import flags as compute_flags
from googlecloudsdk.command_lib.compute import scope as compute_scope
from googlecloudsdk.command_lib.compute.kms import resource_args as kms_resource_args
from googlecloudsdk.command_lib.util.apis import arg_utils
from googlecloudsdk.core import log
from googlecloudsdk.core import properties
from googlecloudsdk.core import resources as core_resources
import six
def AddCreateDiskArgs(parser, enable_kms=False, enable_snapshots=False, container_mount_enabled=False, source_snapshot_csek=False, image_csek=False, include_name=True, support_boot=False, support_multi_writer=False, support_replica_zones=True, enable_source_instant_snapshots=False, enable_confidential_compute=False):
    """Adds create-disk argument for instances and instance-templates."""
    disk_device_name_help = GetDiskDeviceNameHelp(container_mount_enabled=container_mount_enabled)
    disk_name_extra_help = '' if not container_mount_enabled else ' Must specify this option if attaching the disk to a container with `--container-mount-disk`.'
    disk_mode_extra_help = '' if not container_mount_enabled else ' It is an error to create a disk in `ro` mode if attaching it to a container with `--container-mount-disk`.'
    disk_help = "      Creates and attaches persistent disks to the instances.\n\n      *name*::: Specifies the name of the disk. This option cannot be\n      specified if more than one instance is being created.{disk_name}\n\n      *description*::: Optional textual description for the disk being created.\n\n      *mode*::: Specifies the mode of the disk. Supported options\n      are ``ro'' for read-only and ``rw'' for read-write. If\n      omitted, ``rw'' is used as a default.{disk_mode}\n\n      *image*::: Specifies the name of the image that the disk will be\n      initialized with. A new disk will be created based on the given\n      image. To view a list of public images and projects, run\n      `$ gcloud compute images list`. It is best practice to use image when\n      a specific version of an image is needed. If both image and image-family\n      flags are omitted a blank disk will be created.\n\n      *image-family*::: The image family for the operating system that the boot\n      disk will be initialized with. Compute Engine offers multiple Linux\n      distributions, some of which are available as both regular and\n      Shielded VM images.  When a family is specified instead of an image,\n      the latest non-deprecated image associated with that family is\n      used. It is best practice to use --image-family when the latest\n      version of an image is needed.\n\n      *image-project*::: The Google Cloud project against which all image and\n      image family references will be resolved. It is best practice to define\n      image-project. A full list of available image projects can be generated by\n      running `gcloud compute images list`.\n\n        * If specifying one of our public images, image-project must be\n          provided.\n        * If there are several of the same image-family value in multiple\n          projects, image-project must be specified to clarify the image to be\n          used.\n        * If not specified and either image or image-family is provided, the\n          current default project is used.\n\n      *size*::: The size of the disk. The value must be a whole number\n      followed by a size unit of ``KB'' for kilobyte, ``MB'' for\n      megabyte, ``GB'' for gigabyte, or ``TB'' for terabyte. For\n      example, ``10GB'' will produce a 10 gigabyte disk. Disk size must\n      be a multiple of 1 GB. If not specified, the default image size\n      will be used for the new disk.\n\n      *type*::: The type of the disk. To get a list of available disk\n      types, run $ gcloud compute disk-types list. The default disk type\n      is ``pd-standard''.\n\n      *device-name*::: {disk_device}\n\n      *provisioned-iops*::: Indicates how many IOPS to provision for the disk.\n      This sets the number of I/O operations per second that the disk can\n      handle. Value must be between 10,000 and 120,000.\n\n      *provisioned-throughput*::: Indicates how much throughput to provision for\n      the disk. This sets the number of throughput mb per second that the disk\n      can handle.\n\n      *disk-resource-policy*::: Resource policy to apply to the disk. Specify a full or partial URL. For example:\n        * ``https://www.googleapis.com/compute/v1/projects/my-project/regions/us-central1/resourcePolicies/my-resource-policy''\n        * ``projects/my-project/regions/us-central1/resourcePolicies/my-resource-policy''\n\n      For more information, see the following docs:\n        * https://cloud.google.com/sdk/gcloud/reference/beta/compute/resource-policies/\n        * https://cloud.google.com/compute/docs/disks/scheduled-snapshots\n\n      *auto-delete*::: If ``yes'', this persistent disk will be\n      automatically deleted when the instance is deleted. However,\n      if the disk is later detached from the instance, this option\n      won't apply. The default value for this is ``yes''.\n\n      *architecture*::: Specifies the architecture or processor type that this\n      disk can support. For available processor types on Compute Engine, see\n      https://cloud.google.com/compute/docs/cpu-platforms.\n\n      *storage-pool*::: The name of the storage pool in which the new disk is\n      created. The new disk and the storage pool must be in the same location.\n      ".format(disk_name=disk_name_extra_help, disk_mode=disk_mode_extra_help, disk_device=disk_device_name_help)
    if support_boot:
        disk_help += "\n      *boot*::: If ``yes'', indicates that this is a boot disk. The\n      instance will use the first partition of the disk for\n      its root file system. The default value for this is ``no''.\n    "
    if enable_kms:
        disk_help += "\n      *kms-key*::: Fully qualified Cloud KMS cryptokey name that will\n      protect the {resource}.\n\n      This can either be the fully qualified path or the name.\n\n      The fully qualified Cloud KMS cryptokey name format is:\n      ``projects/<kms-project>/locations/<kms-location>/keyRings/<kms-keyring>/\n      cryptoKeys/<key-name>''.\n\n      If the value is not fully qualified then kms-location, kms-keyring, and\n      optionally kms-project are required.\n\n      See {kms_help} for more details.\n\n      *kms-project*::: Project that contains the Cloud KMS cryptokey that will\n      protect the {resource}.\n\n      If the project is not specified then the project where the {resource} is\n      being created will be used.\n\n      If this flag is set then key-location, kms-keyring, and kms-key\n      are required.\n\n      See {kms_help} for more details.\n\n      *kms-location*::: Location of the Cloud KMS cryptokey to be used for\n      protecting the {resource}.\n\n      All Cloud KMS cryptokeys are reside in a 'location'.\n      To get a list of possible locations run 'gcloud kms locations list'.\n      If this flag is set then kms-keyring and kms-key are required.\n      See {kms_help} for more details.\n\n      *kms-keyring*::: The keyring which contains the Cloud KMS cryptokey that\n      will protect the {resource}.\n\n      If this flag is set then kms-location and kms-key are required.\n\n      See {kms_help} for more details.\n      ".format(resource='disk', kms_help=kms_utils.KMS_HELP_URL)
    spec = {'description': str, 'mode': str, 'image': str, 'image-family': str, 'image-project': str, 'size': arg_parsers.BinarySize(lower_bound='1GB'), 'type': str, 'device-name': str, 'auto-delete': arg_parsers.ArgBoolean(), 'provisioned-iops': int, 'provisioned-throughput': int, 'disk-resource-policy': arg_parsers.ArgList(max_length=1), 'architecture': str, 'storage-pool': str}
    if include_name:
        spec['name'] = str
    if enable_kms:
        spec['kms-key'] = str
        spec['kms-project'] = str
        spec['kms-location'] = str
        spec['kms-keyring'] = str
    if support_boot:
        spec['boot'] = arg_parsers.ArgBoolean()
    if enable_snapshots:
        disk_help += '\n      *source-snapshot*::: The source disk snapshot that will be used to\n      create the disk. You can provide this as a full URL\n      to the snapshot or just the snapshot name. For example, the following\n      are valid values:\n\n        * https://compute.googleapis.com/compute/v1/projects/myproject/global/snapshots/snapshot\n        * snapshot\n      '
        spec['source-snapshot'] = str
    if source_snapshot_csek:
        disk_help += '\n      *source-snapshot-csek-required*::: The CSK protected source disk snapshot\n      that will be used to create the disk. This can be provided as a full URL\n      to the snapshot or just the snapshot name. Must be specified with\n      `source-snapshot-csek-key-file`. The following are valid values:\n\n        * https://www.googleapis.com/compute/v1/projects/myproject/global/snapshots/snapshot\n        * snapshot\n\n      *source-snapshot-csek-key-file*::: Path to a Customer-Supplied Encryption\n      Key (CSEK) key file for the source snapshot. Must be specified with\n      `source-snapshot-csek-required`.\n      '
        spec['source-snapshot-csek-key-file'] = str
    if enable_source_instant_snapshots:
        disk_help += '\n      *source-instant-snapshot*::: The source disk instant snapshot that will be used to\n      create the disk. You can provide this as a full URL\n      to the instant snapshot. For example, the following is a valid value:\n\n        * https://compute.googleapis.com/compute/v1/projects/myproject/zones/myzone/instantSnapshots/instantSnapshot\n      '
        spec['source-instant-snapshot'] = str
    if image_csek:
        disk_help += '\n      *image-csek-required*::: Specifies the name of the CSK protected image\n      that the disk will be initialized with. A new disk will be created based\n      on the given image. To view a list of public images and projects, run\n      `$ gcloud compute images list`. It is best practice to use image when\n      a specific version of an image is needed. If both image and image-family\n      flags are omitted a blank disk will be created. Must be specified with\n      `image-csek-key-file`.\n\n      *image-csek-key-file*::: Path to a Customer-Supplied Encryption Key (CSEK)\n      key file for the image. Must be specified with `image-csek-required`.\n    '
        spec['image-csek-key-file'] = str
    if support_multi_writer:
        spec['multi-writer'] = arg_parsers.ArgBoolean()
        disk_help += "\n      *multi-writer*::: If ``yes'', the disk is created in multi-writer mode so\n      that it can be attached with read-write access to two VMs. The\n      default value is ``no''.\n      The multi-writer feature requires specialized filesystems, among other\n      restrictions. For more information, see\n      https://cloud.google.com/compute/docs/disks/sharing-disks-between-vms.\n    "
    if enable_confidential_compute:
        spec['confidential-compute'] = arg_parsers.ArgBoolean()
        disk_help += "\n      *confidential-compute*::: If ``yes'', the disk is created in confidential\n      mode. The default value is ``no''. Encryption with a Cloud KMS key is required to enable this option.\n    "
    if support_replica_zones:
        disk_help += '\n      *replica-zones*::: Required for each regional disk associated with the\n      instance. Specify the URLs of the zones where the disk should be\n      replicated to. You must provide exactly two replica zones, and one zone\n      must be the same as the instance zone.\n    '
        spec['replica-zones'] = arg_parsers.ArgList(max_length=2)
    parser.add_argument('--create-disk', type=arg_parsers.ArgDict(spec=spec), action='append', metavar='PROPERTY=VALUE', help=disk_help)