from binascii import hexlify, unhexlify
from base64 import b64encode, b64decode
import logging; log = logging.getLogger(__name__)
from passlib.utils import to_unicode
from passlib.utils.binary import ab64_decode, ab64_encode
from passlib.utils.compat import str_to_bascii, u, uascii_to_str, unicode
from passlib.crypto.digest import pbkdf2_hmac
import passlib.utils.handlers as uh
def create_pbkdf2_hash(hash_name, digest_size, rounds=12000, ident=None, module=__name__):
    """create new Pbkdf2DigestHandler subclass for a specific hash"""
    name = 'pbkdf2_' + hash_name
    if ident is None:
        ident = u('$pbkdf2-%s$') % (hash_name,)
    base = Pbkdf2DigestHandler
    return type(name, (base,), dict(__module__=module, name=name, ident=ident, _digest=hash_name, default_rounds=rounds, checksum_size=digest_size, encoded_checksum_size=(digest_size * 4 + 2) // 3, __doc__='This class implements a generic ``PBKDF2-HMAC-%(digest)s``-based password hash, and follows the :ref:`password-hash-api`.\n\n    It supports a variable-length salt, and a variable number of rounds.\n\n    The :meth:`~passlib.ifc.PasswordHash.using` method accepts the following optional keywords:\n\n    :type salt: bytes\n    :param salt:\n        Optional salt bytes.\n        If specified, the length must be between 0-1024 bytes.\n        If not specified, a %(dsc)d byte salt will be autogenerated (this is recommended).\n\n    :type salt_size: int\n    :param salt_size:\n        Optional number of bytes to use when autogenerating new salts.\n        Defaults to %(dsc)d bytes, but can be any value between 0 and 1024.\n\n    :type rounds: int\n    :param rounds:\n        Optional number of rounds to use.\n        Defaults to %(dr)d, but must be within ``range(1,1<<32)``.\n\n    :type relaxed: bool\n    :param relaxed:\n        By default, providing an invalid value for one of the other\n        keywords will result in a :exc:`ValueError`. If ``relaxed=True``,\n        and the error can be corrected, a :exc:`~passlib.exc.PasslibHashWarning`\n        will be issued instead. Correctable errors include ``rounds``\n        that are too small or too large, and ``salt`` strings that are too long.\n\n        .. versionadded:: 1.6\n    ' % dict(digest=hash_name.upper(), dsc=base.default_salt_size, dr=rounds)))