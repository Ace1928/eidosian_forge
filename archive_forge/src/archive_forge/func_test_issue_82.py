from __future__ import absolute_import, print_function, unicode_literals
import pytest  # NOQA
import sys
from .roundtrip import (
def test_issue_82(self, tmpdir):
    program_src = '\n        from __future__ import print_function\n\n        import srsly.ruamel_yaml as yaml\n\n        import re\n\n\n        class SINumber(yaml.YAMLObject):\n            PREFIXES = {\'k\': 1e3, \'M\': 1e6, \'G\': 1e9}\n            yaml_loader = yaml.Loader\n            yaml_dumper = yaml.Dumper\n            yaml_tag = u\'!si\'\n            yaml_implicit_pattern = re.compile(\n                r\'^(?P<value>[0-9]+(?:\\.[0-9]+)?)(?P<prefix>[kMG])$\')\n\n            @classmethod\n            def from_yaml(cls, loader, node):\n                return cls(node.value)\n\n            @classmethod\n            def to_yaml(cls, dumper, data):\n                return dumper.represent_scalar(cls.yaml_tag, str(data))\n\n            def __init__(self, *args):\n                m = self.yaml_implicit_pattern.match(args[0])\n                self.value = float(m.groupdict()[\'value\'])\n                self.prefix = m.groupdict()[\'prefix\']\n\n            def __str__(self):\n                return str(self.value)+self.prefix\n\n            def __int__(self):\n                return int(self.value*self.PREFIXES[self.prefix])\n\n        # This fails:\n        yaml.add_implicit_resolver(SINumber.yaml_tag, SINumber.yaml_implicit_pattern)\n\n        ret = yaml.load("""\n        [1,2,3, !si 10k, 100G]\n        """, Loader=yaml.Loader)\n        for idx, l in enumerate([1, 2, 3, 10000, 100000000000]):\n            assert int(ret[idx]) == l\n        '
    assert save_and_run(dedent(program_src), tmpdir) == 1