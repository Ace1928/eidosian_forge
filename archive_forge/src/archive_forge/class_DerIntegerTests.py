import unittest
from Cryptodome.Util.py3compat import *
from Cryptodome.Util.asn1 import (DerObject, DerSetOf, DerInteger,
class DerIntegerTests(unittest.TestCase):

    def testInit1(self):
        der = DerInteger(1)
        self.assertEqual(der.encode(), b('\x02\x01\x01'))

    def testEncode1(self):
        der = DerInteger(0)
        self.assertEqual(der.encode(), b('\x02\x01\x00'))
        der = DerInteger(1)
        self.assertEqual(der.encode(), b('\x02\x01\x01'))
        der = DerInteger(127)
        self.assertEqual(der.encode(), b('\x02\x01\x7f'))

    def testEncode2(self):
        der = DerInteger(128)
        self.assertEqual(der.encode(), b('\x02\x02\x00\x80'))
        der = DerInteger(384)
        self.assertEqual(der.encode(), b('\x02\x02\x01\x80'))
        der = DerInteger(2 ** 2048)
        self.assertEqual(der.encode(), b('\x02\x82\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00'))

    def testEncode3(self):
        der = DerInteger(-1)
        self.assertEqual(der.encode(), b('\x02\x01ÿ'))
        der = DerInteger(-128)
        self.assertEqual(der.encode(), b('\x02\x01\x80'))
        der = DerInteger(-87873)
        self.assertEqual(der.encode(), b('\x02\x03þ¨¿'))

    def testEncode4(self):
        number = DerInteger(52, explicit=3)
        self.assertEqual(number.encode(), b('£\x03\x02\x014'))

    def testDecode1(self):
        der = DerInteger()
        der.decode(b('\x02\x01\x00'))
        self.assertEqual(der.value, 0)
        der.decode(b('\x02\x01\x01'))
        self.assertEqual(der.value, 1)
        der.decode(b('\x02\x01\x7f'))
        self.assertEqual(der.value, 127)

    def testDecode2(self):
        der = DerInteger()
        der.decode(b('\x02\x02\x01\x80'))
        self.assertEqual(der.value, 384)
        der.decode(b('\x02\x82\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00') + b('\x00\x00\x00\x00\x00\x00\x00\x00\x00'))
        self.assertEqual(der.value, 2 ** 2048)

    def testDecode3(self):
        der = DerInteger()
        der.decode(b('\x02\x01ÿ'))
        self.assertEqual(der.value, -1)
        der.decode(b('\x02\x02\x80\x00'))
        self.assertEqual(der.value, -32768)

    def testDecode5(self):
        der = DerInteger()
        der.decode(b('\x02\x02\x00\x01'))
        self.assertEqual(der.value, 1)
        der.decode(b('\x02\x02ÿÿ'))
        self.assertEqual(der.value, -1)
        der.decode(b('\x02\x00'))
        self.assertEqual(der.value, 0)

    def testDecode6(self):
        number = DerInteger(explicit=3)
        number.decode(b('£\x03\x02\x014'))
        self.assertEqual(number.value, 52)

    def testDecode7(self):
        der = DerInteger()
        self.assertEqual(der, der.decode(b('\x02\x01\x7f')))

    def testStrict1(self):
        number = DerInteger()
        number.decode(b'\x02\x02\x00\x01')
        number.decode(b'\x02\x02\x00\x7f')
        self.assertRaises(ValueError, number.decode, b'\x02\x02\x00\x01', strict=True)
        self.assertRaises(ValueError, number.decode, b'\x02\x02\x00\x7f', strict=True)

    def testErrDecode1(self):
        der = DerInteger()
        self.assertRaises(ValueError, der.decode, b('\x02\x81\x01\x01'))