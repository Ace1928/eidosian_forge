import os
import unittest
from pygame.tests import test_utils
from pygame.tests.test_utils import (
import pygame
from pygame.locals import *
from pygame.bufferproxy import BufferProxy
import platform
import gc
import weakref
import ctypes
@unittest.skipIf('arm' in platform.machine() or 'aarch64' in platform.machine(), 'sdl2 blitter produces different results on arm')
def test_src_alpha_sdl2_blitter(self):
    """Checking that the BLEND_ALPHA_SDL2 flag works - this feature
        only exists when using SDL2"""
    results_expected = {((0, 255, 255), (0, 255, 0)): (0, 255, 255, 255), ((0, 255, 255), (1, 254, 1)): (0, 253, 253, 253), ((0, 255, 255), (65, 199, 65)): (16, 253, 239, 253), ((0, 255, 255), (126, 127, 126)): (62, 253, 190, 253), ((0, 255, 255), (127, 126, 127)): (63, 253, 189, 253), ((0, 255, 255), (199, 65, 199)): (154, 253, 105, 253), ((0, 255, 255), (254, 1, 254)): (252, 253, 0, 253), ((0, 255, 255), (255, 0, 255)): (255, 255, 0, 255), ((1, 254, 254), (0, 255, 0)): (1, 255, 254, 254), ((1, 254, 254), (1, 254, 1)): (0, 253, 252, 252), ((1, 254, 254), (65, 199, 65)): (16, 253, 238, 252), ((1, 254, 254), (126, 127, 126)): (62, 253, 189, 252), ((1, 254, 254), (127, 126, 127)): (63, 253, 189, 253), ((1, 254, 254), (199, 65, 199)): (154, 253, 105, 253), ((1, 254, 254), (254, 1, 254)): (252, 253, 0, 253), ((1, 254, 254), (255, 0, 255)): (255, 255, 0, 255), ((65, 199, 199), (0, 255, 0)): (65, 255, 199, 199), ((65, 199, 199), (1, 254, 1)): (64, 253, 197, 197), ((65, 199, 199), (65, 199, 65)): (64, 253, 197, 211), ((65, 199, 199), (126, 127, 126)): (94, 253, 162, 225), ((65, 199, 199), (127, 126, 127)): (95, 253, 161, 225), ((65, 199, 199), (199, 65, 199)): (168, 253, 93, 241), ((65, 199, 199), (254, 1, 254)): (252, 253, 0, 253), ((65, 199, 199), (255, 0, 255)): (255, 255, 0, 255), ((126, 127, 127), (0, 255, 0)): (126, 255, 127, 127), ((126, 127, 127), (1, 254, 1)): (125, 253, 126, 126), ((126, 127, 127), (65, 199, 65)): (109, 253, 144, 158), ((126, 127, 127), (126, 127, 126)): (125, 253, 125, 188), ((126, 127, 127), (127, 126, 127)): (126, 253, 125, 189), ((126, 127, 127), (199, 65, 199)): (181, 253, 77, 225), ((126, 127, 127), (254, 1, 254)): (252, 253, 0, 253), ((126, 127, 127), (255, 0, 255)): (255, 255, 0, 255), ((127, 126, 126), (0, 255, 0)): (127, 255, 126, 126), ((127, 126, 126), (1, 254, 1)): (126, 253, 125, 125), ((127, 126, 126), (65, 199, 65)): (110, 253, 143, 157), ((127, 126, 126), (126, 127, 126)): (125, 253, 125, 188), ((127, 126, 126), (127, 126, 127)): (126, 253, 125, 189), ((127, 126, 126), (199, 65, 199)): (181, 253, 77, 225), ((127, 126, 126), (254, 1, 254)): (252, 253, 0, 253), ((127, 126, 126), (255, 0, 255)): (255, 255, 0, 255), ((199, 65, 65), (0, 255, 0)): (199, 255, 65, 65), ((199, 65, 65), (1, 254, 1)): (197, 253, 64, 64), ((199, 65, 65), (65, 199, 65)): (163, 253, 98, 112), ((199, 65, 65), (126, 127, 126)): (162, 253, 94, 157), ((199, 65, 65), (127, 126, 127)): (162, 253, 94, 158), ((199, 65, 65), (199, 65, 199)): (197, 253, 64, 212), ((199, 65, 65), (254, 1, 254)): (252, 253, 0, 253), ((199, 65, 65), (255, 0, 255)): (255, 255, 0, 255), ((254, 1, 1), (0, 255, 0)): (254, 255, 1, 1), ((254, 1, 1), (1, 254, 1)): (252, 253, 0, 0), ((254, 1, 1), (65, 199, 65)): (204, 253, 50, 64), ((254, 1, 1), (126, 127, 126)): (189, 253, 62, 125), ((254, 1, 1), (127, 126, 127)): (190, 253, 62, 126), ((254, 1, 1), (199, 65, 199)): (209, 253, 50, 198), ((254, 1, 1), (254, 1, 254)): (252, 253, 0, 253), ((254, 1, 1), (255, 0, 255)): (255, 255, 0, 255), ((255, 0, 0), (0, 255, 0)): (255, 255, 0, 0), ((255, 0, 0), (1, 254, 1)): (253, 253, 0, 0), ((255, 0, 0), (65, 199, 65)): (205, 253, 50, 64), ((255, 0, 0), (126, 127, 126)): (190, 253, 62, 125), ((255, 0, 0), (127, 126, 127)): (190, 253, 62, 126), ((255, 0, 0), (199, 65, 199)): (209, 253, 50, 198), ((255, 0, 0), (254, 1, 254)): (252, 253, 0, 253), ((255, 0, 0), (255, 0, 255)): (255, 255, 0, 255)}
    nums = [0, 1, 65, 126, 127, 199, 254, 255]
    results = {}
    for dst_r, dst_b, dst_a in zip(nums, reversed(nums), reversed(nums)):
        for src_r, src_b, src_a in zip(nums, reversed(nums), nums):
            with self.subTest(src_r=src_r, src_b=src_b, src_a=src_a, dest_r=dst_r, dest_b=dst_b, dest_a=dst_a):
                src_surf = pygame.Surface((66, 66), pygame.SRCALPHA, 32)
                src_surf.fill((src_r, 255, src_b, src_a))
                dest_surf = pygame.Surface((66, 66), pygame.SRCALPHA, 32)
                dest_surf.fill((dst_r, 255, dst_b, dst_a))
                dest_surf.blit(src_surf, (0, 0), special_flags=pygame.BLEND_ALPHA_SDL2)
                key = ((dst_r, dst_b, dst_a), (src_r, src_b, src_a))
                results[key] = tuple(dest_surf.get_at((65, 33)))
                for i in range(4):
                    self.assertAlmostEqual(results[key][i], results_expected[key][i], delta=4)