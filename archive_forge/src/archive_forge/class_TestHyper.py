import functools
import itertools
import operator
import platform
import sys
import numpy as np
from numpy import (array, isnan, r_, arange, finfo, pi, sin, cos, tan, exp,
import pytest
from pytest import raises as assert_raises
from numpy.testing import (assert_equal, assert_almost_equal,
from scipy import special
import scipy.special._ufuncs as cephes
from scipy.special import ellipe, ellipk, ellipkm1
from scipy.special import elliprc, elliprd, elliprf, elliprg, elliprj
from scipy.special import mathieu_odd_coef, mathieu_even_coef, stirling2
from scipy._lib.deprecation import _NoValue
from scipy._lib._util import np_long, np_ulong
from scipy.special._basic import _FACTORIALK_LIMITS_64BITS, \
from scipy.special._testutils import with_special_errors, \
import math
class TestHyper:

    def test_h1vp(self):
        h1 = special.h1vp(1, 0.1)
        h1real = special.jvp(1, 0.1) + special.yvp(1, 0.1) * 1j
        assert_almost_equal(h1, h1real, 8)

    def test_h2vp(self):
        h2 = special.h2vp(1, 0.1)
        h2real = special.jvp(1, 0.1) - special.yvp(1, 0.1) * 1j
        assert_almost_equal(h2, h2real, 8)

    def test_hyp0f1(self):
        assert_allclose(special.hyp0f1(2.5, 0.5), 1.21482702689997, rtol=1e-12)
        assert_allclose(special.hyp0f1(2.5, 0), 1.0, rtol=1e-15)
        x = special.hyp0f1(3.0, [-1.5, -1, 0, 1, 1.5])
        expected = np.array([0.58493659229143, 0.70566805723127, 1.0, 1.37789689539747, 1.6037368528848])
        assert_allclose(x, expected, rtol=1e-12)
        x = special.hyp0f1(3.0, np.array([-1.5, -1, 0, 1, 1.5]) + 0j)
        assert_allclose(x, expected.astype(complex), rtol=1e-12)
        x1 = [0.5, 1.5, 2.5]
        x2 = [0, 1, 0.5]
        x = special.hyp0f1(x1, x2)
        expected = [1.0, 1.8134302039235093, 1.21482702689997]
        assert_allclose(x, expected, rtol=1e-12)
        x = special.hyp0f1(np.vstack([x1] * 2), x2)
        assert_allclose(x, np.vstack([expected] * 2), rtol=1e-12)
        assert_raises(ValueError, special.hyp0f1, np.vstack([x1] * 3), [0, 1])

    def test_hyp0f1_gh5764(self):
        res = special.hyp0f1(0.8, 0.5 + 0.5 * 1j)
        assert_almost_equal(res, 1.6139719776441115 + 1j * 0.8089305406179067)

    def test_hyp1f1(self):
        hyp1 = special.hyp1f1(0.1, 0.1, 0.3)
        assert_almost_equal(hyp1, 1.3498588075760032, 7)
        ref_data = array([[-8.38132975, -12.8436461, -29.1081397, 10417.833], [2.91076882, -6.35234333, -12.7083993, 6.68132725], [-14.2938258, 0.180869131, 19.0038728, 101385.897], [5.84069088, 13.3187908, 29.1290106, 159469411.0], [-27.0433202, -11.6274873, -28.9582384, 1.39900152e+24], [4.26344966, -23.2701773, 19.1635759, 6.13816915e+21], [12.051434, -3.4026024, 7.26832235, 11769611200000.0], [27.7372955, -1.99424687, 3.61332246, 30741961500000.0], [15.0310939, -29.1198675, -15.358108, -379.166033], [14.3995827, 9.84311196, 19.3204553, 25583626400.0], [-4.08759686, 13.4437025, -14.2072843, 17.0778449], [8.05595738, -13.1019838, 15.2180721, 3.06233294e+21], [18.1815804, -14.2908793, 9.57868793, -2.84771348e+20], [-24.9671396, 12.5082843, -17.1562286, 23629042.6], [26.7277673, 17.0315414, 6.1270145, 7779.17232], [24.9565476, 29.1694684, 6.2962266, 235.300027], [6.11924542, -1.59943768, 9.57009289, 132906326000.0], [-14.7863653, 24.1691301, -18.9981821, 2730.64953], [22.4070483, -2.93647433, 8.19281432, -6.42000372e+17], [0.8040426, 18.2710085, -19.7814534, 0.548372441], [13.959039, 19.7318686, 2.37606635, 5.51923681], [-4.66640483, -20.023793, 7.40365095, 4.50310752], [27.6821999, -6.36563968, 11.1533984, -9.28725179e+23], [-25.6764457, 1.24544906, 10.6407572, 12.5922076], [3.20447808, 13.0874383, 22.6098014, 20320.2059], [-12.4809647, 4.15137113, -29.22657, 239621411.0], [21.4778108, -2.3516296, -11.3758664, 0.446882152], [-9.85469168, -3.2815768, 16.7447548, -10734239.0], [10.812231, -24.7353236, -11.5622349, -2917.33796], [-26.7933347, -3.39100709, 25.6006986, -5292753820.0], [-8.60066776, -8.02200924, 10.7231926, 1335483.2], [-0.101724238, -11.8479709, -25.5407104, 1.5543657], [-3.93356771, 21.1106818, -25.7598485, 21.346784], [3.74750503, 15.5687633, -29.284172, 0.0143873509], [6.99726781, 26.9855571, -16.3707771, 0.0308098673], [-23.1996011, 3.47631054, 0.975119815, 0.0179971073], [23.8951044, -29.146019, -2.50774708, 9.56934814], [15.2730825, 5.77062507, 12.1922003, 1323453070.0], [17.4673917, 18.9723426, 4.9490325, 99.0859484], [18.8971241, 28.6255413, 0.552360109, 1.4416536], [10.2002319, -16.6855152, -25.5426235, 656.481554], [-17.9474153, 12.22102, -18.4058212, 824041.812], [-13.6147103, 1.32365492, -7.223752, 992446.491], [7.57407832, 25.9738234, -13.4139168, 0.0364037761], [2.21110169, 12.8012666, 16.2529102, 133.433085], [-26.4297569, -16.3176658, -11.1642006, -24479725100000.0], [-24.6622944, -3.02147372, 8.29159315, -321799.07], [-13.7215095, -19.6680183, 29.1940118, 3214575200000.0], [-5.45566105, 28.1292086, 0.172548215, 0.966973], [-1.55751298, -8.65703373, 26.8622026, -3.17190834e+16], [24.5393609, -27.0571903, 19.6815505, 1.80708004e+37], [5.77482829, 15.3203143, 25.0534322, 1143042.42], [-10.2626819, 23.6887658, -23.2152102, 728.965646], [-1.30833446, -12.831021, 18.7275544, -9334879040000.0], [5.83024676, -14.9279672, 24.4957538, -7.6108307e+27], [-20.3130747, 25.9641715, -20.6174328, 45474.4859], [19.7684551, -22.1410519, -22.672874, 3531130.26], [27.3673444, 26.4491725, 15.7599882, 10738511.8], [5.73287971, 12.1111904, 13.3080171, 2632.20467], [-28.2751072, 20.8605881, 9.098389, -6.60957033e-07], [18.7270691, -17.4437016, 15.2413599, 6.59572851e+27], [6.60681457, -2.69449855, 9.78972047, -2385878700000.0], [12.0895561, -25.1355765, 23.0096101, 7.58739886e+32], [-24.4682278, 21.0673441, -13.6705538, 45421.355], [-4.50665152, 3.72292059, -4.83403707, 26.8938214], [-7.46540049, -10.8422222, -17.2203805, -209.402162], [-20.0307551, -7.50604431, -27.864002, 4.15985444e+19], [19.9890876, 22.0677419, -25.1301778, 1.23840297e-09], [20.3183823, -7.66942559, 21.034007, 1.46285095e+31], [-2.90315825, -25.5785967, -9.58779316, 0.265714264], [27.3960829, -18.0097203, -2.03070131, 252.908999], [-21.1708058, -27.0304032, 24.8257944, 309027527.0], [22.1959758, 4.00258675, -16.2853977, -9.1628009e-09], [16.166184, -22.684515, 21.722694, -8.24774394e+33], [-3.35030306, 1.32670581, 9.39711214, -14.7303163], [7.23720726, -22.9763909, 23.4709682, -9.20711735e+29], [27.1013568, 16.1951087, -0.711388906, 0.298750911], [8.40057933, -7.4966522, 29.5587388, 6.59465635e+29], [-15.1603423, 19.4032322, -7.60044357, 105.186941], [-8.83788031, -27.2018313, 1.88269907, 1.81687019], [-18.7283712, 5.8747957, -19.1210203, 252235612.0], [-0.561338513, 26.9490237, 0.116660111, 0.997567783], [-5.44354025, -12.6721408, -4.66831036, 0.106660735], [-2.18846497, 23.3299566, 9.62564397, 0.303842061], [6.65661299, -23.9048713, 10.4191807, 47370045100000.0], [-25.7298921, -26.0811296, 27.439811, -532566307000.0], [-11.1431826, -15.942016, -18.4880553, -101.514747], [6.50301931, 25.9859051, -23.3270137, 0.01227605], [-19.4987891, -26.2123262, 3.90323225, 17.1658894], [7.26164601, -14.1469402, 28.1499763, -2.50068329e+31], [-15.242404, 29.9719005, -28.5753678, 13190.6693], [5.24149291, -17.2807223, 22.2129493, 2.50748475e+25], [0.36320723, -0.0954120862, -28.3874044, 0.943854939], [-2.11326457, -12.5707023, 1.1717213, 1.20812698], [2.48513582, 10.3652647, -18.4625148, 0.0647910997], [26.5395942, 27.4794672, 12.9413428, 289306.132], [-9.4944546, 15.9930921, -14.9596331, 327.574841], [-5.89173945, 9.96742426, 26.0318889, -0.315842908], [-11.5387239, -22.1433107, -21.7686413, 0.156724718], [-5.30592244, -24.275219, 1.29734035, 1.31985534]])
        for a, b, c, expected in ref_data:
            result = special.hyp1f1(a, b, c)
            assert_(abs(expected - result) / expected < 0.0001)

    def test_hyp1f1_gh2957(self):
        hyp1 = special.hyp1f1(0.5, 1.5, -709.7827128933)
        hyp2 = special.hyp1f1(0.5, 1.5, -709.7827128934)
        assert_almost_equal(hyp1, hyp2, 12)

    def test_hyp1f1_gh2282(self):
        hyp = special.hyp1f1(0.5, 1.5, -1000)
        assert_almost_equal(hyp, 0.028024956081989644, 12)

    def test_hyp2f1(self):
        values = [[0.5, 1, 1.5, 0.2 ** 2, 0.5 / 0.2 * log((1 + 0.2) / (1 - 0.2))], [0.5, 1, 1.5, -0.2 ** 2, 1.0 / 0.2 * arctan(0.2)], [1, 1, 2, 0.2, -1 / 0.2 * log(1 - 0.2)], [3, 3.5, 1.5, 0.2 ** 2, 0.5 / 0.2 / -5 * ((1 + 0.2) ** (-5) - (1 - 0.2) ** (-5))], [-3, 3, 0.5, sin(0.2) ** 2, cos(2 * 3 * 0.2)], [3, 4, 8, 1, special.gamma(8) * special.gamma(8 - 4 - 3) / special.gamma(8 - 3) / special.gamma(8 - 4)], [3, 2, 3 - 2 + 1, -1, 1.0 / 2 ** 3 * sqrt(pi) * special.gamma(1 + 3 - 2) / special.gamma(1 + 0.5 * 3 - 2) / special.gamma(0.5 + 0.5 * 3)], [5, 2, 5 - 2 + 1, -1, 1.0 / 2 ** 5 * sqrt(pi) * special.gamma(1 + 5 - 2) / special.gamma(1 + 0.5 * 5 - 2) / special.gamma(0.5 + 0.5 * 5)], [4, 0.5 + 4, 1.5 - 2 * 4, -1.0 / 3, (8.0 / 9) ** (-2 * 4) * special.gamma(4.0 / 3) * special.gamma(1.5 - 2 * 4) / special.gamma(3.0 / 2) / special.gamma(4.0 / 3 - 2 * 4)], [1.5, -0.5, 1.0, -10.0, 4.130009776527747], [-2, 3, 1, 0.95, 0.715], [2, -3, 1, 0.95, -0.007], [-6, 3, 1, 0.95, 8.10625e-05], [2, -5, 1, 0.95, -2.9375e-05], (10, -900, 10.5, 0.99, 1.9185370579660766e-24), (10, -900, -10.5, 0.99, 3.542792000403557e-18)]
        for i, (a, b, c, x, v) in enumerate(values):
            cv = special.hyp2f1(a, b, c, x)
            assert_almost_equal(cv, v, 8, err_msg='test #%d' % i)

    def test_hyperu(self):
        val1 = special.hyperu(1, 0.1, 100)
        assert_almost_equal(val1, 0.0098153, 7)
        a, b = ([0.3, 0.6, 1.2, -2.7], [1.5, 3.2, -0.4, -3.2])
        a, b = (asarray(a), asarray(b))
        z = 0.5
        hypu = special.hyperu(a, b, z)
        hprl = pi / sin(pi * b) * (special.hyp1f1(a, b, z) / (special.gamma(1 + a - b) * special.gamma(b)) - z ** (1 - b) * special.hyp1f1(1 + a - b, 2 - b, z) / (special.gamma(a) * special.gamma(2 - b)))
        assert_array_almost_equal(hypu, hprl, 12)

    def test_hyperu_gh2287(self):
        assert_almost_equal(special.hyperu(1, 1.5, 20.2), 0.04836091865669919, 12)