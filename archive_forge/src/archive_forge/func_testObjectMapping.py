import sys
import cherrypy
from cherrypy._cpcompat import ntou
from cherrypy._cptree import Application
from cherrypy.test import helper
def testObjectMapping(self):
    for url in script_names:
        self.script_name = url
        self.getPage('/')
        self.assertBody('world')
        self.getPage('/dir1/myMethod')
        self.assertBody("myMethod from dir1, path_info is:'/dir1/myMethod'")
        self.getPage('/this/method/does/not/exist')
        self.assertBody("default:('this', 'method', 'does', 'not', 'exist')")
        self.getPage('/extra/too/much')
        self.assertBody("('too', 'much')")
        self.getPage('/other')
        self.assertBody('other')
        self.getPage('/notExposed')
        self.assertBody("default:('notExposed',)")
        self.getPage('/dir1/dir2/')
        self.assertBody('index for dir2, path is:/dir1/dir2/')
        self.getPage('/dir1/dir2')
        self.assertStatus(301)
        self.assertHeader('Location', '%s/dir1/dir2/' % self.base())
        self.getPage('/dir1/myMethod/')
        self.assertStatus(301)
        self.assertHeader('Location', '%s/dir1/myMethod' % self.base())
        self.getPage('/dir1/dir2/dir3/dir4/index')
        self.assertBody("default for dir1, param is:('dir2', 'dir3', 'dir4', 'index')")
        self.getPage('/defnoindex')
        self.assertStatus((302, 303))
        self.assertHeader('Location', '%s/contact' % self.base())
        self.getPage('/defnoindex/')
        self.assertStatus((302, 303))
        self.assertHeader('Location', '%s/defnoindex/contact' % self.base())
        self.getPage('/defnoindex/page')
        self.assertStatus((302, 303))
        self.assertHeader('Location', '%s/defnoindex/contact' % self.base())
        self.getPage('/redirect')
        self.assertStatus('302 Found')
        self.assertHeader('Location', '%s/dir1/' % self.base())
        if not getattr(cherrypy.server, 'using_apache', False):
            self.getPage('/Von%20B%fclow?ID=14')
            self.assertBody('ID is 14')
            self.getPage('/page%2Fname')
            self.assertBody("default:('page/name',)")
        self.getPage('/dir1/dir2/script_name')
        self.assertBody(url)
        self.getPage('/dir1/dir2/cherrypy_url')
        self.assertBody('%s/extra' % self.base())
        self.getPage('/confvalue')
        self.assertBody((url or '/').split('/')[-2])
    self.script_name = ''
    self.getPage('http://%s:%s/' % (self.interface(), self.PORT))
    self.assertBody('world')
    self.getPage('http://%s:%s/abs/?service=http://192.168.0.1/x/y/z' % (self.interface(), self.PORT))
    self.assertBody("default:('abs',)")
    self.getPage('/rel/?service=http://192.168.120.121:8000/x/y/z')
    self.assertBody("default:('rel',)")
    self.getPage('/isolated/')
    self.assertStatus('200 OK')
    self.assertBody('made it!')
    self.getPage('/isolated/doesnt/exist')
    self.assertStatus('404 Not Found')
    self.getPage('/foobar')
    self.assertBody('bar')