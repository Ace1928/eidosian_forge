from datetime import datetime
import numpy as np
import pytest
import pandas as pd
from pandas import (
import pandas._testing as tm
@pytest.mark.parametrize('grps', [['qux'], ['qux', 'quux']])
@pytest.mark.parametrize('vals', [np.array([2, 2, np.nan, 8, 2, 6, np.nan, np.nan], dtype=dtype) for dtype in ['f8', 'f4', 'f2']] + [[pd.Timestamp('2018-01-02'), pd.Timestamp('2018-01-02'), np.nan, pd.Timestamp('2018-01-08'), pd.Timestamp('2018-01-02'), pd.Timestamp('2018-01-06'), np.nan, np.nan], [pd.Timestamp('2018-01-02', tz='US/Pacific'), pd.Timestamp('2018-01-02', tz='US/Pacific'), np.nan, pd.Timestamp('2018-01-08', tz='US/Pacific'), pd.Timestamp('2018-01-02', tz='US/Pacific'), pd.Timestamp('2018-01-06', tz='US/Pacific'), np.nan, np.nan], [pd.Timestamp('2018-01-02') - pd.Timestamp(0), pd.Timestamp('2018-01-02') - pd.Timestamp(0), np.nan, pd.Timestamp('2018-01-08') - pd.Timestamp(0), pd.Timestamp('2018-01-02') - pd.Timestamp(0), pd.Timestamp('2018-01-06') - pd.Timestamp(0), np.nan, np.nan], [pd.Timestamp('2018-01-02').to_period('D'), pd.Timestamp('2018-01-02').to_period('D'), np.nan, pd.Timestamp('2018-01-08').to_period('D'), pd.Timestamp('2018-01-02').to_period('D'), pd.Timestamp('2018-01-06').to_period('D'), np.nan, np.nan]], ids=lambda x: type(x[0]))
@pytest.mark.parametrize('ties_method,ascending,na_option,pct,exp', [('average', True, 'keep', False, [2.0, 2.0, np.nan, 5.0, 2.0, 4.0, np.nan, np.nan]), ('average', True, 'keep', True, [0.4, 0.4, np.nan, 1.0, 0.4, 0.8, np.nan, np.nan]), ('average', False, 'keep', False, [4.0, 4.0, np.nan, 1.0, 4.0, 2.0, np.nan, np.nan]), ('average', False, 'keep', True, [0.8, 0.8, np.nan, 0.2, 0.8, 0.4, np.nan, np.nan]), ('min', True, 'keep', False, [1.0, 1.0, np.nan, 5.0, 1.0, 4.0, np.nan, np.nan]), ('min', True, 'keep', True, [0.2, 0.2, np.nan, 1.0, 0.2, 0.8, np.nan, np.nan]), ('min', False, 'keep', False, [3.0, 3.0, np.nan, 1.0, 3.0, 2.0, np.nan, np.nan]), ('min', False, 'keep', True, [0.6, 0.6, np.nan, 0.2, 0.6, 0.4, np.nan, np.nan]), ('max', True, 'keep', False, [3.0, 3.0, np.nan, 5.0, 3.0, 4.0, np.nan, np.nan]), ('max', True, 'keep', True, [0.6, 0.6, np.nan, 1.0, 0.6, 0.8, np.nan, np.nan]), ('max', False, 'keep', False, [5.0, 5.0, np.nan, 1.0, 5.0, 2.0, np.nan, np.nan]), ('max', False, 'keep', True, [1.0, 1.0, np.nan, 0.2, 1.0, 0.4, np.nan, np.nan]), ('first', True, 'keep', False, [1.0, 2.0, np.nan, 5.0, 3.0, 4.0, np.nan, np.nan]), ('first', True, 'keep', True, [0.2, 0.4, np.nan, 1.0, 0.6, 0.8, np.nan, np.nan]), ('first', False, 'keep', False, [3.0, 4.0, np.nan, 1.0, 5.0, 2.0, np.nan, np.nan]), ('first', False, 'keep', True, [0.6, 0.8, np.nan, 0.2, 1.0, 0.4, np.nan, np.nan]), ('dense', True, 'keep', False, [1.0, 1.0, np.nan, 3.0, 1.0, 2.0, np.nan, np.nan]), ('dense', True, 'keep', True, [1.0 / 3.0, 1.0 / 3.0, np.nan, 3.0 / 3.0, 1.0 / 3.0, 2.0 / 3.0, np.nan, np.nan]), ('dense', False, 'keep', False, [3.0, 3.0, np.nan, 1.0, 3.0, 2.0, np.nan, np.nan]), ('dense', False, 'keep', True, [3.0 / 3.0, 3.0 / 3.0, np.nan, 1.0 / 3.0, 3.0 / 3.0, 2.0 / 3.0, np.nan, np.nan]), ('average', True, 'bottom', False, [2.0, 2.0, 7.0, 5.0, 2.0, 4.0, 7.0, 7.0]), ('average', True, 'bottom', True, [0.25, 0.25, 0.875, 0.625, 0.25, 0.5, 0.875, 0.875]), ('average', False, 'bottom', False, [4.0, 4.0, 7.0, 1.0, 4.0, 2.0, 7.0, 7.0]), ('average', False, 'bottom', True, [0.5, 0.5, 0.875, 0.125, 0.5, 0.25, 0.875, 0.875]), ('min', True, 'bottom', False, [1.0, 1.0, 6.0, 5.0, 1.0, 4.0, 6.0, 6.0]), ('min', True, 'bottom', True, [0.125, 0.125, 0.75, 0.625, 0.125, 0.5, 0.75, 0.75]), ('min', False, 'bottom', False, [3.0, 3.0, 6.0, 1.0, 3.0, 2.0, 6.0, 6.0]), ('min', False, 'bottom', True, [0.375, 0.375, 0.75, 0.125, 0.375, 0.25, 0.75, 0.75]), ('max', True, 'bottom', False, [3.0, 3.0, 8.0, 5.0, 3.0, 4.0, 8.0, 8.0]), ('max', True, 'bottom', True, [0.375, 0.375, 1.0, 0.625, 0.375, 0.5, 1.0, 1.0]), ('max', False, 'bottom', False, [5.0, 5.0, 8.0, 1.0, 5.0, 2.0, 8.0, 8.0]), ('max', False, 'bottom', True, [0.625, 0.625, 1.0, 0.125, 0.625, 0.25, 1.0, 1.0]), ('first', True, 'bottom', False, [1.0, 2.0, 6.0, 5.0, 3.0, 4.0, 7.0, 8.0]), ('first', True, 'bottom', True, [0.125, 0.25, 0.75, 0.625, 0.375, 0.5, 0.875, 1.0]), ('first', False, 'bottom', False, [3.0, 4.0, 6.0, 1.0, 5.0, 2.0, 7.0, 8.0]), ('first', False, 'bottom', True, [0.375, 0.5, 0.75, 0.125, 0.625, 0.25, 0.875, 1.0]), ('dense', True, 'bottom', False, [1.0, 1.0, 4.0, 3.0, 1.0, 2.0, 4.0, 4.0]), ('dense', True, 'bottom', True, [0.25, 0.25, 1.0, 0.75, 0.25, 0.5, 1.0, 1.0]), ('dense', False, 'bottom', False, [3.0, 3.0, 4.0, 1.0, 3.0, 2.0, 4.0, 4.0]), ('dense', False, 'bottom', True, [0.75, 0.75, 1.0, 0.25, 0.75, 0.5, 1.0, 1.0])])
def test_rank_args_missing(grps, vals, ties_method, ascending, na_option, pct, exp):
    key = np.repeat(grps, len(vals))
    orig_vals = vals
    vals = list(vals) * len(grps)
    if isinstance(orig_vals, np.ndarray):
        vals = np.array(vals, dtype=orig_vals.dtype)
    df = DataFrame({'key': key, 'val': vals})
    result = df.groupby('key').rank(method=ties_method, ascending=ascending, na_option=na_option, pct=pct)
    exp_df = DataFrame(exp * len(grps), columns=['val'])
    tm.assert_frame_equal(result, exp_df)