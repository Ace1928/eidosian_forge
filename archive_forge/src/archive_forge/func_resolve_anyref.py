import re
from typing import Any, Dict, List, Optional, Sequence, Tuple, Type, cast
from docutils import nodes
from docutils.nodes import Element, Node
from sphinx import addnodes
from sphinx.addnodes import pending_xref
from sphinx.application import Sphinx
from sphinx.domains import Domain
from sphinx.errors import NoUri
from sphinx.locale import __
from sphinx.transforms import SphinxTransform
from sphinx.util import logging
from sphinx.util.docutils import SphinxTranslator
from sphinx.util.nodes import find_pending_xref_condition, process_only_nodes
def resolve_anyref(self, refdoc: str, node: pending_xref, contnode: Element) -> Optional[Element]:
    """Resolve reference generated by the "any" role."""
    stddomain = self.env.get_domain('std')
    target = node['reftarget']
    results: List[Tuple[str, Element]] = []
    doc_ref = stddomain.resolve_xref(self.env, refdoc, self.app.builder, 'doc', target, node, contnode)
    if doc_ref:
        results.append(('doc', doc_ref))
    results.extend(stddomain.resolve_any_xref(self.env, refdoc, self.app.builder, target, node, contnode))
    for domain in self.env.domains.values():
        if domain.name == 'std':
            continue
        try:
            results.extend(domain.resolve_any_xref(self.env, refdoc, self.app.builder, target, node, contnode))
        except NotImplementedError:
            for role in domain.roles:
                res = domain.resolve_xref(self.env, refdoc, self.app.builder, role, target, node, contnode)
                if res and len(res) > 0 and isinstance(res[0], nodes.Element):
                    results.append(('%s:%s' % (domain.name, role), res))
    if not results:
        return None
    if len(results) > 1:

        def stringify(name: str, node: Element) -> str:
            reftitle = node.get('reftitle', node.astext())
            return ':%s:`%s`' % (name, reftitle)
        candidates = ' or '.join((stringify(name, role) for name, role in results))
        logger.warning(__("more than one target found for 'any' cross-reference %r: could be %s"), target, candidates, location=node)
    res_role, newnode = results[0]
    res_domain = res_role.split(':')[0]
    if len(newnode) > 0 and isinstance(newnode[0], nodes.Element) and newnode[0].get('classes'):
        newnode[0]['classes'].append(res_domain)
        newnode[0]['classes'].append(res_role.replace(':', '-'))
    return newnode