import re
from pygments.lexer import RegexLexer, ExtendedRegexLexer, include, bygroups, \
from pygments.token import Text, Comment, Operator, Keyword, Name, String, \
from pygments.util import shebang_matches
class PerlLexer(RegexLexer):
    """
    For `Perl <http://www.perl.org>`_ source code.
    """
    name = 'Perl'
    aliases = ['perl', 'pl']
    filenames = ['*.pl', '*.pm', '*.t']
    mimetypes = ['text/x-perl', 'application/x-perl']
    flags = re.DOTALL | re.MULTILINE
    tokens = {'balanced-regex': [('/(\\\\\\\\|\\\\[^\\\\]|[^\\\\/])*/[egimosx]*', String.Regex, '#pop'), ('!(\\\\\\\\|\\\\[^\\\\]|[^\\\\!])*![egimosx]*', String.Regex, '#pop'), ('\\\\(\\\\\\\\|[^\\\\])*\\\\[egimosx]*', String.Regex, '#pop'), ('\\{(\\\\\\\\|\\\\[^\\\\]|[^\\\\}])*\\}[egimosx]*', String.Regex, '#pop'), ('<(\\\\\\\\|\\\\[^\\\\]|[^\\\\>])*>[egimosx]*', String.Regex, '#pop'), ('\\[(\\\\\\\\|\\\\[^\\\\]|[^\\\\\\]])*\\][egimosx]*', String.Regex, '#pop'), ('\\((\\\\\\\\|\\\\[^\\\\]|[^\\\\)])*\\)[egimosx]*', String.Regex, '#pop'), ('@(\\\\\\\\|\\\\[^\\\\]|[^\\\\@])*@[egimosx]*', String.Regex, '#pop'), ('%(\\\\\\\\|\\\\[^\\\\]|[^\\\\%])*%[egimosx]*', String.Regex, '#pop'), ('\\$(\\\\\\\\|\\\\[^\\\\]|[^\\\\$])*\\$[egimosx]*', String.Regex, '#pop')], 'root': [('\\A\\#!.+?$', Comment.Hashbang), ('\\#.*?$', Comment.Single), ('^=[a-zA-Z0-9]+\\s+.*?\\n=cut', Comment.Multiline), (words(('case', 'continue', 'do', 'else', 'elsif', 'for', 'foreach', 'if', 'last', 'my', 'next', 'our', 'redo', 'reset', 'then', 'unless', 'until', 'while', 'print', 'new', 'BEGIN', 'CHECK', 'INIT', 'END', 'return'), suffix='\\b'), Keyword), ('(format)(\\s+)(\\w+)(\\s*)(=)(\\s*\\n)', bygroups(Keyword, Text, Name, Text, Punctuation, Text), 'format'), ('(eq|lt|gt|le|ge|ne|not|and|or|cmp)\\b', Operator.Word), ('s/(\\\\\\\\|\\\\[^\\\\]|[^\\\\/])*/(\\\\\\\\|\\\\[^\\\\]|[^\\\\/])*/[egimosx]*', String.Regex), ('s!(\\\\\\\\|\\\\!|[^!])*!(\\\\\\\\|\\\\!|[^!])*![egimosx]*', String.Regex), ('s\\\\(\\\\\\\\|[^\\\\])*\\\\(\\\\\\\\|[^\\\\])*\\\\[egimosx]*', String.Regex), ('s@(\\\\\\\\|\\\\[^\\\\]|[^\\\\@])*@(\\\\\\\\|\\\\[^\\\\]|[^\\\\@])*@[egimosx]*', String.Regex), ('s%(\\\\\\\\|\\\\[^\\\\]|[^\\\\%])*%(\\\\\\\\|\\\\[^\\\\]|[^\\\\%])*%[egimosx]*', String.Regex), ('s\\{(\\\\\\\\|\\\\[^\\\\]|[^\\\\}])*\\}\\s*', String.Regex, 'balanced-regex'), ('s<(\\\\\\\\|\\\\[^\\\\]|[^\\\\>])*>\\s*', String.Regex, 'balanced-regex'), ('s\\[(\\\\\\\\|\\\\[^\\\\]|[^\\\\\\]])*\\]\\s*', String.Regex, 'balanced-regex'), ('s\\((\\\\\\\\|\\\\[^\\\\]|[^\\\\)])*\\)\\s*', String.Regex, 'balanced-regex'), ('m?/(\\\\\\\\|\\\\[^\\\\]|[^\\\\/\\n])*/[gcimosx]*', String.Regex), ('m(?=[/!\\\\{<\\[(@%$])', String.Regex, 'balanced-regex'), ('((?<==~)|(?<=\\())\\s*/(\\\\\\\\|\\\\[^\\\\]|[^\\\\/])*/[gcimosx]*', String.Regex), ('\\s+', Text), (words(('abs', 'accept', 'alarm', 'atan2', 'bind', 'binmode', 'bless', 'caller', 'chdir', 'chmod', 'chomp', 'chop', 'chown', 'chr', 'chroot', 'close', 'closedir', 'connect', 'continue', 'cos', 'crypt', 'dbmclose', 'dbmopen', 'defined', 'delete', 'die', 'dump', 'each', 'endgrent', 'endhostent', 'endnetent', 'endprotoent', 'endpwent', 'endservent', 'eof', 'eval', 'exec', 'exists', 'exit', 'exp', 'fcntl', 'fileno', 'flock', 'fork', 'format', 'formline', 'getc', 'getgrent', 'getgrgid', 'getgrnam', 'gethostbyaddr', 'gethostbyname', 'gethostent', 'getlogin', 'getnetbyaddr', 'getnetbyname', 'getnetent', 'getpeername', 'getpgrp', 'getppid', 'getpriority', 'getprotobyname', 'getprotobynumber', 'getprotoent', 'getpwent', 'getpwnam', 'getpwuid', 'getservbyname', 'getservbyport', 'getservent', 'getsockname', 'getsockopt', 'glob', 'gmtime', 'goto', 'grep', 'hex', 'import', 'index', 'int', 'ioctl', 'join', 'keys', 'kill', 'last', 'lc', 'lcfirst', 'length', 'link', 'listen', 'local', 'localtime', 'log', 'lstat', 'map', 'mkdir', 'msgctl', 'msgget', 'msgrcv', 'msgsnd', 'my', 'next', 'oct', 'open', 'opendir', 'ord', 'our', 'pack', 'pipe', 'pop', 'pos', 'printf', 'prototype', 'push', 'quotemeta', 'rand', 'read', 'readdir', 'readline', 'readlink', 'readpipe', 'recv', 'redo', 'ref', 'rename', 'reverse', 'rewinddir', 'rindex', 'rmdir', 'scalar', 'seek', 'seekdir', 'select', 'semctl', 'semget', 'semop', 'send', 'setgrent', 'sethostent', 'setnetent', 'setpgrp', 'setpriority', 'setprotoent', 'setpwent', 'setservent', 'setsockopt', 'shift', 'shmctl', 'shmget', 'shmread', 'shmwrite', 'shutdown', 'sin', 'sleep', 'socket', 'socketpair', 'sort', 'splice', 'split', 'sprintf', 'sqrt', 'srand', 'stat', 'study', 'substr', 'symlink', 'syscall', 'sysopen', 'sysread', 'sysseek', 'system', 'syswrite', 'tell', 'telldir', 'tie', 'tied', 'time', 'times', 'tr', 'truncate', 'uc', 'ucfirst', 'umask', 'undef', 'unlink', 'unpack', 'unshift', 'untie', 'utime', 'values', 'vec', 'wait', 'waitpid', 'wantarray', 'warn', 'write'), suffix='\\b'), Name.Builtin), ('((__(DATA|DIE|WARN)__)|(STD(IN|OUT|ERR)))\\b', Name.Builtin.Pseudo), ('(<<)([\\\'"]?)([a-zA-Z_]\\w*)(\\2;?\\n.*?\\n)(\\3)(\\n)', bygroups(String, String, String.Delimiter, String, String.Delimiter, Text)), ('__END__', Comment.Preproc, 'end-part'), ('\\$\\^[ADEFHILMOPSTWX]', Name.Variable.Global), ('\\$[\\\\\\"\\[\\]\'&`+*.,;=%~?@$!<>(^|/-](?!\\w)', Name.Variable.Global), ('[$@%#]+', Name.Variable, 'varname'), ('0_?[0-7]+(_[0-7]+)*', Number.Oct), ('0x[0-9A-Fa-f]+(_[0-9A-Fa-f]+)*', Number.Hex), ('0b[01]+(_[01]+)*', Number.Bin), ('(?i)(\\d*(_\\d*)*\\.\\d+(_\\d*)*|\\d+(_\\d*)*\\.\\d+(_\\d*)*)(e[+-]?\\d+)?', Number.Float), ('(?i)\\d+(_\\d*)*e[+-]?\\d+(_\\d*)*', Number.Float), ('\\d+(_\\d+)*', Number.Integer), ("'(\\\\\\\\|\\\\[^\\\\]|[^'\\\\])*'", String), ('"(\\\\\\\\|\\\\[^\\\\]|[^"\\\\])*"', String), ('`(\\\\\\\\|\\\\[^\\\\]|[^`\\\\])*`', String.Backtick), ('<([^\\s>]+)>', String.Regex), ('(q|qq|qw|qr|qx)\\{', String.Other, 'cb-string'), ('(q|qq|qw|qr|qx)\\(', String.Other, 'rb-string'), ('(q|qq|qw|qr|qx)\\[', String.Other, 'sb-string'), ('(q|qq|qw|qr|qx)\\<', String.Other, 'lt-string'), ('(q|qq|qw|qr|qx)([\\W_])(.|\\n)*?\\2', String.Other), ('(package)(\\s+)([a-zA-Z_]\\w*(?:::[a-zA-Z_]\\w*)*)', bygroups(Keyword, Text, Name.Namespace)), ('(use|require|no)(\\s+)([a-zA-Z_]\\w*(?:::[a-zA-Z_]\\w*)*)', bygroups(Keyword, Text, Name.Namespace)), ('(sub)(\\s+)', bygroups(Keyword, Text), 'funcname'), (words(('no', 'package', 'require', 'use'), suffix='\\b'), Keyword), ('(\\[\\]|\\*\\*|::|<<|>>|>=|<=>|<=|={3}|!=|=~|!~|&&?|\\|\\||\\.{1,3})', Operator), ('[-+/*%=<>&^|!\\\\~]=?', Operator), ('[()\\[\\]:;,<>/?{}]', Punctuation), ('(?=\\w)', Name, 'name')], 'format': [('\\.\\n', String.Interpol, '#pop'), ('[^\\n]*\\n', String.Interpol)], 'varname': [('\\s+', Text), ('\\{', Punctuation, '#pop'), ('\\)|,', Punctuation, '#pop'), ('\\w+::', Name.Namespace), ('[\\w:]+', Name.Variable, '#pop')], 'name': [('[a-zA-Z_]\\w*(::[a-zA-Z_]\\w*)*(::)?(?=\\s*->)', Name.Namespace, '#pop'), ('[a-zA-Z_]\\w*(::[a-zA-Z_]\\w*)*::', Name.Namespace, '#pop'), ('[\\w:]+', Name, '#pop'), ('[A-Z_]+(?=\\W)', Name.Constant, '#pop'), ('(?=\\W)', Text, '#pop')], 'funcname': [('[a-zA-Z_]\\w*[!?]?', Name.Function), ('\\s+', Text), ('(\\([$@%]*\\))(\\s*)', bygroups(Punctuation, Text)), (';', Punctuation, '#pop'), ('.*?\\{', Punctuation, '#pop')], 'cb-string': [('\\\\[{}\\\\]', String.Other), ('\\\\', String.Other), ('\\{', String.Other, 'cb-string'), ('\\}', String.Other, '#pop'), ('[^{}\\\\]+', String.Other)], 'rb-string': [('\\\\[()\\\\]', String.Other), ('\\\\', String.Other), ('\\(', String.Other, 'rb-string'), ('\\)', String.Other, '#pop'), ('[^()]+', String.Other)], 'sb-string': [('\\\\[\\[\\]\\\\]', String.Other), ('\\\\', String.Other), ('\\[', String.Other, 'sb-string'), ('\\]', String.Other, '#pop'), ('[^\\[\\]]+', String.Other)], 'lt-string': [('\\\\[<>\\\\]', String.Other), ('\\\\', String.Other), ('\\<', String.Other, 'lt-string'), ('\\>', String.Other, '#pop'), ('[^<>]+', String.Other)], 'end-part': [('.+', Comment.Preproc, '#pop')]}

    def analyse_text(text):
        if shebang_matches(text, 'perl'):
            return True
        if re.search('(?:my|our)\\s+[$@%(]', text):
            return 0.9