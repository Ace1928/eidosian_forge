from __future__ import absolute_import
from __future__ import division
from __future__ import unicode_literals
import collections
import re
import textwrap
from googlecloudsdk.calliope import arg_parsers
from googlecloudsdk.calliope.arg_parsers import ArgumentTypeError
from googlecloudsdk.command_lib.util.args import map_util
from googlecloudsdk.core import log
import six
def ApplyFlags(old_secrets, args, default_project_id, default_project_number):
    """Applies the current flags to existing secrets configuration.

  Args:
    old_secrets: Existing combined secrets configuration dict.
    args: Argparse namespace.
    default_project_id: The project ID of the project to which the function is
      deployed.
    default_project_number: The project number of the project to which the
      function is deployed.

  Returns:
    new_secrets: A new combined secrets configuration dict generated by
      applying the flags to the existing secrets configuration.

  Raises:
    ArgumentTypeError: Generated secrets configuration is invalid.
  """
    secret_flags = map_util.GetMapFlagsFromArgs('secrets', args)
    new_secrets = map_util.ApplyMapFlags(old_secrets, **secret_flags)
    new_secrets = {secrets_key: _SubstituteDefaultProject(secrets_value, default_project_id, default_project_number) for secrets_key, secrets_value in six.iteritems(new_secrets)}
    new_secrets = collections.OrderedDict(sorted(six.iteritems(new_secrets)))
    _ValidateSecrets(new_secrets)
    return new_secrets