import unittest
import aniso8601
from aniso8601.builders import (
from aniso8601.exceptions import ISOFormatError
from aniso8601.interval import (
from aniso8601.resolution import IntervalResolution
from aniso8601.tests.compat import mock
def test_parse_interval(self):
    testtuples = (('P1M/1981-04-05T01:01:00', {'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'duration': DurationTuple(None, '1', None, None, None, None, None)}), ('P1M/1981-04-05', {'end': DateTuple('1981', '04', '05', None, None, None), 'duration': DurationTuple(None, '1', None, None, None, None, None)}), ('P1,5Y/2018-03-06', {'end': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple('1.5', None, None, None, None, None, None)}), ('P1.5Y/2018-03-06', {'end': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple('1.5', None, None, None, None, None, None)}), ('PT1H/2014-11-12', {'end': DateTuple('2014', '11', '12', None, None, None), 'duration': DurationTuple(None, None, None, None, '1', None, None)}), ('PT4H54M6.5S/2014-11-12', {'end': DateTuple('2014', '11', '12', None, None, None), 'duration': DurationTuple(None, None, None, None, '4', '54', '6.5')}), ('PT10H/2050-03-01T13:00:00Z', {'end': DatetimeTuple(DateTuple('2050', '03', '01', None, None, None), TimeTuple('13', '00', '00', TimezoneTuple(False, True, None, None, 'Z'))), 'duration': DurationTuple(None, None, None, None, '10', None, None)}), ('PT0.0000001S/2018-03-06', {'end': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, None, None, None, None, None, '0.0000001')}), ('PT2.0000048S/2018-03-06', {'end': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, None, None, None, None, None, '2.0000048')}), ('1981-04-05T01:01:00/P1M1DT1M', {'start': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'duration': DurationTuple(None, '1', None, '1', None, '1', None)}), ('1981-04-05/P1M1D', {'start': DateTuple('1981', '04', '05', None, None, None), 'duration': DurationTuple(None, '1', None, '1', None, None, None)}), ('2018-03-06/P2,5M', {'start': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, '2.5', None, None, None, None, None)}), ('2018-03-06/P2.5M', {'start': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, '2.5', None, None, None, None, None)}), ('2014-11-12/PT1H', {'start': DateTuple('2014', '11', '12', None, None, None), 'duration': DurationTuple(None, None, None, None, '1', None, None)}), ('2014-11-12/PT4H54M6.5S', {'start': DateTuple('2014', '11', '12', None, None, None), 'duration': DurationTuple(None, None, None, None, '4', '54', '6.5')}), ('2050-03-01T13:00:00Z/PT10H', {'start': DatetimeTuple(DateTuple('2050', '03', '01', None, None, None), TimeTuple('13', '00', '00', TimezoneTuple(False, True, None, None, 'Z'))), 'duration': DurationTuple(None, None, None, None, '10', None, None)}), ('2018-03-06/PT0.0000001S', {'start': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, None, None, None, None, None, '0.0000001')}), ('2018-03-06/PT2.0000048S', {'start': DateTuple('2018', '03', '06', None, None, None), 'duration': DurationTuple(None, None, None, None, None, None, '2.0000048')}), ('1980-03-05T01:01:00/1981-04-05T01:01:00', {'start': DatetimeTuple(DateTuple('1980', '03', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None))}), ('1980-03-05T01:01:00/1981-04-05', {'start': DatetimeTuple(DateTuple('1980', '03', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'end': DateTuple('1981', '04', '05', None, None, None)}), ('1980-03-05/1981-04-05T01:01:00', {'start': DateTuple('1980', '03', '05', None, None, None), 'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None))}), ('1980-03-05/1981-04-05', {'start': DateTuple('1980', '03', '05', None, None, None), 'end': DateTuple('1981', '04', '05', None, None, None)}), ('1981-04-05/1980-03-05', {'start': DateTuple('1981', '04', '05', None, None, None), 'end': DateTuple('1980', '03', '05', None, None, None)}), ('2050-03-01T13:00:00Z/2050-05-11T15:30:00Z', {'start': DatetimeTuple(DateTuple('2050', '03', '01', None, None, None), TimeTuple('13', '00', '00', TimezoneTuple(False, True, None, None, 'Z'))), 'end': DatetimeTuple(DateTuple('2050', '05', '11', None, None, None), TimeTuple('15', '30', '00', TimezoneTuple(False, True, None, None, 'Z')))}), ('2020-01-01/02', {'start': DateTuple('2020', '01', '01', None, None, None), 'end': DateTuple(None, None, '02', None, None, None)}), ('2008-02-15/03-14', {'start': DateTuple('2008', '02', '15', None, None, None), 'end': DateTuple(None, '03', '14', None, None, None)}), ('2007-12-14T13:30/15:30', {'start': DatetimeTuple(DateTuple('2007', '12', '14', None, None, None), TimeTuple('13', '30', None, None)), 'end': TimeTuple('15', '30', None, None)}), ('2007-11-13T09:00/15T17:00', {'start': DatetimeTuple(DateTuple('2007', '11', '13', None, None, None), TimeTuple('09', '00', None, None)), 'end': DatetimeTuple(DateTuple(None, None, '15', None, None, None), TimeTuple('17', '00', None, None))}), ('2007-11-13T00:00/16T00:00', {'start': DatetimeTuple(DateTuple('2007', '11', '13', None, None, None), TimeTuple('00', '00', None, None)), 'end': DatetimeTuple(DateTuple(None, None, '16', None, None, None), TimeTuple('00', '00', None, None))}), ('2007-11-13T09:00Z/15T17:00', {'start': DatetimeTuple(DateTuple('2007', '11', '13', None, None, None), TimeTuple('09', '00', None, TimezoneTuple(False, True, None, None, 'Z'))), 'end': DatetimeTuple(DateTuple(None, None, '15', None, None, None), TimeTuple('17', '00', None, None))}), ('2007-11-13T00:00/12:34.567', {'start': DatetimeTuple(DateTuple('2007', '11', '13', None, None, None), TimeTuple('00', '00', None, None)), 'end': TimeTuple('12', '34.567', None, None)}), ('1980-03-05T01:01:00.0000001/1981-04-05T14:43:59.9999997', {'start': DatetimeTuple(DateTuple('1980', '03', '05', None, None, None), TimeTuple('01', '01', '00.0000001', None)), 'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('14', '43', '59.9999997', None))}))
    for testtuple in testtuples:
        with mock.patch.object(aniso8601.interval.PythonTimeBuilder, 'build_interval') as mockBuildInterval:
            mockBuildInterval.return_value = testtuple[1]
            result = parse_interval(testtuple[0])
            self.assertEqual(result, testtuple[1])
            mockBuildInterval.assert_called_once_with(**testtuple[1])
    with mock.patch.object(aniso8601.interval.PythonTimeBuilder, 'build_interval') as mockBuildInterval:
        expectedargs = {'start': DatetimeTuple(DateTuple('1980', '03', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None))}
        mockBuildInterval.return_value = expectedargs
        result = parse_interval('1980-03-05T01:01:00--1981-04-05T01:01:00', intervaldelimiter='--')
        self.assertEqual(result, expectedargs)
        mockBuildInterval.assert_called_once_with(**expectedargs)
    with mock.patch.object(aniso8601.interval.PythonTimeBuilder, 'build_interval') as mockBuildInterval:
        expectedargs = {'start': DatetimeTuple(DateTuple('1980', '03', '05', None, None, None), TimeTuple('01', '01', '00', None)), 'end': DatetimeTuple(DateTuple('1981', '04', '05', None, None, None), TimeTuple('01', '01', '00', None))}
        mockBuildInterval.return_value = expectedargs
        result = parse_interval('1980-03-05 01:01:00/1981-04-05 01:01:00', datetimedelimiter=' ')
        self.assertEqual(result, expectedargs)
        mockBuildInterval.assert_called_once_with(**expectedargs)