from __future__ import annotations
import threading
from datetime import datetime, timedelta, timezone
from decimal import Decimal
from enum import Enum
from typing import (
from uuid import UUID
from typing_extensions import TypedDict
from typing_extensions import Literal
class RunBase(BaseModel):
    """Base Run schema.

    A Run is a span representing a single unit of work or operation within your LLM app.
    This could be a single call to an LLM or chain, to a prompt formatting call,
    to a runnable lambda invocation. If you are familiar with OpenTelemetry,
    you can think of a run as a span.
    """
    id: UUID
    'Unique identifier for the run.'
    name: str
    'Human-readable name for the run.'
    start_time: datetime
    'Start time of the run.'
    run_type: str
    'The type of run, such as tool, chain, llm, retriever,\n    embedding, prompt, parser.'
    end_time: Optional[datetime] = None
    'End time of the run, if applicable.'
    extra: Optional[dict] = None
    'Additional metadata or settings related to the run.'
    error: Optional[str] = None
    'Error message, if the run encountered any issues.'
    serialized: Optional[dict] = None
    'Serialized object that executed the run for potential reuse.'
    events: Optional[List[Dict]] = None
    'List of events associated with the run, like\n    start and end events.'
    inputs: dict = Field(default_factory=dict)
    'Inputs used for the run.'
    outputs: Optional[dict] = None
    'Outputs generated by the run, if any.'
    reference_example_id: Optional[UUID] = None
    'Reference to an example that this run may be based on.'
    parent_run_id: Optional[UUID] = None
    'Identifier for a parent run, if this run is a sub-run.'
    tags: Optional[List[str]] = None
    'Tags for categorizing or annotating the run.'
    _lock: threading.Lock = PrivateAttr(default_factory=threading.Lock)

    @property
    def metadata(self) -> dict[str, Any]:
        """Retrieve the metadata (if any)."""
        with self._lock:
            if self.extra is None:
                self.extra = {}
            metadata = self.extra.setdefault('metadata', {})
        return metadata

    @property
    def revision_id(self) -> Optional[UUID]:
        """Retrieve the revision ID (if any)."""
        return self.metadata.get('revision_id')