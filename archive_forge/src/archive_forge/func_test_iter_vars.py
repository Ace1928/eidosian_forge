import pyomo.common.unittest as unittest
from io import StringIO
from pyomo.environ import (
from pyomo.network import Port, Arc
def test_iter_vars(self):

    def contains(item, container):
        return any((item is mem for mem in container))
    m = ConcreteModel()
    m.s = RangeSet(5)
    m.x = Var()
    m.y = Var()
    m.z = Var(m.s)
    m.a = Var()
    m.b = Var()
    m.c = Var()
    expr = m.a + m.b * m.c
    p = m.p = Port()
    v = list(p.iter_vars())
    self.assertEqual(len(v), 0)
    p.add(m.x)
    v = list(p.iter_vars())
    self.assertEqual(len(v), 1)
    p.add(m.y)
    v = list(p.iter_vars())
    self.assertEqual(len(v), 2)
    p.add(m.z)
    v = list(p.iter_vars())
    self.assertEqual(len(v), 7)
    self.assertTrue(contains(m.x, v))
    self.assertTrue(contains(m.z[3], v))
    p.add(expr, 'expr')
    v = list(p.iter_vars())
    self.assertEqual(len(v), 8)
    self.assertTrue(contains(m.x, v))
    self.assertTrue(contains(m.z[3], v))
    self.assertTrue(contains(expr, v))
    m.x.fix(0)
    v = list(p.iter_vars())
    self.assertEqual(len(v), 8)
    v = list(p.iter_vars(fixed=False))
    self.assertEqual(len(v), 7)
    self.assertTrue(contains(m.z[3], v))
    self.assertTrue(contains(expr, v))
    v = list(p.iter_vars(fixed=True))
    self.assertEqual(len(v), 1)
    self.assertIn(m.x, v)
    v = list(p.iter_vars(expr_vars=True))
    self.assertEqual(len(v), 10)
    self.assertFalse(contains(expr, v))
    self.assertTrue(contains(m.a, v))
    self.assertTrue(contains(m.b, v))
    m.a.fix(0)
    v = list(p.iter_vars(expr_vars=True, fixed=False))
    self.assertEqual(len(v), 8)
    m.b.fix(0)
    m.c.fix(0)
    v = list(p.iter_vars(expr_vars=True, fixed=False))
    self.assertEqual(len(v), 6)
    v = list(p.iter_vars(fixed=False))
    self.assertEqual(len(v), 6)
    self.assertFalse(contains(expr, v))
    v = list(p.iter_vars(expr_vars=True, names=True))
    self.assertEqual(len(v), 10)
    self.assertEqual(len(v[0]), 3)
    for t in v:
        if t[0] == 'x':
            self.assertIs(t[2], m.x)
            break