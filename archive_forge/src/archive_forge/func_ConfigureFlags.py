from __future__ import absolute_import
from __future__ import division
from __future__ import unicode_literals
import collections
import re
import textwrap
from googlecloudsdk.calliope import arg_parsers
from googlecloudsdk.calliope.arg_parsers import ArgumentTypeError
from googlecloudsdk.command_lib.util.args import map_util
from googlecloudsdk.core import log
import six
def ConfigureFlags(parser):
    """Add flags for configuring secret environment variables and secret volumes.

  Args:
    parser: Argument parser.
  """
    kv_metavar = 'SECRET_ENV_VAR=SECRET_VALUE_REF,/secret_path=SECRET_VALUE_REF,/mount_path:/secret_file_path=SECRET_VALUE_REF'
    k_metavar = 'SECRET_ENV_VAR,/secret_path,/mount_path:/secret_file_path'
    flag_group = parser.add_mutually_exclusive_group()
    flag_group.add_argument('--set-secrets', metavar=kv_metavar, action=arg_parsers.UpdateAction, type=ArgSecretsDict(key_type=_SecretsKeyType, value_type=_SecretsValueType), help="\n      List of secret environment variables and secret volumes to configure.\n      Existing secrets configuration will be overwritten.\n\n      You can reference a secret value referred to as `SECRET_VALUE_REF` in the\n      help text in the following ways.\n\n      * Use `${SECRET}:${VERSION}` if you are referencing a secret in the same\n        project, where `${SECRET}` is the name of the secret in secret manager\n        (not the full resource name) and `${VERSION}` is the version of the\n        secret which is either a `positive integer` or the label `latest`.\n        For example, use `SECRET_FOO:1` to reference version `1` of the secret\n        `SECRET_FOO` which exists in the same project as the function.\n\n      * Use `projects/${PROJECT}/secrets/${SECRET}/versions/${VERSION}` or\n        `projects/${PROJECT}/secrets/${SECRET}:${VERSION}` to reference a secret\n        version using the full resource name, where `${PROJECT}` is either the\n        project number (`preferred`) or the project ID of the project which\n        contains the secret, `${SECRET}` is the name of the secret in secret\n        manager (not the full resource name) and `${VERSION}` is the version of\n        the secret which is either a `positive integer` or the label `latest`.\n        For example, use `projects/1234567890/secrets/SECRET_FOO/versions/1` or\n        `projects/project_id/secrets/SECRET_FOO/versions/1` to reference version\n        `1` of the secret `SECRET_FOO` that exists in the project `1234567890`\n        or `project_id` respectively.\n        This format is useful when the secret exists in a different project.\n\n      To configure the secret as an environment variable, use\n      `SECRET_ENV_VAR=SECRET_VALUE_REF`. To use the value of the secret, read\n      the environment variable `SECRET_ENV_VAR` as you would normally do in the\n      function's programming language.\n\n      We recommend using a `numeric` version for secret environment variables\n      as any updates to the secret value are not reflected until new clones\n      start.\n\n      To mount the secret within a volume use `/secret_path=SECRET_VALUE_REF` or\n      `/mount_path:/secret_file_path=SECRET_VALUE_REF`. To use the value of the\n      secret, read the file at `/secret_path` as you would normally do in the\n      function's programming language.\n\n      For example, `/etc/secrets/secret_foo=SECRET_FOO:latest` or\n      `/etc/secrets:/secret_foo=SECRET_FOO:latest` will make the value of the\n      `latest` version of the secret `SECRET_FOO` available in a file\n      `secret_foo` under the directory `/etc/secrets`. `/etc/secrets` will be\n      considered as the `mount path` and will `not` be available for any other\n      volume.\n\n      We recommend referencing the `latest` version when using secret volumes so\n      that the secret's value changes are reflected immediately.")
    update_remove_flag_group = flag_group.add_argument_group(help=textwrap.dedent('      Only `--update-secrets` and `--remove-secrets` can be used together. If\n      both are specified, then `--remove-secrets` will be applied first.'))
    update_remove_flag_group.add_argument('--update-secrets', metavar=kv_metavar, action=arg_parsers.UpdateAction, type=ArgSecretsDict(key_type=_SecretsKeyType, value_type=_SecretsValueType), help='\n      List of secret environment variables and secret volumes to update.\n      Existing secrets configuration not specified in this list will be\n      preserved.')
    update_remove_flag_group.add_argument('--remove-secrets', metavar=k_metavar, action=arg_parsers.UpdateAction, type=arg_parsers.ArgList(element_type=_SecretsKeyType), help='\n      List of secret environment variable names and secret paths to remove.\n\n      Existing secrets configuration of secret environment variable names and\n      secret paths not specified in this list will be preserved.\n\n      To remove a secret environment variable, use the name of the environment\n      variable `SECRET_ENV_VAR`.\n\n      To remove a file within a secret volume or the volume itself, use the\n      secret path as the key (either `/secret_path` or\n      `/mount_path:/secret_file_path`).')
    flag_group.add_argument('--clear-secrets', action='store_true', help='Remove all secret environment variables and volumes.')