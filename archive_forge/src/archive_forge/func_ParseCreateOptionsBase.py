from __future__ import absolute_import
from __future__ import division
from __future__ import unicode_literals
import functools
import string
from apitools.base.py import exceptions as apitools_exceptions
from googlecloudsdk.api_lib.compute import metadata_utils
from googlecloudsdk.api_lib.compute import utils
from googlecloudsdk.api_lib.container import api_adapter
from googlecloudsdk.api_lib.container import kubeconfig as kconfig
from googlecloudsdk.api_lib.container import util
from googlecloudsdk.calliope import actions
from googlecloudsdk.calliope import arg_parsers
from googlecloudsdk.calliope import base
from googlecloudsdk.calliope import exceptions
from googlecloudsdk.command_lib.container import constants
from googlecloudsdk.command_lib.container import container_command_util as cmd_util
from googlecloudsdk.command_lib.container import flags
from googlecloudsdk.core import log
from googlecloudsdk.core.console import console_io
def ParseCreateOptionsBase(args, is_autopilot, get_default, location, project_id):
    """Parses the flags provided with the cluster creation command."""
    flags.MungeBasicAuthFlags(args)
    enable_ip_alias = get_default('enable_ip_alias')
    if hasattr(args, 'enable_ip_alias'):
        flags.WarnForUnspecifiedIpAllocationPolicy(args)
    flags.WarnForEnablingBetaAPIs(args)
    enable_autorepair = None
    if hasattr(args, 'enable_autorepair'):
        enable_autorepair = cmd_util.GetAutoRepair(args)
        if enable_autorepair:
            flags.WarnForNodeModification(args, enable_autorepair)
    metadata = metadata_utils.ConstructMetadataDict(get_default('metadata'), get_default('metadata_from_file'))
    cloud_run_config = flags.GetLegacyCloudRunFlag('{}_config', args, get_default)
    flags.ValidateCloudRunConfigCreateArgs(cloud_run_config, get_default('addons'))
    MaybeLogCloudNatHelpText(args, is_autopilot, location, project_id)
    flags.ValidateNotificationConfigFlag(args)
    ephemeral_storage_local_ssd = None
    if args.IsKnownAndSpecified('ephemeral_storage_local_ssd'):
        ephemeral_storage_local_ssd = [] if args.ephemeral_storage_local_ssd is None else args.ephemeral_storage_local_ssd
    local_nvme_ssd_block = None
    if args.IsKnownAndSpecified('local_nvme_ssd_block'):
        local_nvme_ssd_block = [] if args.local_nvme_ssd_block is None else args.local_nvme_ssd_block
    addons = get_default('addons')
    if getattr(args, 'enable_backup_restore', None):
        if addons is None:
            addons = api_adapter.BACKUPRESTORE
        else:
            addons += api_adapter.BACKUPRESTORE
    return api_adapter.CreateClusterOptions(accelerators=get_default('accelerator'), additional_zones=get_default('additional_zones'), addons=addons, boot_disk_kms_key=get_default('boot_disk_kms_key'), cluster_dns=get_default('cluster_dns'), cluster_dns_scope=get_default('cluster_dns_scope'), additive_vpc_scope_dns_domain=get_default('additive_vpc_scope_dns_domain'), disable_additive_vpc_scope=get_default('disable_additive_vpc_scope'), cluster_dns_domain=get_default('cluster_dns_domain'), cluster_ipv4_cidr=get_default('cluster_ipv4_cidr'), cluster_secondary_range_name=get_default('cluster_secondary_range_name'), cluster_version=get_default('cluster_version'), cloud_run_config=cloud_run_config, node_version=get_default('node_version'), create_subnetwork=get_default('create_subnetwork'), disable_default_snat=get_default('disable_default_snat'), dataplane_v2=get_default('enable_dataplane_v2'), enable_dataplane_v2_metrics=get_default('enable_dataplane_v2_metrics'), disable_dataplane_v2_metrics=get_default('disable_dataplane_v2_metrics'), enable_dataplane_v2_flow_observability=get_default('enable_dataplane_v2_flow_observability'), disable_dataplane_v2_flow_observability=get_default('disable_dataplane_v2_flow_observability'), dataplane_v2_observability_mode=get_default('dataplane_v2_observability_mode'), disk_type=get_default('disk_type'), enable_autorepair=enable_autorepair, enable_autoscaling=get_default('enable_autoscaling'), location_policy=get_default('location_policy'), enable_autoupgrade=cmd_util.GetAutoUpgrade(args) if hasattr(args, 'enable_autoupgrade') else None, enable_binauthz=get_default('enable_binauthz'), binauthz_evaluation_mode=get_default('binauthz_evaluation_mode'), binauthz_policy_bindings=get_default('binauthz_policy_bindings'), enable_stackdriver_kubernetes=_GetEnableStackdriver(args), enable_cloud_logging=args.enable_cloud_logging if args.IsKnownAndSpecified('enable_cloud_logging') else None, enable_cloud_monitoring=args.enable_cloud_monitoring if args.IsKnownAndSpecified('enable_cloud_monitoring') else None, enable_workload_monitoring_eap=get_default('enable_workload_monitoring_eap'), logging=get_default('logging'), monitoring=get_default('monitoring'), enable_l4_ilb_subsetting=get_default('enable_l4_ilb_subsetting'), enable_ip_alias=enable_ip_alias, enable_intra_node_visibility=get_default('enable_intra_node_visibility'), enable_kubernetes_alpha=get_default('enable_kubernetes_alpha'), alpha_cluster_feature_gates=get_default('alpha_cluster_feature_gates'), enable_cloud_run_alpha=flags.GetLegacyCloudRunFlag('enable_{}_alpha', args, get_default), enable_legacy_authorization=get_default('enable_legacy_authorization'), enable_managed_prometheus=get_default('enable_managed_prometheus'), enable_master_authorized_networks=get_default('enable_master_authorized_networks'), enable_master_global_access=get_default('enable_master_global_access'), enable_mesh_certificates=get_default('enable_mesh_certificates'), enable_network_policy=get_default('enable_network_policy'), enable_private_nodes=get_default('enable_private_nodes'), enable_private_endpoint=get_default('enable_private_endpoint'), enable_gke_oidc=getattr(args, 'enable_gke_oidc', None), enable_identity_service=getattr(args, 'enable_identity_service', None), ephemeral_storage_local_ssd=ephemeral_storage_local_ssd, image_type=get_default('image_type'), image=get_default('image'), image_project=get_default('image_project'), image_family=get_default('image_family'), issue_client_certificate=get_default('issue_client_certificate'), labels=get_default('labels'), local_nvme_ssd_block=local_nvme_ssd_block, local_ssd_count=get_default('local_ssd_count'), maintenance_window=get_default('maintenance_window'), maintenance_window_start=get_default('maintenance_window_start'), maintenance_window_end=get_default('maintenance_window_end'), maintenance_window_recurrence=get_default('maintenance_window_recurrence'), master_authorized_networks=get_default('master_authorized_networks'), master_ipv4_cidr=get_default('master_ipv4_cidr'), max_nodes=get_default('max_nodes'), max_nodes_per_pool=get_default('max_nodes_per_pool'), min_cpu_platform=get_default('min_cpu_platform'), min_nodes=get_default('min_nodes'), total_max_nodes=get_default('total_max_nodes'), total_min_nodes=get_default('total_min_nodes'), network=get_default('network'), node_disk_size_gb=utils.BytesToGb(args.disk_size) if hasattr(args, 'disk_size') else None, node_labels=get_default('node_labels'), node_locations=get_default('node_locations'), node_machine_type=get_default('machine_type'), node_taints=get_default('node_taints'), notification_config=get_default('notification_config'), autoscaling_profile=getattr(args, 'autoscaling_profile', None), num_nodes=get_default('num_nodes'), password=get_default('password'), preemptible=get_default('preemptible'), security_group=get_default('security_group'), scopes=get_default('scopes'), service_account=get_default('service_account'), services_ipv4_cidr=get_default('services_ipv4_cidr'), services_secondary_range_name=get_default('services_secondary_range_name'), subnetwork=get_default('subnetwork'), system_config_from_file=get_default('system_config_from_file'), private_ipv6_google_access_type=get_default('private_ipv6_google_access_type'), tags=get_default('tags'), autoprovisioning_network_tags=get_default('autoprovisioning_network_tags'), threads_per_core=get_default('threads_per_core'), user=get_default('username'), metadata=metadata, default_max_pods_per_node=get_default('default_max_pods_per_node'), max_pods_per_node=get_default('max_pods_per_node'), enable_tpu=get_default('enable_tpu'), tpu_ipv4_cidr=get_default('tpu_ipv4_cidr'), resource_usage_bigquery_dataset=get_default('resource_usage_bigquery_dataset'), enable_network_egress_metering=get_default('enable_network_egress_metering'), enable_resource_consumption_metering=get_default('enable_resource_consumption_metering'), database_encryption_key=get_default('database_encryption_key'), workload_pool=get_default('workload_pool'), identity_provider=get_default('identity_provider'), workload_metadata=get_default('workload_metadata'), workload_metadata_from_node=get_default('workload_metadata_from_node'), enable_vertical_pod_autoscaling=get_default('enable_vertical_pod_autoscaling'), enable_experimental_vertical_pod_autoscaling=get_default('enable_experimental_vertical_pod_autoscaling'), enable_autoprovisioning=get_default('enable_autoprovisioning'), autoprovisioning_config_file=get_default('autoprovisioning_config_file'), autoprovisioning_service_account=get_default('autoprovisioning_service_account'), autoprovisioning_scopes=get_default('autoprovisioning_scopes'), autoprovisioning_locations=get_default('autoprovisioning_locations'), autoprovisioning_max_surge_upgrade=get_default('autoprovisioning_max_surge_upgrade'), autoprovisioning_max_unavailable_upgrade=get_default('autoprovisioning_max_unavailable_upgrade'), enable_autoprovisioning_surge_upgrade=get_default('enable_autoprovisioning_surge_upgrade'), enable_autoprovisioning_blue_green_upgrade=get_default('enable_autoprovisioning_blue_green_upgrade'), autoprovisioning_standard_rollout_policy=get_default('autoprovisioning_standard_rollout_policy'), autoprovisioning_node_pool_soak_duration=get_default('autoprovisioning_node_pool_soak_duration'), enable_autoprovisioning_autorepair=get_default('enable_autoprovisioning_autorepair'), enable_autoprovisioning_autoupgrade=get_default('enable_autoprovisioning_autoupgrade'), autoprovisioning_min_cpu_platform=get_default('autoprovisioning_min_cpu_platform'), min_cpu=get_default('min_cpu'), max_cpu=get_default('max_cpu'), min_memory=get_default('min_memory'), max_memory=get_default('max_memory'), min_accelerator=get_default('min_accelerator'), max_accelerator=get_default('max_accelerator'), autoprovisioning_image_type=get_default('autoprovisioning_image_type'), shielded_secure_boot=get_default('shielded_secure_boot'), shielded_integrity_monitoring=get_default('shielded_integrity_monitoring'), reservation_affinity=get_default('reservation_affinity'), reservation=get_default('reservation'), release_channel=get_default('release_channel'), enable_shielded_nodes=get_default('enable_shielded_nodes'), max_surge_upgrade=get_default('max_surge_upgrade'), max_unavailable_upgrade=get_default('max_unavailable_upgrade'), autopilot=is_autopilot, gvnic=get_default('enable_gvnic'), enable_confidential_nodes=get_default('enable_confidential_nodes'), enable_confidential_storage=get_default('enable_confidential_storage'), storage_pools=get_default('storage_pools'), enable_image_streaming=get_default('enable_image_streaming'), spot=get_default('spot'), enable_service_externalips=get_default('enable_service_externalips'), disable_pod_cidr_overprovision=get_default('disable_pod_cidr_overprovision'), stack_type=get_default('stack_type'), ipv6_access_type=get_default('ipv6_access_type'), private_endpoint_subnetwork=get_default('private_endpoint_subnetwork'), enable_google_cloud_access=get_default('enable_google_cloud_access'), gateway_api=get_default('gateway_api'), logging_variant=get_default('logging_variant'), enable_cost_allocation=get_default('enable_cost_allocation'), enable_multi_networking=get_default('enable_multi_networking'), placement_type=get_default('placement_type'), placement_policy=get_default('placement_policy'), enable_security_posture=get_default('enable_security_posture'), network_performance_config=get_default('network_performance_configs'), enable_insecure_kubelet_readonly_port=get_default('enable_insecure_kubelet_readonly_port'), autoprovisioning_enable_insecure_kubelet_readonly_port=get_default('autoprovisioning_enable_insecure_kubelet_readonly_port'), enable_k8s_beta_apis=getattr(args, 'enable_kubernetes_unstable_apis'), security_posture=get_default('security_posture'), workload_vulnerability_scanning=get_default('workload_vulnerability_scanning'), enable_runtime_vulnerability_insight=get_default('enable_runtime_vulnerability_insight'), workload_policies=get_default('workload_policies'), in_transit_encryption=get_default('in_transit_encryption'), containerd_config_from_file=get_default('containerd_config_from_file'), fleet_project=get_default('fleet_project'), enable_fleet=get_default('enable_fleet'), enable_secret_manager=get_default('enable_secret_manager'), enable_cilium_clusterwide_network_policy=get_default('enable_cilium_clusterwide_network_policy'), resource_manager_tags=get_default('resource_manager_tags'), autoprovisioning_resource_manager_tags=get_default('autoprovisioning_resource_manager_tags'), enable_fqdn_network_policy=get_default('enable_fqdn_network_policy'))