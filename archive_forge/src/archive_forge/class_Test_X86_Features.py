import sys, platform, re, pytest
from numpy.core._multiarray_umath import (
import numpy as np
import subprocess
import pathlib
import os
import re
@pytest.mark.skipif(not (is_linux or is_cygwin) or not is_x86, reason='Only for Linux and x86')
class Test_X86_Features(AbstractTest):
    features = ['MMX', 'SSE', 'SSE2', 'SSE3', 'SSSE3', 'SSE41', 'POPCNT', 'SSE42', 'AVX', 'F16C', 'XOP', 'FMA4', 'FMA3', 'AVX2', 'AVX512F', 'AVX512CD', 'AVX512ER', 'AVX512PF', 'AVX5124FMAPS', 'AVX5124VNNIW', 'AVX512VPOPCNTDQ', 'AVX512VL', 'AVX512BW', 'AVX512DQ', 'AVX512VNNI', 'AVX512IFMA', 'AVX512VBMI', 'AVX512VBMI2', 'AVX512BITALG', 'AVX512FP16']
    features_groups = dict(AVX512_KNL=['AVX512F', 'AVX512CD', 'AVX512ER', 'AVX512PF'], AVX512_KNM=['AVX512F', 'AVX512CD', 'AVX512ER', 'AVX512PF', 'AVX5124FMAPS', 'AVX5124VNNIW', 'AVX512VPOPCNTDQ'], AVX512_SKX=['AVX512F', 'AVX512CD', 'AVX512BW', 'AVX512DQ', 'AVX512VL'], AVX512_CLX=['AVX512F', 'AVX512CD', 'AVX512BW', 'AVX512DQ', 'AVX512VL', 'AVX512VNNI'], AVX512_CNL=['AVX512F', 'AVX512CD', 'AVX512BW', 'AVX512DQ', 'AVX512VL', 'AVX512IFMA', 'AVX512VBMI'], AVX512_ICL=['AVX512F', 'AVX512CD', 'AVX512BW', 'AVX512DQ', 'AVX512VL', 'AVX512IFMA', 'AVX512VBMI', 'AVX512VNNI', 'AVX512VBMI2', 'AVX512BITALG', 'AVX512VPOPCNTDQ'], AVX512_SPR=['AVX512F', 'AVX512CD', 'AVX512BW', 'AVX512DQ', 'AVX512VL', 'AVX512IFMA', 'AVX512VBMI', 'AVX512VNNI', 'AVX512VBMI2', 'AVX512BITALG', 'AVX512VPOPCNTDQ', 'AVX512FP16'])
    features_map = dict(SSE3='PNI', SSE41='SSE4_1', SSE42='SSE4_2', FMA3='FMA', AVX512VNNI='AVX512_VNNI', AVX512BITALG='AVX512_BITALG', AVX512VBMI2='AVX512_VBMI2', AVX5124FMAPS='AVX512_4FMAPS', AVX5124VNNIW='AVX512_4VNNIW', AVX512VPOPCNTDQ='AVX512_VPOPCNTDQ', AVX512FP16='AVX512_FP16')

    def load_flags(self):
        self.load_flags_cpuinfo('flags')