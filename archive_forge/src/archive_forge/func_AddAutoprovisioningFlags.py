from __future__ import absolute_import
from __future__ import division
from __future__ import unicode_literals
import textwrap
from googlecloudsdk.api_lib.compute import constants as compute_constants
from googlecloudsdk.api_lib.container import api_adapter
from googlecloudsdk.api_lib.container import util
from googlecloudsdk.api_lib.util import apis
from googlecloudsdk.calliope import actions
from googlecloudsdk.calliope import arg_parsers
from googlecloudsdk.calliope import base
from googlecloudsdk.calliope import exceptions
from googlecloudsdk.command_lib.container import constants
from googlecloudsdk.core import log
from googlecloudsdk.core import properties
from Google Kubernetes Engine labels that are used for the purpose of tracking
from the node pool, depending on whether locations are being added or removed.
def AddAutoprovisioningFlags(parser, hidden=False, for_create=False):
    """Adds node autoprovisioning related flags to parser.

  Autoprovisioning related flags are: --enable-autoprovisioning
  --min-cpu --max-cpu --min-memory --max-memory --autoprovisioning-image-type
  flags.

  Args:
    parser: A given parser.
    hidden: If true, suppress help text for added options.
    for_create: Add flags for create request.
  """
    group = parser.add_argument_group('Node autoprovisioning', hidden=hidden)
    group.add_argument('--enable-autoprovisioning', required=True, default=None, help='Enables  node autoprovisioning for a cluster.\n\nCluster Autoscaler will be able to create new node pools. Requires maximum CPU\nand memory limits to be specified.', hidden=hidden, action='store_true')
    limits_group = group.add_mutually_exclusive_group()
    limits_group.add_argument('--autoprovisioning-config-file', type=arg_parsers.FileContents(), hidden=hidden, help='Path of the JSON/YAML file which contains information about the\ncluster\'s node autoprovisioning configuration. Currently it contains\na list of resource limits, identity defaults for autoprovisioning, node upgrade\nsettings, node management settings, minimum cpu platform, image type, node locations for\nautoprovisioning, disk type and size configuration, Shielded instance settings,\nand customer-managed encryption keys settings.\n\nResource limits are specified in the field \'resourceLimits\'.\nEach resource limits definition contains three fields:\nresourceType, maximum and minimum.\nResource type can be "cpu", "memory" or an accelerator (e.g.\n"nvidia-tesla-k80" for nVidia Tesla K80). Use gcloud compute accelerator-types\nlist to learn about available accelerator types.\nMaximum is the maximum allowed amount with the unit of the resource.\nMinimum is the minimum allowed amount with the unit of the resource.\n\nIdentity default contains at most one of the below fields:\nserviceAccount: The Google Cloud Platform Service Account to be used by node VMs in\nautoprovisioned node pools. If not specified, the project\'s default service account\nis used.\nscopes: A list of scopes to be used by node instances in autoprovisioned node pools.\nMultiple scopes can be specified, separated by commas. For information on defaults,\nlook at:\nhttps://cloud.google.com/sdk/gcloud/reference/container/clusters/create#--scopes\n\nNode Upgrade settings are specified under the field\n\'upgradeSettings\', which has the following fields:\nmaxSurgeUpgrade: Number of extra (surge) nodes to be created on\neach upgrade of an autoprovisioned node pool.\nmaxUnavailableUpgrade: Number of nodes that can be unavailable at the\nsame time on each upgrade of an autoprovisioned node pool.\n\nNode Management settings are specified under the field\n\'management\', which has the following fields:\nautoUpgrade: A boolean field that indicates if node\nautoupgrade is enabled for autoprovisioned node pools.\nautoRepair: A boolean field that indicates if node\nautorepair is enabled for autoprovisioned node pools.\n\nminCpuPlatform (deprecated): If specified, new autoprovisioned nodes will be\nscheduled on host with specified CPU architecture or a newer one.\nNote: Min CPU platform can only be specified in Beta and Alpha.\n\nAutoprovisioned node image is specified under the \'imageType\' field. If not specified\nthe default value will be applied.\n\nAutoprovisioning locations is a set of zones where new node pools\ncan be created by Autoprovisioning. Autoprovisioning locations are\nspecified in the field \'autoprovisioningLocations\'. All zones must\nbe in the same region as the cluster\'s master(s).\n\nDisk type and size are specified under the \'diskType\' and \'diskSizeGb\' fields,\nrespectively. If specified, new autoprovisioned nodes will be created with\ncustom boot disks configured by these settings.\n\nShielded instance settings are specified under the \'shieldedInstanceConfig\'\nfield, which has the following fields:\nenableSecureBoot: A boolean field that indicates if secure boot is enabled for\nautoprovisioned nodes.\nenableIntegrityMonitoring: A boolean field that indicates if integrity\nmonitoring is enabled for autoprovisioned nodes.\n\nCustomer Managed Encryption Keys (CMEK) used by new auto-provisioned node pools\ncan be specified in the \'bootDiskKmsKey\' field.\n')
    from_flags_group = limits_group.add_argument_group('Flags to configure autoprovisioned nodes')
    from_flags_group.add_argument('--max-cpu', required=for_create, help='Maximum number of cores in the cluster.\n\nMaximum number of cores to which the cluster can scale.', hidden=hidden, type=int)
    from_flags_group.add_argument('--min-cpu', help='Minimum number of cores in the cluster.\n\nMinimum number of cores to which the cluster can scale.', hidden=hidden, type=int)
    from_flags_group.add_argument('--max-memory', required=for_create, help='Maximum memory in the cluster.\n\nMaximum number of gigabytes of memory to which the cluster can scale.', hidden=hidden, type=int)
    from_flags_group.add_argument('--min-memory', help='Minimum memory in the cluster.\n\nMinimum number of gigabytes of memory to which the cluster can scale.', hidden=hidden, type=int)
    from_flags_group.add_argument('--autoprovisioning-image-type', help='Node Autoprovisioning will create new nodes with the specified image type', type=str)
    accelerator_group = from_flags_group.add_argument_group('Arguments to set limits on accelerators:')
    accelerator_group.add_argument('--max-accelerator', type=arg_parsers.ArgDict(spec={'type': str, 'count': int}, required_keys=['type', 'count'], max_length=2), required=True, metavar='type=TYPE,count=COUNT', hidden=hidden, help='Sets maximum limit for a single type of accelerators (e.g. GPUs) in cluster.\n\n*type*::: (Required) The specific type (e.g. nvidia-tesla-k80 for nVidia Tesla K80)\nof accelerator for which the limit is set. Use ```gcloud compute\naccelerator-types list``` to learn about all available accelerator types.\n\n*count*::: (Required) The maximum number of accelerators\nto which the cluster can be scaled.\n')
    accelerator_group.add_argument('--min-accelerator', type=arg_parsers.ArgDict(spec={'type': str, 'count': int}, required_keys=['type', 'count'], max_length=2), metavar='type=TYPE,count=COUNT', hidden=hidden, help="Sets minimum limit for a single type of accelerators (e.g. GPUs) in cluster. Defaults\nto 0 for all accelerator types if it isn't set.\n\n*type*::: (Required) The specific type (e.g. nvidia-tesla-k80 for nVidia Tesla K80)\nof accelerator for which the limit is set. Use ```gcloud compute\naccelerator-types list``` to learn about all available accelerator types.\n\n*count*::: (Required) The minimum number of accelerators\nto which the cluster can be scaled.\n")
    identity_group = from_flags_group.add_argument_group('Flags to specify identity for autoprovisioned nodes:')
    identity_group.add_argument('--autoprovisioning-service-account', type=str, hidden=hidden, help='The Google Cloud Platform Service Account to be used by node VMs in\nautoprovisioned node pools. If not specified, the project default\nservice account is used.\n')
    identity_group.add_argument('--autoprovisioning-scopes', type=arg_parsers.ArgList(), metavar='SCOPE', hidden=hidden, help='The scopes to be used by node instances in autoprovisioned node pools.\nMultiple scopes can be specified, separated by commas. For information\non defaults, look at:\nhttps://cloud.google.com/sdk/gcloud/reference/container/clusters/create#--scopes\n')
    upgrade_settings_group = from_flags_group.add_argument_group('Flags to specify upgrade settings for autoprovisioned nodes:', hidden=hidden)
    upgrade_option_enablement_group = upgrade_settings_group.add_argument_group('Flag group to choose the top level upgrade option:', hidden=hidden, mutex=True)
    upgrade_option_enablement_group.add_argument('--enable-autoprovisioning-surge-upgrade', action='store_true', hidden=hidden, help='Whether to use surge upgrade for the autoprovisioned node pool.\n')
    upgrade_option_enablement_group.add_argument('--enable-autoprovisioning-blue-green-upgrade', action='store_true', hidden=hidden, help='Whether to use blue-green upgrade for the autoprovisioned node pool.\n')
    upgrade_settings_group.add_argument('--autoprovisioning-max-surge-upgrade', type=int, hidden=hidden, help='Number of extra (surge) nodes to be created on each upgrade of an\nautoprovisioned node pool.\n')
    upgrade_settings_group.add_argument('--autoprovisioning-max-unavailable-upgrade', type=int, hidden=hidden, help='Number of nodes that can be unavailable at the same time on each\nupgrade of an autoprovisioned node pool.\n')
    spec = {'batch-node-count': int, 'batch-percent': float, 'batch-soak-duration': str}
    upgrade_settings_group.add_argument('--autoprovisioning-standard-rollout-policy', metavar='batch-node-count=BATCH_NODE_COUNT,batch-percent=BATCH_NODE_PERCENTAGE,batch-soak-duration=BATCH_SOAK_DURATION', type=arg_parsers.ArgDict(spec=spec), hidden=hidden, help='Standard rollout policy options for blue-green upgrade.\nThis argument should be used in conjunction with\n`--enable-autoprovisioning-blue-green-upgrade` to take effect.\n\nBatch sizes are specified by one of, batch-node-count or batch-percent.\nThe duration between batches is specified by batch-soak-duration.\n\nExample:\n`--standard-rollout-policy=batch-node-count=3,batch-soak-duration=60s`\n`--standard-rollout-policy=batch-percent=0.05,batch-soak-duration=180s`\n')
    upgrade_settings_group.add_argument('--autoprovisioning-node-pool-soak-duration', type=str, hidden=hidden, help='Time in seconds to be spent waiting during blue-green upgrade before\ndeleting the blue pool and completing the update.\nThis argument should be used in conjunction with\n`--enable-autoprovisioning-blue-green-upgrade` to take effect.\n')
    management_settings_group = from_flags_group.add_argument_group('Flags to specify node management settings for autoprovisioned nodes:', hidden=hidden)
    management_settings_group.add_argument('--enable-autoprovisioning-autoupgrade', hidden=hidden, default=None, required=True, action='store_true', help='Enable node autoupgrade for autoprovisioned node pools.\nUse --no-enable-autoprovisioning-autoupgrade to disable.\n')
    management_settings_group.add_argument('--enable-autoprovisioning-autorepair', default=None, action='store_true', hidden=hidden, required=True, help='Enable node autorepair for autoprovisioned node pools.\nUse --no-enable-autoprovisioning-autorepair to disable.\n')
    from_flags_group.add_argument('--autoprovisioning-locations', hidden=hidden, help="Set of zones where new node pools can be created by autoprovisioning.\nAll zones must be in the same region as the cluster's master(s).\nMultiple locations can be specified, separated by commas.", metavar='ZONE', type=arg_parsers.ArgList(min_length=1))
    from_flags_group.add_argument('--autoprovisioning-min-cpu-platform', action=actions.DeprecationAction('--autoprovisioning-min-cpu-platform', warn='The `--autoprovisioning-min-cpu-platform` flag is deprecated and will be removed in an upcoming release. More info: https://cloud.google.com/kubernetes-engine/docs/release-notes#March_08_2022'), hidden=hidden, metavar='PLATFORM', help='If specified, new autoprovisioned nodes will be scheduled on host with\nspecified CPU architecture or a newer one.\n')