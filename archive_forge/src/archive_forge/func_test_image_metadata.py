from openstack.tests.functional import base
from openstack.tests.functional.image.v2.test_image import TEST_IMAGE_NAME
def test_image_metadata(self):
    image = self._get_non_test_image()
    self.conn.compute.delete_image_metadata(image, image.metadata.keys())
    image = self.conn.compute.get_image_metadata(image)
    self.assertFalse(image.metadata)
    image = self.conn.compute.get_image_metadata(image)
    self.assertFalse(image.metadata)
    self.conn.compute.set_image_metadata(image)
    image = self.conn.compute.get_image_metadata(image)
    self.assertFalse(image.metadata)
    self.conn.compute.set_image_metadata(image, k0='')
    image = self.conn.compute.get_image_metadata(image)
    self.assertIn('k0', image.metadata)
    self.assertEqual('', image.metadata['k0'])
    self.conn.compute.set_image_metadata(image, k1='v1')
    image = self.conn.compute.get_image_metadata(image)
    self.assertTrue(image.metadata)
    self.assertEqual(2, len(image.metadata))
    self.assertIn('k1', image.metadata)
    self.assertEqual('v1', image.metadata['k1'])
    self.conn.compute.set_image_metadata(image, k2='v2')
    image = self.conn.compute.get_image_metadata(image)
    self.assertTrue(image.metadata)
    self.assertEqual(3, len(image.metadata))
    self.assertIn('k1', image.metadata)
    self.assertEqual('v1', image.metadata['k1'])
    self.assertIn('k2', image.metadata)
    self.assertEqual('v2', image.metadata['k2'])
    self.conn.compute.set_image_metadata(image, k1='v1.1')
    image = self.conn.compute.get_image_metadata(image)
    self.assertTrue(image.metadata)
    self.assertEqual(3, len(image.metadata))
    self.assertIn('k1', image.metadata)
    self.assertEqual('v1.1', image.metadata['k1'])
    self.assertIn('k2', image.metadata)
    self.assertEqual('v2', image.metadata['k2'])
    self.conn.compute.delete_image_metadata(image, image.metadata.keys())
    image = self.conn.compute.get_image_metadata(image)
    self.assertFalse(image.metadata)