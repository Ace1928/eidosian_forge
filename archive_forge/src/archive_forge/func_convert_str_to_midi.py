import json
import random
from dataclasses import dataclass
from functools import lru_cache
from math import ceil, floor, log
from typing import Dict, Iterator, List, Optional, Tuple
import mido
def convert_str_to_midi(cfg: VocabConfig, data: str, meta_text: str='Generated by MIDI-LLM-tokenizer') -> mido.MidiFile:
    utils = VocabUtils(cfg)
    mid = mido.MidiFile()
    track = mido.MidiTrack()
    mid.tracks.append(track)
    tempo = 500000
    if meta_text:
        track.append(mido.MetaMessage('text', text=meta_text, time=0))
    track.append(mido.MetaMessage('set_tempo', tempo=tempo, time=0))
    for msg in generate_program_change_messages(cfg):
        track.append(msg)
    for msg in str_to_midi_messages(utils, data):
        track.append(msg)
    track.append(mido.MetaMessage('end_of_track', time=0))
    return mid